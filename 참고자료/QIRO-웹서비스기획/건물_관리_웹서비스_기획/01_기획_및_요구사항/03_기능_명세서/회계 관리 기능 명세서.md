# 📊 QIRO - 회계 관리 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - 회계 관리 기능 명세서
- **기능 ID (선택 사항):** F-ACCMGMT-001 (Accounting Management)
- **관련 요구사항 ID:** (예: QIRO-FR-ACC-001 ~ QIRO-FR-ACC-050)
- **관련 사용자 스토리 ID:** (예: US-AS-XXX, US-SA-XXX)
- **작성일:** 2025년 06월 03일
- **최종 수정일:** 2025년 06월 03일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
QIRO 서비스 내에서 발생하는 모든 재무적 거래(관리비 수입, 임대료 수입, 각종 운영 비용 지출, 자산/부채/자본의 변동 등)를 회계 원칙에 따라 정확하게 기록, 분류, 집계하고, 이를 바탕으로 신뢰할 수 있는 재무 보고서(재무상태표, 손익계산서 등)를 생성한다. 이를 통해 건물의 재무 상태와 경영 성과를 효과적으로 파악하고, 투명한 회계 관리를 지원하며, 필요한 경우 외부 보고 요건을 충족시키는 기초를 마련한다.

### 2.2. 설명
본 기능은 회계 처리의 기본이 되는 계정과목 관리, 일상적인 거래를 기록하는 전표 관리(수동 입력 및 타 모듈 연동 자동 생성), 기록된 전표를 집계하는 주요 장부(분개장, 총계정원장) 조회, 그리고 경영 성과와 재무 상태를 보여주는 핵심 재무제표 생성 기능을 제공한다. 또한, 월별 또는 연간 회계 마감 및 차기 이월 처리 기능을 포함하여 회계 사이클을 완결한다.

### 2.3. 범위
- **In-Scope (포함 범위):**
    - **계정과목 관리:** 표준 계정과목 체계 제공, 사용자 정의 계정과목 추가/수정/삭제(계층 구조 지원), 계정과목별 잔액 관리 기초.
    - **전표 관리:**
        - 수동 전표 입력 (차변/대변, 계정과목, 금액, 적요, 증빙 첨부(선택)).
        - 자동 전표 생성 (관리비 부과/수납, 임대료 수입, 지출 결의 등 QIRO 내 다른 기능과 연동 - 연동 규칙 정의 필요).
        - 전표 조회, 수정(제한적 - 예: 마감 전, 적요 수정 등), 삭제(제 ειδικό 권한 및 조건 하에), (선택) 전표 승인 프로세스.
    - **장부 관리:**
        - 분개장 자동 생성 및 조회 (기간별, 조건별).
        - 총계정원장 자동 생성 및 조회 (계정과목별, 기간별).
        - (선택) 주요 보조원장 (예: 거래처원장, 예금계정원장).
    - **재무제표 생성:**
        - 재무상태표 (대차대조표) 생성 (특정 시점 기준, 월별/분기별/연간).
        - 손익계산서 생성 (특정 기간 기준, 월별/분기별/연간).
        - 재무제표 조회 및 출력(PDF, Excel) 기능.
    - **회계 마감 및 이월:**
        - 월별 마감 (수익/비용 계정의 당기순이익으로의 집계 - 선택적).
        - 연차 마감 (수익/비용 계정 마감, 자산/부채/자본 계정 잔액 차기 이월).
- **Out-of-Scope (제외 범위):**
    - 상세 세무 회계 기능 및 세금계산서 발행/수취 관리, 전자세금계산서 연동, 부가세/법인세 등 세무 신고 자료 직접 생성 및 전자신고. (기초 데이터 제공은 가능)
    - 고급 원가 회계 또는 관리 회계 기능 (예: 활동기준원가계산).
    - 예산 편성 및 상세 통제 기능 (초기 버전은 예산 대비 실적 비교 정도만 고려).
    - 은행/카드사 거래 내역 실시간 자동 수집 및 자동 분개 (초기 버전은 수동 전표 또는 파일 업로드 기반 반자동 분개 지원).
    - 외부 회계 프로그램과의 직접적인 실시간 양방향 데이터 동기화.
    - 고정자산 감가상각 상세 관리 및 자동 계산 (기본적인 자산 계정 관리는 가능).

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면 (주요 메뉴 예시)
- `관리자 포털 > 회계 관리`
    - `회계 설정 > 계정과목 관리`
    - `회계 설정 > 회계 기간 및 마감 관리`
    - `전표 관리 > 전표 입력`
    - `전표 관리 > 전표 조회/수정`
    - `장부 조회 > 분개장`
    - `장부 조회 > 총계정원장`
    - `재무제표 > 재무상태표 조회`
    - `재무제표 > 손익계산서 조회`
    - `회계 마감 > 월별 마감` (선택적)
    - `회계 마감 > 연차 마감 및 이월`

### 3.2. UI 요소별 상세 설명 (주요 화면 예시)
- **화면 1: 계정과목 관리 화면**
    * 계정과목 트리 또는 목록 표시 (코드, 계정명, 유형, 상위계정 등).
    * `[+ 계정 추가]`, `[수정]`, `[삭제]` 버튼.
    * 계정 추가/수정 폼: 계정 코드, 계정명, 유형(자산/부채/자본/수익/비용 선택), 상위 계정 선택, 설명 등 입력.
- **화면 2: 전표 입력 화면**
    * 전표 기본 정보: 전표일자, 전표번호(자동채번), 적요(설명), 작성자.
    * 분개 입력 영역 (여러 줄 입력 가능 - 차변/대변 쌍):
        * `차변 계정과목` (드롭다운/검색), `차변 금액`, `(선택) 차변 거래처`, `(선택) 차변 부가세유형`
        * `대변 계정과목` (드롭다운/검색), `대변 금액`, `(선택) 대변 거래처`, `(선택) 대변 부가세유형`
        * `분개라인 적요`
    * 차/대변 합계 자동 계산 및 일치 여부 표시.
    * `[임시 저장]`, `[확정 저장]`, `[증빙 첨부]` 버튼.
- **화면 3: 총계정원장 조회 화면**
    * 조회 조건: 기간(시작일, 종료일), 계정과목 선택.
    * `[조회]` 버튼.
    * 조회 결과 테이블: 일자, (상대)계정과목, 적요, 차변금액, 대변금액, 잔액.
    * `[인쇄]`, `[Excel 내보내기]` 버튼.
- **화면 4: 손익계산서 조회 화면**
    * 조회 조건: 기간(시작일, 종료일 - 보통 월/분기/연 단위), (선택) 비교 대상 기간.
    * `[조회]` 버튼.
    * 손익계산서 형식으로 표시: 매출(관리비수익, 임대수익 등), 매출원가(해당시), 매출총이익, 판매비와관리비(항목별), 영업이익, 기타수익/비용, 법인세비용차감전순이익, 법인세비용, 당기순이익.
    * `[인쇄]`, `[Excel 내보내기]` 버튼.

#### 3.3. 주요 사용자 시나리오 (흐름)
- **시나리오 1: 초기 계정과목 설정 및 수정**
    1. 회계 담당자가 `계정과목 관리` 화면에 접속한다.
    2. 시스템에서 제공하는 표준 계정과목을 확인하고, 필요에 따라 회사 운영에 맞는 계정과목을 추가하거나 기존 계정의 명칭/설명 등을 수정한다.
- **시나리오 2: 수동 전표 입력 (예: 사무용품 구입비 지출)**
    1. 회계 담당자가 `전표 입력` 화면에 접속한다.
    2. 전표일자, 적요("사무용품 구입 (현금)") 등을 입력한다.
    3. 분개 입력: 차변 - `소모품비` 10,000원 / 대변 - `현금` 10,000원.
    4. (선택) 관련 영수증 파일을 첨부한다.
    5. 차/대변 합계 일치 확인 후 `[확정 저장]` 버튼을 클릭한다.
    6. 시스템은 전표를 저장하고, 해당 계정과목의 원장에 반영한다.
- **시나리오 3: 관리비 수납에 따른 자동 생성 전표 확인**
    1. "수납 처리" 기능에서 관리비 수납이 완료되면, 시스템은 사전에 정의된 연동 규칙에 따라 회계 전표를 자동으로 생성한다. (예: 차변 - `보통예금` / 대변 - `미수관리비`)
    2. 회계 담당자는 `전표 조회/수정` 화면에서 자동 생성된 전표를 확인하고, 필요한 경우 적요 등을 보충하거나 (정책에 따라) 승인한다.
- **시나리오 4: 월별 손익계산서 조회**
    1. 회계 담당자(또는 경영진)가 `손익계산서 조회` 화면에 접속한다.
    2. 조회 기간(예: 2025년 5월 1일 ~ 2025년 5월 31일)을 선택하고 `[조회]` 버튼을 클릭한다.
    3. 시스템은 해당 기간의 모든 확정 전표를 집계하여 손익계산서를 화면에 표시한다.
    4. 사용자는 `[인쇄]` 또는 `[Excel 내보내기]`를 통해 보고서를 활용한다.
- **시나리오 5: 회계 연도 마감 및 이월**
    1. 회계 담당자가 회계 연도 말에 `연차 마감 및 이월` 기능을 실행한다.
    2. 시스템은 해당 연도의 모든 수익/비용 계정을 마감하여 당기순손익을 산출하고, 이익잉여금(또는 결손금) 계정으로 대체하는 마감 분개를 자동으로 생성한다.
    3. 모든 자산, 부채, 자본 계정의 기말 잔액을 다음 회계 연도의 기초 잔액으로 이월시킨다.
    4. 마감된 회계 연도의 데이터는 읽기 전용으로 전환되거나 수정이 엄격히 통제된다.

### 4. 데이터 요구사항
#### 4.1. 입력 데이터
- **계정과목 정보:** 계정코드, 계정명, 계정유형, 상위계정, 설명 등.
- **전표 정보:** 전표일자, 적요, (자동생성 시) 연동 모듈 정보.
- **분개 정보:** 차/대변 계정과목, 금액, 거래처, 부가세 유형 등.
- **마감 기준:** 마감 대상 기간(월/년).

#### 4.2. 출력 데이터 (화면 표시 및 보고서용)
- 계정과목 목록, 전표 목록, 분개장, 총계정원장.
- 재무상태표, 손익계산서 등 재무제표.
- 회계 마감 결과 보고서.

#### 4.3. 주요 엔티티 속성 (예시)
- **`ChartOfAccount` (계정과목)**
    | 속성명             | 데이터 타입         | 필수 | 설명                                                         |
    | :----------------- | :------------------ | :--- | :----------------------------------------------------------- |
    | `accountId`        | UUID/Long (PK)      | Y    | 계정 고유 ID                                                 |
    | `accountCode`      | String              | Y    | 계정 코드 (사용자 정의 또는 표준 코드)                       |
    | `accountName`      | String              | Y    | 계정명                                                       |
    | `accountType`      | Enum/String         | Y    | 계정 유형 (`ASSET`, `LIABILITY`, `EQUITY`, `REVENUE`, `EXPENSE`) |
    | `parentAccountId`  | UUID/Long (FK,Self) | N    | 상위 계정 ID (계층 구조)                                     |
    | `description`      | Text                | N    | 설명                                                         |
    | `isActive`         | Boolean             | Y    | 사용 여부                                                    |
    | ... (잔액 필드 등) |                     |      |                                                              |

- **`JournalEntry` (전표)**
    | 속성명                 | 데이터 타입       | 필수 | 설명                                                     |
    | :--------------------- | :---------------- | :--- | :------------------------------------------------------- |
    | `entryId`              | UUID/Long (PK)    | Y    | 전표 고유 ID                                             |
    | `entryDate`            | Date              | Y    | 전표일자 (거래 발생일)                                   |
    | `description`          | String            | Y    | 적요 (전표 설명)                                         |
    | `status`               | Enum/String       | Y    | 전표 상태 (`DRAFT`, `CONFIRMED`, `CANCELLED`)            |
    | `entryType`            | Enum/String       | Y    | 전표 유형 (`MANUAL`, `AUTO_FEE`, `AUTO_RENT`, `CLOSING`) |
    | `totalDebit`           | BigDecimal/Double | Y    | 차변 합계 (검증용)                                       |
    | `totalCredit`          | BigDecimal/Double | Y    | 대변 합계 (검증용)                                       |
    | ... (생성/수정일시 등) |                   |      |                                                          |

- **`JournalEntryLine` (전표 라인 / 분개)**
    | 속성명               | 데이터 타입       | 필수 | 설명                                            |
    | :------------------- | :---------------- | :--- | :---------------------------------------------- |
    | `lineId`             | UUID/Long (PK)    | Y    | 분개 라인 고유 ID                               |
    | `entryId`            | UUID/Long (FK)    | Y    | 소속 전표 ID                                    |
    | `accountId`          | UUID/Long (FK)    | Y    | 계정과목 ID                                     |
    | `entrySide`          | Enum/String       | Y    | 차/대변 구분 (`DEBIT`, `CREDIT`)                |
    | `amount`             | BigDecimal/Double | Y    | 금액                                            |
    | `lineDescription`    | String            | N    | 라인별 적요                                     |
    | `relatedPartyId`     | UUID/Long (FK)    | N    | 거래처 ID (Vendor, Tenant, Lessor 등 참조 가능) |
    | ... (부가세 정보 등) |                   |      |                                                 |

### 5. 처리 로직 및 비즈니스 규칙
- **R-ACCMGMT-001 (복식부기 원칙):** 모든 전표는 차변 합계와 대변 합계가 반드시 일치해야 한다.
- **R-ACCMGMT-002 (자동 전표 생성 규칙):**
    - 관리비 부과 확정 시: (차) 미수관리비 / (대) 관리비수익 (항목별 세분화 가능)
    - 관리비/임대료 수납 시: (차) 보통예금 (또는 해당 수납계좌) / (대) 미수관리비 (또는 선수임대료/임대료수익)
    - 비용 지출 시: (차) 해당 비용 계정과목 / (대) 보통예금 (또는 미지급금)
    - (각 연동 기능별로 상세한 자동 분개 규칙 정의 필요)
- **R-ACCMGMT-003 (전표 수정/삭제 제한):** '확정'된 전표 또는 '마감'된 기간의 전표는 원칙적으로 수정/삭제가 제한된다. 수정이 필요할 경우, 반제 전표 또는 수정 전표를 통해 처리하고 모든 이력을 남긴다.
- **R-ACCMGMT-004 (재무제표 집계 로직):**
    - 재무상태표: 특정 시점 기준, 모든 자산, 부채, 자본 계정의 잔액을 집계.
    - 손익계산서: 특정 기간 동안 발생한 모든 수익 및 비용 계정의 변동액을 집계.
- **R-ACCMGMT-005 (회계 마감 로직):**
    - 연차 마감 시, 모든 수익 및 비용 계정의 잔액을 '집합손익' 계정으로 이전하고, '집합손익' 계정의 잔액(당기순이익 또는 순손실)을 '이익잉여금'(또는 '결손금') 계정으로 대체하는 마감 분개를 자동 생성한다.
    - 자산, 부채, 자본 계정의 기말 잔액은 다음 회계연도의 기초 잔액으로 이월한다.

### 6. 오류 처리 및 예외 관리
| 오류 코드 (선택) | 발생 조건                                 | 오류 메시지 (User-facing)                                    |
| :--------------- | :---------------------------------------- | :----------------------------------------------------------- |
| E-ACCMGMT-01     | 전표 입력 시 차/대변 불일치               | "차변 합계와 대변 합계가 일치하지 않습니다."                 |
| E-ACCMGMT-02     | 필수 계정과목/금액 누락                   | "[필드명]은(는) 필수 입력 항목입니다."                       |
| E-ACCMGMT-03     | 존재하지 않거나 비활성 계정과목 사용 시도 | "유효하지 않거나 사용할 수 없는 계정과목입니다: [계정코드/명]" |
| E-ACCMGMT-04     | 마감된 기간의 전표 수정/삭제 시도         | "마감된 기간의 전표는 수정하거나 삭제할 수 없습니다."        |
| E-ACCMGMT-05     | 자동 전표 생성 실패 (필요 데이터 부족 등) | "자동 전표 생성 중 오류가 발생했습니다. (상세 사유 또는 오류 위치)" |

### 7. (기능별) 성능 요구사항
- P-ACCMGMT-01: 전표 조회 (월 1,000건 기준, 복합 조건) 시 3초 이내 응답.
- P-ACCMGMT-02: 총계정원장 조회 (특정 계정 1년치) 시 3초 이내 응답.
- P-ACCMGMT-03: 재무제표(재무상태표/손익계산서) 생성 (1년 기준) 시 5초 이내 완료.
- P-ACCMGMT-04: 연차 마감 처리 (전표 수 10,000건 기준) 시 백그라운드로 10분 이내 완료.

### 8. (기능별) 보안 요구사항
- S-ACCMGMT-01: 회계 관리 기능은 '총괄관리자', '경리담당자' 등 엄격히 인가된 역할만 접근 가능하다. (조회/입력/수정/삭제/마감 등 기능별 권한 세분화)
- S-ACCMGMT-02: 모든 회계 데이터(전표, 장부, 재무제표)는 위변조 방지 대책이 적용되어야 하며, 접근 및 변경 이력은 감사 로그로 상세히 기록된다.
- S-ACCMGMT-03: 중요한 회계 처리(예: 마감, 주요 전표 수정) 시 추가 인증(예: MFA, 비밀번호 재확인)을 요구할 수 있다.

### 9. 다른 기능/모듈과의 연관성
- **관리비 관리 전반 (항목설정, 부과, 고지, 수납):** 관리비 수익 발생, 미수금 관리, 수납 처리 등 모든 과정에서 회계 전표 자동 생성의 대상이 된다.
- **임대 계약 관리 / 임대료 관리:** 임대료 수익 발생, 보증금 관리, 미수 임대료 관리 등에서 회계 전표 자동 생성의 대상이 된다.
- **시설 관리 / 협력업체 관리 (비용 발생 시):** 시설 유지보수 비용, 용역비 등 지출 발생 시 회계 전표 자동 생성 또는 수동 입력 시 참조 데이터를 제공한다.
- **이사 정산 관리:** 보증금 정산, 최종 비용 정산 등의 결과가 회계 처리와 연동된다.
- **납부 정보 설정:** 시스템에 등록된 수납 계좌 정보는 회계 처리 시 예금 계정 과목과 연동될 수 있다.

### 10. (선택 사항) 테스트 고려 사항
- 다양한 거래 유형에 대한 수동/자동 전표 생성 및 분개 정확성 테스트.
- 차/대변 일치 검증 로직 테스트.
- 분개장, 총계정원장 데이터 집계 정확성 테스트.
- 재무상태표, 손익계산서의 각 계정별 금액 집계 및 계산 정확성 검증 (수동 계산 결과와 비교).
- 월별/연차 마감 및 이월 처리 로직의 정확성 테스트 (마감 분개, 잔액 이월).
- 마감된 기간 데이터의 수정/삭제 방지 기능 테스트.
- 다양한 역할에 따른 접근 권한 통제 테스트.

### 11. 용어 정의 (선택 사항)
- **계정과목 (Chart of Accounts):** 회계 거래를 성격에 따라 분류, 기록, 계산하기 위한 항목 (예: 보통예금, 미수관리비, 관리비수익, 지급임차료).
- **전표 (Journal Entry):** 회계상 거래가 발생했을 때, 해당 거래 내용을 차변과 대변으로 나누어 기록하는 기본 단위.
- **분개 (Journalizing):** 거래를 차변 요소와 대변 요소로 구분하여 해당 계정과목과 금액을 결정하는 절차.
- **분개장 (Journal Ledger):** 발생한 모든 거래(전표)를 발생 순서대로 기록한 장부.
- **총계정원장 (General Ledger):** 모든 계정과목에 대해 각각의 계정별로 거래 내역과 잔액을 기록, 관리하는 장부.
- **재무상태표 (Statement of Financial Position / Balance Sheet):** 특정 시점의 기업(건물)의 자산, 부채, 자본 상태를 나타내는 재무 보고서.
- **손익계산서 (Income Statement / Profit and Loss Statement):** 특정 기간의 기업(건물)의 경영 성과(수익, 비용, 이익)를 나타내는 재무 보고서.
- **회계 마감 (Closing):** 특정 회계 기간(월, 분기, 년)의 거래 기록을 마감하고, 재무제표를 확정하며, 다음 기간으로 이월할 잔액을 계산하는 절차.

### 12. 문서 이력
| 버전 | 날짜             | 작성자      | 주요 변경 내용      |
| :--- | :--------------- | :---------- | :------------------ |
| 1.0  | 2025년 06월 03일 | QIRO 기획팀 | 초기 명세서 안 작성 |

---