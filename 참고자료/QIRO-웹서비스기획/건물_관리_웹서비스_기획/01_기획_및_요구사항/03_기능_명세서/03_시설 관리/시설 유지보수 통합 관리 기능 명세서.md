# 🛠️ QIRO - 시설 유지보수 통합 관리 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - 시설 유지보수 통합 관리 기능 명세서
- **기능 ID (선택 사항):** F-FACILITY-OVERALL-001
- **관련 요구사항 ID:** (예: QIRO-FR-FM-001 ~ QIRO-FR-FM-030)
- **관련 사용자 스토리 ID:** (예: US-BM-XXX, US-FMGR-XXX, US-SA-XXX)
- **작성일:** 2025년 07월 15일
- **최종 수정일:** 2025년 07월 15일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
건물 내 주요 시설물(예: 엘리베이터, 소방설비, 냉난방 등)의 자산 정보부터 점검, 수리 등 유지보수 활동, 관련 협력업체 및 비용까지, 시설 관리와 관련된 모든 업무를 하나의 통합된 환경에서 체계적으로 관리한다. 이를 통해 시설물의 안정적인 운영 및 자산 가치 보존, 비용 관리 효율화, 그리고 모든 활동의 투명한 이력 추적을 지원한다.

### 2.2. 설명
본 기능은 시설 관리 업무의 핵심 요소인 **시설물, 작업 이력, 협력업체, 비용/결제**를 유기적으로 연결하여 관리하는 통합 모듈이다. 사용자는 종합 현황 대시보드를 통해 전체 시설 관리 상태를 한눈에 파악하고, 각 세부 탭으로 이동하여 시설물 대장 관리, 작업/점검 이력 등록 및 조회, 협력업체 정보 및 계약/성과 관리, 그리고 관련 비용의 지급 처리까지 일련의 업무를 원활하게 수행할 수 있다.

### 2.3. 범위
- **In-Scope (포함 범위):**
    - **종합 현황 대시보드:** 주요 KPI(총 시설물, 점검 필요, 총 협력업체, 미지급 비용 등) 및 알림 표시.
    - **시설물 관리:** 시설물 정보 CRUD, 점검 주기 설정, 상태 관리.
    - **작업 이력 관리:** 모든 점검, 수리, 유지보수 등 '작업'의 이력 CRUD, 결과 및 비용, 평가 기록.
    - **협력업체 관리:** 협력업체 정보 CRUD, 담당자/계약 정보 관리, 성과(평점 등) 관리.
    - **비용 및 결제 관리:** 유지보수 관련 비용 기록 및 지급 상태 관리.
    - 각 기능 간의 데이터 연동 (예: 작업 기록 시 비용 발생 및 결제 관리 연동).
    - 목록 데이터 내보내기(Export) 기능.
- **Out-of-Scope (제외 범위):**
    - 상세 회계 처리 (본 기능에서 발생한 비용 데이터는 '회계 관리' 모듈로 전달).
    - 자재/부품 재고 관리.
    - IoT 센서 연동 실시간 모니터링 (향후 확장 고려).

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면
- `관리자 포털 > 시설 관리 > 종합 현황` (메인 화면)
- (팝업/모달) 시설물 등록/수정, 작업/점검 기록 등록, 업체 등록, 결제 상세 및 처리 등

### 3.2. UI 요소별 상세 설명 (제공된 이미지 기반 종합)
- **화면 1: 시설 유지보수 종합 현황 화면**
    * **A. KPI 요약 정보 영역:**
        - `총 등록 시설물`, `점검/수리 필요 시설`, `다음 점검 예정 (30일 이내)`, `총 협력 업체`, `계약 만료 임박 업체 (90일 이내)`, `미지급 유지보수 비용` 등 핵심 지표 카드 표시.
    * **B. 주요 알림 영역:**
        - `점검 필요 알림`, `점검 일정 알림` 등 즉각적인 조치가 필요한 사항을 알려주고 관련 화면으로 연결.
    * **C. 필터 및 검색 영역:**
        - `시설물 유형`, `시설물 상태`, `업체 전문 분야`, `작업 유형`, `기간` 등 다양한 조건으로 하단 목록을 필터링할 수 있는 통합 필터 제공.
    * **D. 메인 콘텐츠 탭 영역:**
        1.  **`시설물 관리` 탭:**
            - **액션 버튼:** `[+ 시설물 등록]`
            - **테이블 컬럼:** `시설물명`, `유형`, `위치`, `최근 점검일`, `다음 점검일`, `상태(정상/점검필요 등)`, `관리(상세)`
            - **'상세' 클릭 시:** `시설물 상세 정보` 팝업 표시 (기본 정보, 점검 정보, 최근 작업 이력 요약). 이 팝업 내에서 `[+ 작업/점검 기록 등록]` 버튼 제공.
        2.  **`작업 이력` 탭:**
            - **액션 버튼:** `[+ 작업/점검 기록 등록]`
            - **테이블 컬럼:** `업체명`, `작업일`, `작업 유형`, `관련 시설물`, `결과(정상/수리완료 등)`, `비용`, `평점`, `관리(상세)`
            - **'상세' 클릭 시:** `작업 상세 정보` 팝업 표시 (모든 상세 내용, 평가, 결제 상태 등).
        3.  **`협력업체 관리` 탭:**
            - **액션 버튼:** `[+ 업체 등록]`
            - **테이블 컬럼:** `업체명`, `전문 분야`, `담당자`, `연락처`, `계약 종료일`, `상태`, `평점`, `관리(상세)`
            - **'상세' 클릭 시:** `업체 상세 정보` 팝업 표시 (기본 정보, 계약 정보, 성과 정보). `[작업 이력 보기]` 버튼으로 연동.
        4.  **`비용 및 결제` 탭:**
            - **액션 버튼:** `[+ 비용/결제 등록]` (작업과 무관한 비용 직접 등록 시)
            - **테이블 컬럼:** `업체명`, `지급(예정)일`, `금액`, `내용(관련 작업명)`, `지급 방법`, `상태(지급완료/미지급)`, `관리(상세)`
            - **'상세' 클릭 시:** `결제 상세` 팝업 표시. `[지급 처리]` 버튼으로 상태 변경 가능.

- **화면 2 (모달): 작업/점검 기록 등록 모달 (통합)**
    * **모달 제목:** `작업/점검 기록 등록`
    | UI 요소 ID (선택) | 요소명 (Label) | 유형 (Type)         | 예시/설명                                                    |
    | :---------------- | :------------- | :------------------ | :----------------------------------------------------------- |
    | WR-FRM-01         | 작업 유형      | 드롭다운            | `정기점검`, `긴급수리`, `하자보수`, `일반유지보수` 등 선택   |
    | WR-FRM-02         | 관련 시설물    | 검색/선택           | 시스템에 등록된 시설물 선택                                  |
    | WR-FRM-03         | 수행 업체      | 검색/선택           | 시스템에 등록된 협력업체 선택                                |
    | WR-FRM-04         | 작업일         | 날짜 선택           |                                                              |
    | WR-FRM-05         | 작업자         | 입력 필드           | (업체 담당자명 또는 내부 직원명)                             |
    | WR-FRM-06         | 작업 내용      | 여러 줄 텍스트 영역 |                                                              |
    | WR-FRM-07         | 작업 결과      | 드롭다운            | `정상`, `수리완료`, `점검필요`, `부품교체`, `후속조치필요` 등 선택 |
    | WR-FRM-08         | 발생 비용 (원) | 숫자 입력           |                                                              |
    | WR-FRM-09         | 첨부 파일      | 파일 업로드         | (작업 전/후 사진, 보고서, 영수증 등)                         |
    | WR-FRM-10         | `[저장]` 버튼  | 버튼                |                                                              |

### 3.3. 주요 사용자 시나리오 (통합 워크플로우)
1.  **예방 점검:** 관리자는 `종합 현황` 대시보드에서 '다음 점검 예정' KPI를 확인하고, `시설물 관리` 탭에서 대상 시설물 목록을 조회한다.
2.  **작업 생성 및 업체 지정:** 점검을 수행하기 위해 `작업 이력` 탭에서 `[+ 작업/점검 기록 등록]`을 클릭, `작업 유형`을 '정기점검'으로 선택하고, `협력업체 관리`에 등록된 업체 중 적합한 업체를 지정하여 작업을 생성한다.
3.  **결과 및 비용 기록:** 점검 완료 후, 해당 작업 기록을 열어 `결과`('점검필요' 등)와 `비용`을 업데이트한다.
4.  **비용 지급 처리:** 업데이트된 비용은 자동으로 `비용 및 결제` 탭에 '미지급' 건으로 등록된다. 실제 대금 지급 후, 관리자는 해당 건을 찾아 '지급완료'로 상태를 변경한다.
5.  **후속 조치:** 점검 결과가 '점검필요'였던 시설물은 `시설물 관리` 탭의 목록에서 해당 상태로 표시되며, 이는 다시 새로운 수리 '작업' 생성으로 이어진다.

### 4. 데이터 요구사항
#### 4.1. 주요 엔티티
- `Facility` (시설물)
- `Vendor` (협력업체)
- `VendorContactPerson` (협력업체 담당자)
- `VendorContract` (협력업체 계약)
- **`MaintenanceWorkRecord`** (시설 유지보수 작업 기록 - 점검과 수리를 포괄)
- **`MaintenancePayment`** (유지보수 비용 결제)
- `Attachment` (범용 첨부파일)
- (마스터 데이터: `FacilityType`, `WorkType`, `WorkResultType` 등)

#### 4.2. `MaintenanceWorkRecord` 엔티티 속성 (예시)
| 속성명 (Attribute) | 데이터 타입      | 설명                                                         |
| :----------------- | :--------------- | :----------------------------------------------------------- |
| `workRecordId`     | UUID / Long (PK) | 작업 기록 고유 ID                                            |
| `facilityId`       | UUID / Long (FK) | 관련 시설물 ID                                               |
| `vendorId`         | UUID / Long (FK) | 수행 업체 ID                                                 |
| `workDate`         | Date             | 실제 작업(점검/수리) 수행일                                  |
| `workTypeCode`     | String (Enum)    | 작업 유형 코드 (예: `REGULAR_INSPECTION`, `EMERGENCY_REPAIR`) |
| `workerName`       | String           | 실제 작업자명                                                |
| `workDetails`      | Text             | 작업 상세 내용                                               |
| `workResultCode`   | String (Enum)    | 작업 결과 코드 (예: `NORMAL`, `REPAIR_COMPLETED`, `NEEDS_FOLLOW_UP`) |
| `cost`             | NUMERIC(15, 2)   | 발생 비용                                                    |
| `rating`           | Integer (1-5)    | (선택) 작업 품질에 대한 관리자의 평가 점수                   |
| `ratingComment`    | Text             | (선택) 평가 코멘트                                           |

#### 4.3. `MaintenancePayment` 엔티티 속성 (예시)
| 속성명 (Attribute) | 데이터 타입      | 설명                                     |
| :----------------- | :--------------- | :--------------------------------------- |
| `paymentId`        | UUID / Long (PK) | 결제 기록 고유 ID                        |
| `workRecordId`     | UUID / Long (FK) | 관련 작업 기록 ID (또는 업체 계약 ID 등) |
| `vendorId`         | UUID / Long (FK) | 지급 대상 업체 ID                        |
| `amount`           | NUMERIC(15, 2)   | 지급 금액                                |
| `paymentDate`      | Date             | 실제 지급일                              |
| `paymentMethod`    | String (Enum)    | 지급 방법 (예: `BANK_TRANSFER`, `CASH`)  |
| `status`           | String (Enum)    | 지급 상태 (`UNPAID`, `PAID`)             |

### 5. 처리 로직 및 비즈니스 규칙
- **R-FACILITY-001 (데이터 연동):** `작업 이력`에 0보다 큰 비용(`cost`)이 등록되면, 연관된 `비용 및 결제` 내역이 '미지급' 상태로 자동 생성되어야 한다.
- **R-FACILITY-002 (상태 업데이트):** `작업 이력`의 결과(예: '수리완료', '정상')가 등록되면, 관련된 `시설물`의 상태가 자동으로 '정상'으로 업데이트될 수 있다.
- **R-FACILITY-003 (평가 반영):** `작업 이력`에 평점이 등록되면, 해당 `협력업체`의 `평균 평점`이 재계산되어 업데이트된다.
- **R-FACILITY-004 (알림 생성):** 시설물의 `다음 점검일` 도래, 협력업체의 `계약 종료일` 임박, `점검/수리 필요` 상태 발생 시 '종합 현황' 대시보드에 알림을 생성한다.

### 6. 오류 처리 및 예외 관리
| 오류 코드 (선택) | 발생 조건                              | 오류 메시지 (User-facing)                                    |
| :--------------- | :------------------------------------- | :----------------------------------------------------------- |
| E-FACILITY-01    | 작업 기록 등록 시 필수 항목 누락       | "[필드명]은(는) 필수 입력 항목입니다."                       |
| E-FACILITY-02    | 존재하지 않는 시설물/업체 선택         | "선택한 시설물 또는 협력업체 정보가 유효하지 않습니다."      |
| E-FACILITY-03    | 결제 처리 시 금액 불일치 또는 오류     | "결제 금액이 작업 비용과 일치하지 않거나 유효하지 않습니다." |
| E-FACILITY-04    | 권한 없는 사용자의 중요 정보 수정 시도 | "해당 정보를 수정할 권한이 없습니다."                        |

### 7. (기능별) 성능 요구사항
- P-FACILITY-01: 종합 현황 대시보드 로드 시 (KPI 및 목록 포함) 3초 이내 응답.
- P-FACILITY-02: 각 탭의 목록 조회 (1,000건 기준, 필터 적용) 시 3초 이내 응답.
- P-FACILITY-03: 작업/점검 기록 등 신규 데이터 저장 시 1.5초 이내 처리 완료.

### 8. (기능별) 보안 요구사항
- S-FACILITY-01: 시설 관리 기능의 각 탭(시설물, 작업, 업체, 결제)에 대해 역할별(총괄관리자, 관리소장, 시설 담당, 경리)로 접근 및 수정/삭제 권한을 차등 부여한다.
- S-FACILITY-02: 협력업체 계약서, 비용 증빙 등 민감할 수 있는 첨부 파일은 안전하게 저장하고 접근을 통제한다.
- S-FACILITY-03: 모든 주요 데이터(시설물, 작업, 업체, 결제)의 생성, 수정, 삭제 이력은 감사 로그로 기록하여 추적성을 보장한다.

### 9. 다른 기능/모듈과의 연관성
- **회계 관리:** `비용 및 결제`에서 '지급완료' 처리된 내역은 회계 모듈의 '지출 결의' 또는 관련 비용 계정의 전표로 자동 연동될 수 있다.
- **알림/공지사항 관리:** 본 기능의 알림(점검일 도래, 계약 만료 등)은 '알림 서비스'를 통해 담당자에게 실제 SMS/이메일 등으로 발송될 수 있다.
- **사용자 관리:** 작업/점검의 담당자를 지정할 때, 등록된 내부 직원 정보를 참조한다.

### 10. (선택 사항) 테스트 고려 사항
- 시설물 등록부터 점검/수리 작업 생성, 업체 지정, 비용 입력, 결제 처리, 상태 업데이트까지 이어지는 전체 워크플로우 테스트.
- 각 KPI 및 알림 생성 로직의 정확성 검증.
- 모든 필터 및 검색 조건 조합 테스트.
- 역할별 권한에 따른 기능(버튼 활성화, 데이터 조회 범위 등) 통제 테스트.

### 11. 용어 정의 (선택 사항)
- **시설물 (Facility/Asset):** 건물 내 관리 대상이 되는 물리적 자산 (예: 엘리베이터, 소화전).
- **작업 이력 (Work Record/Order):** 시설물에 대해 수행된 모든 활동(점검, 수리, 교체 등)의 기록.
- **협력업체 (Vendor):** 시설 유지보수 등의 서비스를 제공하는 외부 계약 업체.

### 12. 문서 이력
| 버전 | 날짜             | 작성자      | 주요 변경 내용      |
| :--- | :--------------- | :---------- | :------------------ |
| 1.0  | 2025년 07월 15일 | QIRO 기획팀 | 초기 명세서 안 작성 |