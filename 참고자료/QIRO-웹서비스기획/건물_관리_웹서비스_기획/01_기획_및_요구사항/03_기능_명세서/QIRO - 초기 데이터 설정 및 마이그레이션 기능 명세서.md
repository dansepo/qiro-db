# 🚀 QIRO - 초기 데이터 설정 및 마이그레이션 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - 초기 데이터 설정 및 마이그레이션 기능 명세서
- **기능 ID (선택 사항):** F-ONBOARD-001 (Onboarding & Data Migration)
- **관련 요구사항 ID:** (예: QIRO-FR-SYS-010)
- **관련 사용자 스토리 ID:** (예: US-SA-XXX)
- **작성일:** 2025년 07월 11일
- **최종 수정일:** 2025년 07월 11일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
신규 고객사(건물 관리 회사/사업장)가 QIRO 서비스를 처음 도입할 때, 기존에 수기 또는 다른 방식으로 관리하던 대량의 기초 데이터(건물/호실, 임대인/임차인, 임대차 계약, 기초 잔액 등)를 시스템에 효율적이고 정확하게 등록할 수 있도록 지원한다. 이를 통해 초기 설정에 소요되는 시간을 최소화하고, 서비스 도입의 허들을 낮춘다.

### 2.2. 설명
본 기능은 신규 고객을 위한 **단계별 설정 마법사**와 함께, 대량의 데이터를 손쉽게 이전할 수 있는 **엑셀/CSV 일괄 업로드 기능**을 중심으로 제공된다. 각 데이터 유형별로 QIRO 시스템이 요구하는 표준 템플릿 파일을 제공하며, 관리자는 이 템플릿에 맞춰 데이터를 정리한 후 업로드할 수 있다. 업로드된 파일은 시스템에 의해 유효성이 검증되며, 관리자는 검증 결과 및 데이터 미리보기를 통해 내용을 확인한 후 최종적으로 시스템에 반영(Import)할 수 있다.

### 2.3. 범위
- **In-Scope (포함 범위):**
    - **초기 설정 마법사(Wizard) UI:** 신규 가입 고객에게 초기 설정 단계를 안내하는 가이드 UI.
    - **엑셀/CSV 일괄 업로드 기능:**
        - **대상 데이터:** 건물, 호실, 임대인, 임차인, (현재 유효한) 임대 계약, (QIRO 사용 시작 직전 월의) 최종 미납액, (QIRO 사용 시작 월의) 기초 검침값.
        - 데이터 유형별 **표준 템플릿 파일 제공 (다운로드 기능)**.
        - 업로드 파일 파싱 및 데이터 유효성 검증 로직.
        - **검증 결과 피드백 및 미리보기 UI:** 성공/실패 건수, 오류 상세 내용(행, 열, 사유) 표시.
        - **최종 데이터 등록(Import) 실행:** 검증을 통과한 데이터만 DB에 일괄 생성.
- **Out-of-Scope (제외 범위):**
    - 다른 건물 관리 시스템과의 API를 통한 실시간 자동 데이터 마이그레이션.
    - 데이터 정제(Data Cleansing) 서비스 (업로드 전 데이터 정리 및 형식 통일은 고객이 수행하는 것을 전제로 함).
    - 과거의 모든 계약, 수납, 민원 이력 등의 상세 데이터 마이그레이션 (초기 버전에서는 현재 시점의 유효한 데이터 위주로 마이그레이션).

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면
- `관리자 포털 > 시스템 설정 > 초기 데이터 일괄 등록` (가칭)
- (또는) 신규 가입 고객에게만 보이는 온보딩 프로세스 전용 화면

### 3.2. UI 요소별 상세 설명 (예시 - 데이터 일괄 등록 화면)
* **화면 제목:** `초기 데이터 일괄 등록`
* **화면 부제목:** `QIRO 사용에 필요한 기초 데이터를 엑셀 파일로 한 번에 등록할 수 있습니다. 데이터는 아래 순서에 따라 등록해주세요.`
* **스텝(Step) UI:** 데이터 등록 순서를 안내하는 시각적 요소.
    * `Step 1: 건물/호실 정보` → `Step 2: 임대인/임차인 정보` → `Step 3: 임대 계약 정보` → `Step 4: 기초 잔액 정보`
* **데이터 유형별 업로드 섹션 (각 스텝별):**
    | UI 요소 ID (선택) | 요소명 (Label)               | 유형 (Type)        | 동작 설명                                                    |
    | :---------------- | :--------------------------- | :----------------- | :----------------------------------------------------------- |
    | UPLD-STEP1-01     | **1단계: 건물 및 호실 정보** | 섹션 제목          |                                                              |
    | UPLD-STEP1-02     | `[템플릿 다운로드]`          | 버튼               | 건물/호실 정보 등록용 엑셀 템플릿 파일을 다운로드합니다.     |
    | UPLD-STEP1-03     | `파일 선택`                  | 파일 업로드 컨트롤 | 작성된 템플릿 파일을 선택하여 업로드합니다.                  |
    | UPLD-STEP1-04     | `[업로드 및 검증]`           | 버튼               | 선택된 파일을 서버로 전송하고 데이터 유효성 검증을 시작합니다. |
* **검증 결과 및 미리보기 영역:**
    * **요약 정보:** "총 150건 중, 성공 148건, 실패 2건"
    * **오류 상세 내역:** (실패 건이 있을 경우 표시) 테이블 형태.
        | 행 번호 | 오류 항목 컬럼 | 입력값   | 오류 내용                                |
        | :------ | :------------- | :------- | :--------------------------------------- |
        | 55      | unit_number    | 101호    | '101동'에 이미 존재하는 호실 번호입니다. |
        | 98      | exclusive_area | "84.5평" | 면적은 숫자로만 입력해야 합니다.         |
    * **등록 미리보기:** (성공한 데이터에 대해) 업로드될 데이터의 일부를 테이블 형태로 미리 보여줌.
* **최종 실행 버튼:** `[검증 성공 건 등록하기]`
    * **클릭 시:** 확인 팝업("총 148건의 데이터를 시스템에 최종 등록합니다. 등록 후에는 일괄 수정이 어려우니, 미리보기 내용을 다시 한번 확인해주십시오.") 표시 후, 동의 시 데이터베이스에 일괄 INSERT.

#### 3.3. 주요 사용자 시나리오 (흐름)
- **시나리오 1: 신규 고객사가 호실 정보를 일괄 등록하는 경우**
    1. 관리자가 '초기 데이터 일괄 등록' 화면에 접속하여 "1단계: 건물 및 호실 정보" 섹션으로 이동한다.
    2. `[템플릿 다운로드]` 버튼을 클릭하여 엑셀 템플릿을 받는다.
    3. 기존에 관리하던 건물 및 호실 정보를 템플릿의 각 컬럼(건물명, 동, 호수, 면적 등)에 맞게 정리하여 입력한다.
    4. 작성된 엑셀 파일을 `파일 선택` 컨트롤을 통해 선택하고 `[업로드 및 검증]` 버튼을 클릭한다.
    5. 시스템이 파일 검증 후, "총 150건 중 성공 148건, 실패 2건"과 같은 요약 및 오류 상세 내역을 보여준다.
    6. 관리자는 오류 내역(예: 중복된 호실 번호)을 확인하고, 원본 엑셀 파일을 수정하여 다시 업로드 및 검증 절차를 거친다.
    7. 모든 데이터가 검증에 성공하면(또는 오류 건을 인지하고 성공 건만 등록하기로 결정하면), `[검증 성공 건 등록하기]` 버튼을 클릭한다.
    8. 시스템은 데이터를 최종 등록하고 "148건의 건물/호실 정보가 성공적으로 등록되었습니다." 메시지를 표시한다.
    9. 관리자는 이어서 "2단계: 임대인/임차인 정보" 등록 절차를 진행한다.

## 4. 데이터 요구사항 및 처리 로직
#### 4.1. 데이터 유형별 템플릿 정의
- 각 데이터 유형(건물, 호실, 임대인, 임차인, 계약, 기초잔액)별로 엑셀/CSV 템플릿의 컬럼명, 필수 여부, 데이터 형식, 예시 값을 명확히 정의하고 사용자에게 안내해야 한다.

#### 4.2. 데이터 종속성 및 등록 순서
- 시스템은 데이터의 종속성을 고려하여 정해진 순서대로 등록을 유도해야 한다. 사용자가 순서를 어길 경우 오류를 반환하거나 안내해야 한다.
    1.  **건물 정보:** 가장 먼저 등록되어야 할 마스터 데이터.
    2.  **호실 정보:** 특정 `건물`에 종속되므로, 건물 정보 등록 후에만 가능.
    3.  **임대인 / 임차인 정보:** 독립적인 등록이 가능.
    4.  **임대 계약 정보:** `호실`, `임대인`, `임차인` 정보가 모두 등록되어 있어야 생성 가능.
    5.  **기초 잔액 정보 (미납액, 초기 검침값):** `호실` 또는 `임대 계약` 정보가 등록된 후에 해당 대상에 대한 값을 입력할 수 있다.

#### 4.3. 유효성 검증(Validation) 규칙
- **형식 검증:** 날짜(YYYY-MM-DD), 숫자, 이메일, 연락처 등의 형식을 검증한다.
- **필수값 누락 검증:** 템플릿에서 필수로 지정된 컬럼에 값이 비어있는지 확인한다.
- **참조 데이터 존재 여부 검증 (FK 검증):**
    - 호실 등록 시, 템플릿에 기입된 `building_id`(또는 건물명)가 시스템에 실제로 존재하는지 확인한다.
    - 계약 등록 시, `unit_id`, `lessor_id`, `tenant_id`가 모두 유효한지 확인한다.
- **중복 데이터 검증 (UNIQUE 검증):**
    - 동일 건물 내에 호실 번호가 중복되는지 확인한다.
    - 임대인/임차인 연락처 또는 사업자번호 중복 여부를 확인한다 (정책에 따라).
- **논리적 오류 검증:** 계약 시작일이 종료일보다 늦는 등의 논리적 오류를 검증한다.

#### 4.4. 처리 로직
- **파일 파싱:** 업로드된 Excel/CSV 파일의 내용을 읽어들여 시스템이 처리할 수 있는 데이터 구조로 변환한다.
- **데이터 검증:** 위 4.3의 규칙에 따라 모든 데이터 행을 검증하고, 각 행의 성공/실패 여부 및 실패 사유를 기록한다.
- **미리보기 데이터 생성:** 검증을 통과한 데이터를 기준으로 사용자에게 보여줄 미리보기 데이터를 생성한다.
- **최종 등록 (Import):** 사용자가 최종 확인 후, 검증을 통과한 데이터에 대해 데이터베이스에 일괄 `INSERT` (또는 필요시 `UPDATE`) 작업을 수행한다.
- **롤백(Rollback) 정책:** 일괄 등록 작업 중 일부가 실패했을 때, 이미 성공한 건들을 그대로 둘지(부분 성공), 아니면 모든 작업을 취소하고 원상 복구(전체 롤백)할지 정책을 명확히 정의해야 한다. (일반적으로는 오류 건만 보고하고 성공 건은 반영하는 방식이 사용자에게 유리할 수 있음)

## 5. 보안 요구사항
- **S-ONBOARD-01:** 초기 데이터 등록 기능은 시스템의 모든 기초 데이터를 생성하는 민감한 기능이므로, `총괄관리자` 등 최상위 권한을 가진 역할만 접근 및 실행이 가능해야 한다.
- **S-ONBOARD-02:** 업로드되는 파일에 대해 악성코드 검사를 수행하는 것을 고려한다.
- **S-ONBOARD-03:** 개인정보(연락처 등)가 포함된 파일을 처리하는 동안, 데이터가 안전하게 다뤄지도록 하며, 처리 후 임시 파일 등을 안전하게 삭제한다.

---
이 명세서가 QIRO 서비스의 성공적인 고객 온보딩 기능을 구축하는 데 도움이 되기를 바랍니다. 😊