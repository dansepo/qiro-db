# ⚙️ QIRO - [기능명] 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - [기능명] 기능 명세서
- **기능 ID (선택 사항):** F-[모듈약자]-[일련번호] (예: F-MF-002)
- **관련 요구사항 ID:** (예: QIRO-FR-MF-002 - 월별 관리비 자동 부과)
- **관련 사용자 스토리 ID:** (예: US-PSJ-001, US-LKR-00X)
- **작성일:** 2025년 05월 28일
- **최종 수정일:** 2025년 05월 28일
- **작성자:** (이름 또는 팀)
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
- (이 기능이 사용자에게 제공하는 핵심 가치와 달성하고자 하는 목표를 기술합니다.)
- 예: 관리비 자동 계산 기능은 매월 반복되는 관리비 계산 업무를 자동화하여 관리자의 업무 시간을 단축시키고, 수기 계산으로 인한 오류를 방지하여 정확한 관리비 부과를 지원하는 것을 목적으로 한다.

### 2.2. 설명
- (이 기능이 무엇인지, 어떤 역할을 하는지 전반적으로 설명합니다.)
- 예: 본 기능은 사전에 설정된 관리비 항목, 부과 기준, 세대별 정보 및 검침값 등을 바탕으로 각 세대에 부과될 월별 관리비를 자동으로 계산하고, 그 결과를 관리자가 검토할 수 있도록 제공한다.

### 2.3. 범위
- **In-Scope (포함 범위):**
    - (이 명세서에서 다루는 구체적인 기능 범위를 나열합니다.)
    - 예: 관리비 항목별 금액 자동 계산 로직
    - 예: 세대별 최종 관리비 합산
    - 예: 계산 결과 임시 저장 및 관리자 검토 인터페이스
- **Out-of-Scope (제외 범위):**
    - (이 명세서에서 다루지 않는 관련 기능이나 내용을 명시합니다.)
    - 예: 관리비 고지서 생성 및 발송 기능 (별도 명세서 참조: `관리비_고지서_생성_기능_명세서.md`)
    - 예: 관리비 수납 처리 기능

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면 (또는 화면 영역)
- (이 기능과 관련된 주요 화면 명칭 또는 화면의 특정 영역을 기술합니다. 와이어프레임/목업 문서가 있다면 링크합니다.)
- 예: `관리자 포털 > 관리비 관리 > 월별 관리비 부과 > 자동계산 실행 화면`
- 예: (와이어프레임 링크: `[링크주소]` / Figma 페이지: `[링크주소]`)

### 3.2. UI 요소별 상세 설명 (예시)
| UI 요소 ID (선택) | 요소명 (Label)      | 유형 (Type) | 기본값/표시 데이터 | 동작 설명                                       | 유효성 규칙/제약조건         | 비고                   |
| :---------------- | :------------------ | :---------- | :----------------- | :---------------------------------------------- | :--------------------------- | :--------------------- |
| MF-AC-01          | 부과 기준월         | 드롭다운    | 현재 연도/월       | 사용자가 관리비 계산 대상 연도/월 선택          | 필수 선택                    |                        |
| MF-AC-02          | [계산 실행] 버튼    | 버튼        | -                  | 클릭 시 관리비 자동 계산 로직 실행              | 부과 기준월 선택 필수        | 실행 중 로딩 표시      |
| MF-AC-03          | 계산 결과 요약      | 텍스트 영역 | -                  | 총 부과 세대 수, 총 부과 금액 등 요약 정보 표시 |                              | 계산 완료 후 표시      |
| MF-AC-04          | 세대별 계산 내역 표 | 표          | -                  | 세대번호, 항목별 금액, 총액 등 상세 표시        | 페이지네이션, 정렬 기능 제공 |                        |
| MF-AC-05          | [최종 확정] 버튼    | 버튼        | -                  | 관리자가 계산 결과를 확인하고 최종 부과 확정    | 계산 완료 및 검토 후 활성화  | 확정 시 수정 불가 처리 |

### 3.3. 주요 사용자 시나리오 (흐름)
- **시나리오 1: 관리비 자동 계산 성공**
    1. 관리자가 '월별 관리비 부과' 화면에 접속한다.
    2. 관리자가 '부과 기준월'을 선택한다. (예: 2025년 6월)
    3. 관리자가 [계산 실행] 버튼을 클릭한다.
    4. 시스템은 해당 월의 관리비 항목, 부과 기준, 세대 정보, 검침값 등을 기반으로 세대별 관리비를 계산한다.
    5. 시스템은 계산 완료 후 '계산 결과 요약' 및 '세대별 계산 내역 표'에 결과를 표시한다.
    6. 관리자가 계산 결과를 검토하고 [최종 확정] 버튼을 클릭한다.
    7. 시스템은 해당 월의 관리비 부과 내역을 확정 상태로 저장한다.
- **시나리오 2: 필수 데이터 누락으로 계산 실패**
    1. (1~3 동일)
    2. 시스템이 계산 실행 중 필수 데이터(예: 특정 세대 검침값) 누락을 감지한다.
    3. 시스템은 "OO세대 전기 검침값이 입력되지 않았습니다. 데이터 확인 후 다시 시도해주세요." 와 같은 오류 메시지를 표시한다.
    4. 계산은 중단되며, 결과는 표시되지 않는다.

## 4. 데이터 요구사항
### 4.1. 입력 데이터
- **부과 기준월:** (형식: YYYY-MM, 필수: 예)
- **세대별 검침값 (전기, 수도 등):** (형식: 숫자, 필수: 해당 항목 부과 시 예, 출처: 검침값 입력 화면)
- **관리비 항목별 단가 및 부과 기준:** (출처: 관리비 항목 설정 DB)
- **건물/세대 정보:** (면적, 계약 유형 등, 출처: 건물/세대 정보 DB)

### 4.2. 출력 데이터 (계산 결과)
- **세대별/항목별 부과 금액:** (형식: 숫자, 대상: 화면 표시, DB 저장)
- **세대별 총 부과 금액:** (형식: 숫자, 대상: 화면 표시, DB 저장)
- **계산 실행 로그:** (성공/실패 여부, 오류 메시지 등, 대상: 시스템 로그, DB 저장)

### 4.3. 데이터베이스 관련 사항
- **참조 테이블:** `관리비항목`, `건물정보`, `세대정보`, `검침이력` 등
- **갱신/생성 테이블:** `월별관리비부과내역`, `세대별부과상세` 등

## 5. 처리 로직 및 비즈니스 규칙
### 5.1. 주요 처리 로직
1.  사용자가 선택한 '부과 기준월'을 기준으로 대상 건물/세대를 식별한다.
2.  설정된 각 '관리비 항목'에 대해 정의된 '부과 기준'에 따라 금액을 계산한다.
    - 예: 고정액 항목 → 설정된 금액 그대로 부과
    - 예: 면적 비례 항목 → (단가 * 세대 면적)으로 계산
    - 예: 사용량 비례 항목 → (단가 * 해당 월 사용량(검침값 차이))으로 계산
3.  (공용 관리비 배분 로직이 있다면 상세 기술)
4.  각 세대별로 모든 항목의 계산 금액을 합산하여 '세대별 총 부과 금액'을 산출한다.
5.  계산 과정에서 오류 발생 시 (예: 필수 검침값 누락, 단가 미설정 등), 해당 오류를 기록하고 관리자에게 알린다.

### 5.2. 주요 비즈니스 규칙
- R-MF-001: 모든 관리비 계산은 부가세 포함/미포함 여부를 명확히 구분하여 처리해야 한다. (설정값에 따라)
- R-MF-002: 관리비 계산 시 소수점 처리 규칙은 '반올림하여 정수로 표시'를 기본으로 한다. (또는 특정 규칙 명시)
- R-MF-003: 한번 [최종 확정]된 관리비 내역은 원칙적으로 수정이 불가하며, 수정이 필요할 경우 별도의 '정정 부과' 절차를 따른다. (별도 기능)

## 6. 오류 처리 및 예외 관리
| 오류 코드 (선택) | 발생 조건                             | 오류 메시지 (User-facing)                                    | 시스템 처리 방안                                  |
| :--------------- | :------------------------------------ | :----------------------------------------------------------- | :------------------------------------------------ |
| E-MF-CALC-01     | 필수 검침값 누락                      | "[OO세대] [항목명] 검침값이 입력되지 않았습니다."            | 계산 중단, 해당 오류 항목 관리자에게 안내         |
| E-MF-CALC-02     | 관리비 항목 단가 미설정               | "[항목명]의 단가가 설정되지 않았습니다."                     | 계산 중단, 해당 오류 항목 관리자에게 안내         |
| E-SYS-DB-01      | 데이터베이스 연결 오류 또는 쓰기 실패 | "시스템 오류가 발생했습니다. 잠시 후 다시 시도해주세요. (오류코드: XXXXX)" | 오류 로깅, 관리자 알림, 사용자에게 일반 오류 안내 |

## 7. (기능별) 성능 요구사항
- P-MF-CALC-01: 500세대 기준, 관리비 자동 계산 완료까지 10초 이내 처리.
- P-MF-CALC-02: 계산 결과 조회 화면은 3초 이내 응답.

## 8. (기능별) 보안 요구사항
- S-MF-CALC-01: 관리비 계산 및 확정 기능은 '관리소장' 또는 '경리담당자' 역할 이상의 권한을 가진 사용자만 접근 가능하다.
- S-MF-CALC-02: 관리비 계산 관련 모든 중요 행위(실행, 확정, 오류 등)는 감사 로그(Audit Log)에 기록되어야 한다.

## 9. 다른 기능/모듈과의 연관성
- **선행 기능:** `관리비 항목 설정`, `건물/세대 정보 등록`, `월별 검침값 입력`
- **후행 기능:** `관리비 고지서 생성`, `관리비 수납 처리`, `회계 전표 자동 생성 (선택적)`
- **데이터 의존성:** `건물정보`, `세대정보`, `계약정보`, `검침정보` 데이터에 의존함.

## 10. (선택 사항) 테스트 고려 사항
- 다양한 부과 기준(고정, 면적, 사용량) 조합 테스트
- 대량 세대(예: 1000세대 이상)에 대한 계산 성능 테스트
- 필수 입력값 누락 및 경계값(Boundary value) 입력 시 오류 처리 테스트
- 계산 결과의 정확성 검증 (수동 계산 결과와 비교)

## 11. 용어 정의 (선택 사항)
- **부과 기준월:** 관리비를 산정하고 부과하는 대상이 되는 연도와 월.
- **검침값:** 전기, 수도, 가스 등의 사용량을 측정하여 기록한 값.

## 12. 문서 이력
| 버전 | 날짜       | 작성자 | 주요 변경 내용                 |
| :--- | :--------- | :----- | :----------------------------- |
| 1.0  | 2025-05-28 | (이름) | [기능명] 기능 명세서 초안 작성 |
|      |            |        |                                |

---