# 🏢 QIRO - 건물 정보 상세 관리 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - 건물 정보 상세 관리 기능 명세서
- **기능 ID (선택 사항):** F-BLDGMGMT-001 (Building & Unit Management)
- **관련 요구사항 ID:** (예: QIRO-FR-CORE-001, QIRO-FR-MASTER-001)
- **관련 사용자 스토리 ID:** (예: US-SA-XXX, US-BM-XXX)
- **작성일:** 2025년 06월 03일
- **최종 수정일:** 2025년 06월 03일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
QIRO 시스템에서 관리할 대상인 건물 및 그 하위 단위(예: 동, 층, 호실/세대)의 물리적, 행정적 기본 정보를 정확하고 체계적으로 등록, 조회, 수정, 관리한다. 이는 QIRO 서비스 내 모든 관리 업무(임대, 관리비, 시설, 회계, 민원 등)의 가장 기초가 되는 마스터 데이터를 제공하는 것을 목표로 한다.

### 2.2. 설명
본 기능은 관리자가 신규 건물을 시스템에 등록하는 것부터 시작하여, 해당 건물의 구조(동 구성, 층 정보), 각 개별 호실(세대 또는 상가 등)의 상세 정보(호수, 면적, 유형, 초기 상태 등)를 입력하고 지속적으로 관리(수정, 논리적 삭제 등)할 수 있는 포괄적인 인터페이스와 기능을 제공한다. 등록된 건물 및 호실 정보는 시스템 전반에서 선택 또는 참조되어 활용된다.

### 2.3. 범위
- **In-Scope (포함 범위):**
    - 건물 정보 CRUD: 건물명, 주소, 건물 유형, 연면적, 준공일, 관리 시작일, 대표 이미지/도면 첨부 등.
    - (건물 유형에 따라) 동(棟) 정보 CRUD: 동 명칭/번호, 총 층수 등.
    - 호실/세대 정보 CRUD: 소속 건물/동, 호수, 층, 호실 유형, 전용 면적, 계약 면적, 초기 상태(공실 등) 등.
    - 건물/호실 유형 마스터 데이터 관리 또는 연동(예: 주거용-아파트, 주거용-빌라, 업무시설-오피스, 상업시설-상가 등).
    - (선택) 건물별 주요 공용 시설 목록 기본 정보 등록 (예: 주차장 정보, 커뮤니티 시설 종류 등).
    - 건물 및 호실 목록 조회 (다양한 조건 검색 및 필터링).
    - (선택) 건물/호실 데이터 일괄 등록 및 수정 지원 (Excel 등 활용).
- **Out-of-Scope (제외 범위):**
    - 각 호실의 임대 계약 상세 관리 (이는 "임대 계약 관리" 기능).
    - 각 호실의 관리비 부과 상세 설정 (항목별 설정은 "관리비 항목 관리", 실제 부과는 "관리비 산정" 기능).
    - 개별 시설물(예: 엘리베이터, 소화전)의 점검/유지보수 이력 상세 관리 (이는 "시설 점검 및 유지보수 관리" 기능. 단, 본 기능에서 호실에 기본 설비가 무엇인지 정도는 기록 가능).
    - 건물/호실의 소유주(임대인) 상세 정보 관리 (이는 "임대인 관리" 기능과 연동).
    - 입주민/임차인 상세 정보 관리 (이는 "임차인 관리" 기능과 연동).

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면
- `관리자 포털 > 건물 관리 > 건물 목록 및 등록`
- `관리자 포털 > 건물 관리 > [건물 선택] > 건물 상세 정보 (동/호실 관리 탭 포함)`
- `관리자 포털 > 건물 관리 > [건물 선택] > [동 선택] > 호실 목록 및 등록`
- (모달 또는 별도 페이지) 건물 등록/수정 폼
- (모달 또는 별도 페이지) 동 등록/수정 폼
- (모달 또는 별도 페이지) 호실 등록/수정 폼

### 3.2. UI 요소별 상세 설명 (예시)
- **화면 1: 건물 목록 및 관리 화면**
    | UI 요소 ID (선택) | 요소명 (Label)            | 유형 (Type)  | 기본값/표시 데이터 | 동작 설명                                                    | 비고                              |
    | :---------------- | :------------------------ | :----------- | :----------------- | :----------------------------------------------------------- | :-------------------------------- |
    | BLDG-LST-01       | [건물명] 검색             | 입력 필드    | -                  | 건물명 키워드 검색                                           |                                   |
    | BLDG-LST-02       | [주소] 검색               | 입력 필드    | -                  | 주소 키워드 검색                                             |                                   |
    | BLDG-LST-03       | [건물 유형] 필터          | 드롭다운     | 전체               | 선택된 유형의 건물만 필터링                                  |                                   |
    | BLDG-LST-04       | [검색/필터 적용] 버튼     | 버튼         | -                  | 조건 적용하여 목록 조회                                      |                                   |
    | BLDG-LST-05       | `[+ 신규 건물 등록]` 버튼 | 버튼         | -                  | '건물 등록 폼' 화면/모달 호출                                |                                   |
    | BLDG-LST-06       | 건물 목록                 | 표           | -                  | 건물명, 주소, 건물 유형, 총 동수, 총 세대수, 관리상태, (관리 버튼) 등을 표시 | 정렬, 클릭 시 건물 상세 화면 이동 |
    | BLDG-LST-07       | 페이지네이션              | 페이지네이션 | 1                  | 목록이 많을 경우 페이지 이동                                 |                                   |

- **화면 2: 건물 등록/수정 폼 (모달 또는 페이지)**
    * **탭 구성 가능:** 기본 정보, 동/호실 구성 정보, 첨부파일 등
    | UI 요소 ID (선택) | 요소명 (Label)        | 유형 (Type)    | 예시/설명                           | 유효성 규칙/제약조건                                 |
    | :---------------- | :-------------------- | :------------- | :---------------------------------- | :--------------------------------------------------- |
    | BLDG-FRM-01       | 건물명                | 입력 필드      | 예: QIRO 타워                       | 필수, 최대 100자, (주소와 조합하여 중복 불가 정책)   |
    | BLDG-FRM-02       | 주소                  | 주소 검색      | (우편번호 API 연동, 상세주소 입력)  | 필수                                                 |
    | BLDG-FRM-03       | 건물 유형             | 드롭다운       | 아파트, 오피스텔, 상가, 주상복합 등 | 필수                                                 |
    | BLDG-FRM-04       | 총 동수 (선택)        | 숫자 입력      | (단일 동 건물인 경우 생략 또는 1)   | 숫자                                                 |
    | BLDG-FRM-05       | 총 세대(호실)수       | 숫자 입력      |                                     | 숫자, 하위 등록된 호실 수와 일치 또는 자동계산(정책) |
    | BLDG-FRM-06       | 연면적 (㎡)           | 숫자 입력      |                                     | 숫자 (소수점 허용)                                   |
    | BLDG-FRM-07       | 준공일                | 날짜 선택      |                                     | 날짜 형식                                            |
    | BLDG-FRM-08       | 관리 시작일           | 날짜 선택      |                                     | 날짜 형식                                            |
    | BLDG-FRM-09       | 건물 대표 이미지/도면 | 파일 업로드    | (선택 사항, 다중 파일 가능)         | 파일 형식/크기 제한                                  |
    | BLDG-FRM-10       | 건물주/시행사 (선택)  | 입력 필드/연결 | (임대인 관리 기능과 연동 가능)      |                                                      |
    | BLDG-FRM-11       | 관리 상태             | 드롭다운       | 운영중, 관리 예정, 관리 종료 등     | 필수 (기본값 '운영중')                               |
    | BLDG-FRM-12       | [저장], [취소] 버튼   | 버튼           |                                     |                                                      |

- **화면 3: 호실/세대 목록 및 관리 화면 (특정 건물/동 선택 후 진입)**
    | UI 요소 ID (선택) | 요소명 (Label)            | 유형 (Type)  | 기본값/표시 데이터 | 동작 설명                                                    | 비고                            |
    | :---------------- | :------------------------ | :----------- | :----------------- | :----------------------------------------------------------- | :------------------------------ |
    | UNIT-LST-01       | [호실] 검색               | 입력 필드    | -                  | 호실 번호 검색                                               |                                 |
    | UNIT-LST-02       | [호실 유형] 필터          | 드롭다운     | 전체               | 선택된 유형의 호실만 필터링                                  |                                 |
    | UNIT-LST-03       | [현재 상태] 필터          | 드롭다운     | 전체               | 공실, 임대중 등 상태별 필터링                                |                                 |
    | UNIT-LST-04       | `[+ 신규 호실 등록]` 버튼 | 버튼         | -                  | '호실 등록 폼' 화면/모달 호출                                |                                 |
    | UNIT-LST-05       | `[엑셀로 일괄 등록]` 버튼 | 버튼         | -                  | 엑셀 템플릿 기반 호실 정보 일괄 업로드 기능 호출             |                                 |
    | UNIT-LST-06       | 호실 목록                 | 표           | -                  | (동), 층, 호실번호, 호실유형, 전용면적, 계약면적, 현재상태, (관리 버튼) 등을 표시 | 정렬, 클릭 시 호실 상세 폼 이동 |
    | UNIT-LST-07       | 페이지네이션              | 페이지네이션 | 1                  | 목록이 많을 경우 페이지 이동                                 |                                 |

- **화면 4: 호실/세대 등록/수정 폼 (모달 또는 페이지)**
    | UI 요소 ID (선택) | 요소명 (Label)        | 유형 (Type)                  | 예시/설명                            | 유효성 규칙/제약조건                       |
    | :---------------- | :-------------------- | :--------------------------- | :----------------------------------- | :----------------------------------------- |
    | UNIT-FRM-01       | 소속 동 (선택)        | 드롭다운/텍스트              | (해당 건물의 동 목록 또는 자동 표시) | (다수 동 건물 시 필수)                     |
    | UNIT-FRM-02       | 층                    | 숫자 입력/드롭다운           |                                      | 필수, 숫자                                 |
    | UNIT-FRM-03       | 호실 번호             | 입력 필드                    | 예: 101, B02                         | 필수, 최대 20자, (동 내에서) 중복 불가     |
    | UNIT-FRM-04       | 호실 유형             | 드롭다운                     | 주거용-아파트, 업무시설-오피스 등    | 필수                                       |
    | UNIT-FRM-05       | 전용 면적 (㎡)        | 숫자 입력                    |                                      | 필수, 숫자 (소수점 허용)                   |
    | UNIT-FRM-06       | 계약 면적 (㎡, 선택)  | 숫자 입력                    |                                      | 숫자 (소수점 허용)                         |
    | UNIT-FRM-07       | 현재 상태             | 드롭다운 (읽기전용에 가까움) | 공실, 임대중, 수리중 등              | (주로 임대 계약 상태와 연동되어 자동 변경) |
    | UNIT-FRM-08       | (선택) 연결 임대인    | 검색/선택                    | (임대인 관리 기능과 연동)            |                                            |
    | UNIT-FRM-09       | (선택) 기본 설비 목록 | 체크박스/태그입력            | 에어컨, 냉장고, 주차가능대수 등      |                                            |
    | UNIT-FRM-10       | [저장], [취소] 버튼   | 버튼                         |                                      |                                            |

#### 3.3. 주요 사용자 시나리오 (흐름)
- **시나리오 1: 신규 건물 및 초기 호실 정보 일괄 등록**
    1. 관리자가 '건물 목록 화면'에서 `[+ 신규 건물 등록]` 버튼을 클릭한다.
    2. '건물 등록 폼'에 건물 기본 정보를 입력하고 저장한다.
    3. 저장 후, 해당 건물 상세 화면으로 이동하여 (또는 폼 내에서 바로) `[동 정보 추가]` 또는 `[호실 정보 일괄 등록]` 기능을 선택한다.
    4. (일괄 등록 시) 시스템에서 제공하는 엑셀 템플릿을 다운로드 받아 동, 층, 호실번호, 면적, 유형 등의 정보를 입력한다.
    5. 편집된 엑셀 파일을 업로드하면, 시스템은 데이터 유효성을 검증하고 미리보기 결과를 표시한다.
    6. 관리자가 확인 후 최종 등록하면, 해당 건물의 동 및 호실 정보가 일괄 생성된다.
- **시나리오 2: 특정 건물의 특정 호실 정보 수정**
    1. 관리자가 '건물 목록'에서 대상 건물을 선택하여 상세 화면으로 이동한다.
    2. '호실 목록' 탭(또는 섹션)에서 수정할 호실을 검색하거나 찾아서 선택(또는 수정 아이콘 클릭)한다.
    3. '호실 수정 폼'에 기존 정보가 표시되고, 관리자는 필요한 정보(예: 면적, 유형 변경 등)를 수정한다.
    4. [저장] 버튼을 클릭하여 변경사항을 저장한다.

### 4. 데이터 요구사항
#### 4.1. 입력 데이터
- **건물 정보:** 건물명, 주소(우편번호, 기본주소, 상세주소), 건물 유형 코드, 총 동수, 총 세대수, 연면적, 준공일, 관리 시작일, 건물 대표 이미지/도면 파일, 건물주/시행사 정보, 관리 상태 코드.
- **동 정보:** 동 명칭/번호, 총 층수.
- **호실 정보:** 소속 건물/동 ID, 호실 번호, 층, 호실 유형 코드, 전용 면적, 계약 면적, (초기)상태 코드.

#### 4.2. 출력 데이터 (화면 표시 및 타 기능 연동용)
- 건물 목록, 동 목록, 호실 목록 (각각의 상세 정보 포함).
- 특정 건물/호실의 모든 등록 정보.
- (연계) 공실 현황, 임대 가능 호실 목록 등.

#### 4.3. 주요 엔티티 속성 (예시)
- **`Building` (건물)**
    | 속성명                 | 데이터 타입           | 필수 | 설명                                                  |
    | :--------------------- | :-------------------- | :--- | :---------------------------------------------------- |
    | `buildingId`           | UUID / Long (PK)      | Y    | 건물 고유 ID                                          |
    | `buildingName`         | String                | Y    | 건물명                                                |
    | `address`              | String (복합타입가능) | Y    | 주소 (우편번호, 기본, 상세)                           |
    | `buildingTypeCode`     | String (FK/Enum)      | Y    | 건물 유형 코드 (예: `APT`, `OFFICETEL`, `COMMERCIAL`) |
    | `totalDongCount`       | Integer               | N    | 총 동 수 (단일 동 건물은 1 또는 null)                 |
    | `totalUnitCount`       | Integer               | Y    | 총 세대(호실) 수                                      |
    | `totalFloorArea`       | BigDecimal / Double   | N    | 연면적 (㎡)                                           |
    | `completionDate`       | Date                  | N    | 준공일                                                |
    | `managementStartDate`  | Date                  | Y    | 관리 시작일                                           |
    | `status`               | String (Enum)         | Y    | 건물 관리 상태 (예: `ACTIVE`, `INACTIVE`)             |
    | `mainImageKey`         | String                | N    | 대표 이미지 S3 Key                                    |
    | ... (생성/수정일시 등) |                       |      |                                                       |

- **`BuildingDong` (건물 동 - Building에 One-to-Many, 선택적 사용)**
    | 속성명                 | 데이터 타입      | 필수 | 설명                     |
    | :--------------------- | :--------------- | :--- | :----------------------- |
    | `dongId`               | UUID / Long (PK) | Y    | 동 고유 ID               |
    | `buildingId`           | UUID / Long (FK) | Y    | 소속 건물 ID             |
    | `dongName`             | String           | Y    | 동 명칭 (예: 101동, A동) |
    | `numberOfFloors`       | Integer          | N    | 해당 동의 총 층수        |
    | ... (생성/수정일시 등) |                  |      |                          |

- **`Unit` (호실/세대 - Building 또는 Dong에 One-to-Many)**
    | 속성명                 | 데이터 타입         | 필수 | 설명                                               |
    | :--------------------- | :------------------ | :--- | :------------------------------------------------- |
    | `unitId`               | UUID / Long (PK)    | Y    | 호실 고유 ID                                       |
    | `buildingId`           | UUID / Long (FK)    | Y    | 소속 건물 ID                                       |
    | `dongId`               | UUID / Long (FK)    | N    | (해당 시) 소속 동 ID                               |
    | `unitNumber`           | String              | Y    | 호실 번호 (예: 101, B203)                          |
    | `floor`                | Integer             | Y    | 소재 층                                            |
    | `unitTypeCode`         | String (FK/Enum)    | Y    | 호실 유형 코드 (예: `RES_APT_84`, `OFFICE_A`)      |
    | `exclusiveArea`        | BigDecimal / Double | Y    | 전용 면적 (㎡)                                     |
    | `contractArea`         | BigDecimal / Double | N    | 계약 면적 (㎡)                                     |
    | `currentStatus`        | String (Enum)       | Y    | 현재 상태 (예: `VACANT`, `LEASED`, `UNDER_REPAIR`) |
    | `lessorId`             | UUID / Long (FK)    | N    | (해당 시) 연결된 임대인 ID                         |
    | ... (생성/수정일시 등) |                     |      |                                                    |

- **`BuildingCommonFacility` (건물 공용시설 - Building에 One-to-Many)**
    | 속성명             | 데이터 타입      | 필수 | 설명                                  |
    | :----------------- | :--------------- | :--- | :------------------------------------ |
    | `commonFacilityId` | UUID / Long (PK) | Y    | 공용시설 고유 ID                      |
    | `buildingId`       | UUID / Long (FK) | Y    | 소속 건물 ID                          |
    | `facilityName`     | String           | Y    | 공용시설명 (예: 지하주차장, 1층 로비) |
    | `location`         | String           | N    | 위치 상세                             |
    | `description`      | Text             | N    | 설명 및 비고                          |

*(참고: 건물유형, 호실유형, 건물/호실 상태 등은 별도의 마스터 코드 테이블로 관리하는 것이 좋습니다.)*

### 5. 처리 로직 및 비즈니스 규칙
- **R-BLDGMGMT-001:** 건물 등록 시, (건물명 + 상세주소) 또는 (사업자등록번호 - 건물주 정보 연동 시)를 기준으로 시스템 내 중복 건물을 검사한다.
- **R-BLDGMGMT-002:** 건물 내에서 (동 명칭 + 호실 번호)는 고유해야 한다. 단일 동 건물인 경우 호실 번호만으로 건물 내 고유성을 가진다.
- **R-BLDGMGMT-003:** 건물의 '총 세대(호실)수'는 실제로 등록된 `Unit` 레코드 수와 일치하거나, 관리자가 입력한 값을 기준으로 `Unit` 추가 시 제한을 둘 수 있다 (정책 결정).
- **R-BLDGMGMT-004:** `Unit`의 `currentStatus` (현재 상태)는 "임대 계약 관리" 기능에서의 계약 체결, 만료, 해지 등의 이벤트 발생 시 연동되어 자동으로 업데이트 되어야 한다. (예: 신규 계약 체결 시 '공실' -> '임대중')
- **R-BLDGMGMT-005:** 건물 또는 호실 정보 삭제는 논리적 삭제(예: `status='DELETED'` 또는 `isActive=false`)를 기본으로 하며, 물리적 삭제는 해당 정보와 연결된 중요 데이터(계약, 관리비 내역 등)가 없을 경우에만 제한적으로 허용한다.
- **R-BLDGMGMT-006 (엑셀 일괄 등록/수정 시):**
    - 제공된 템플릿 형식 준수 여부 검증.
    - 데이터 유효성 검증 (필수값, 형식, 중복 등).
    - 오류 발생 시, 상세 오류 내용 및 위치(행, 열)를 사용자에게 피드백. 성공 건만 반영 또는 전체 롤백 (정책 결정).

### 6. 오류 처리 및 예외 관리
| 오류 코드 (선택) | 발생 조건                                      | 오류 메시지 (User-facing)                                    |
| :--------------- | :--------------------------------------------- | :----------------------------------------------------------- |
| E-BLDGMGMT-01    | 필수 입력 항목(건물명, 주소, 호실번호 등) 누락 | "[필드명]은(는) 필수 입력 항목입니다."                       |
| E-BLDGMGMT-02    | 건물 중복 등록 시도                            | "이미 동일한 주소(또는 건물명)의 건물이 존재합니다."         |
| E-BLDGMGMT-03    | 호실 번호 중복 (동일 건물/동 내)               | "해당 건물(동)에 이미 [호실번호]가 존재합니다."              |
| E-BLDGMGMT-04    | 숫자/날짜 필드 형식 오류                       | "[필드명]의 형식이 올바르지 않습니다. (예상 형식: YYYY-MM-DD)" |
| E-BLDGMGMT-05    | (엑셀 업로드) 파일 형식 또는 내용 오류         | "업로드한 파일의 형식이 올바르지 않거나, 내용에 오류가 있습니다." |

### 7. (기능별) 성능 요구사항
- P-BLDGMGMT-01: 건물 목록 조회 (100개 건물 기준) 시 2초 이내 응답.
- P-BLDGMGMT-02: 특정 건물 내 호실 목록 조회 (500개 호실 기준) 시 2초 이내 응답.
- P-BLDGMGMT-03: 건물 또는 호실 정보 저장(생성/수정) 시 1초 이내 처리 완료.
- P-BLDGMGMT-04: 엑셀 파일(500개 호실 정보) 업로드 및 기본 검증 시 30초 이내 완료.

### 8. (기능별) 보안 요구사항
- S-BLDGMGMT-01: 건물 및 호실 정보 관리 기능은 '총괄관리자', '관리소장' 등 인가된 역할만 접근 및 수정 가능하다. (데이터 조회 권한은 더 넓게 부여 가능)
- S-BLDGMGMT-02: 건물 도면, 건물주 정보 등 민감할 수 있는 정보는 접근 권한을 세밀하게 통제한다.
- S-BLDGMGMT-03: 건물 및 호실 정보의 주요 변경 이력은 감사 로그로 기록한다.

### 9. 다른 기능/모듈과의 연관성
- **모든 QIRO 서비스의 근간:** 본 기능에서 등록/관리되는 건물 및 호실 정보는 `임대 계약 관리`, `관리비 관리` (항목 설정, 부과, 고지, 수납), `시설 점검 및 유지보수 관리`, `민원 관리`, `회계 관리` 등 거의 모든 핵심 기능에서 대상 객체로 참조된다.
- **임대인 관리:** 특정 호실 또는 건물의 소유주(임대인) 정보를 연결할 수 있다.
- **임차인 관리:** 특정 호실에 거주하는 임차인 정보를 연결하고, 호실의 `currentStatus`에 영향을 준다.

### 10. (선택 사항) 테스트 고려 사항
- 다양한 건물 유형(단일동, 다수동 아파트, 상가, 오피스텔 등)에 대한 정보 등록 및 관리 테스트.
- 대량 호실 정보 일괄 등록(엑셀) 및 수정 기능 테스트 (성능 포함).
- 호실 상태 변경이 임대 계약 상태와 정확히 연동되는지 테스트.
- 필수값 누락, 데이터 형식 오류, 중복 데이터 입력 등 다양한 예외 상황에 대한 처리 테스트.
- 검색 및 필터링 기능의 정확성 및 성능 테스트.

### 11. 용어 정의 (선택 사항)
- **동 (Dong):** 하나의 건물 단지 내에서 구분되는 개별 건물 단위 (예: 아파트 101동).
- **호실 (Unit):** 건물 또는 동 내부에서 독립적으로 구분되는 최소 공간 단위 (예: 아파트 101호, 상가 A-203호). 세대와 유사한 의미로 사용될 수 있음.
- **전용 면적 (Exclusive Area):** 호실 소유자 또는 임차인이 배타적으로 사용하는 내부 면적.
- **계약 면적 (Contract Area):** 전용 면적에 주거 공용 면적 등을 합산한 면적으로, 분양 또는 임대 계약 시 기준이 되는 면적.

### 12. 문서 이력
| 버전 | 날짜             | 작성자      | 주요 변경 내용      |
| :--- | :--------------- | :---------- | :------------------ |
| 1.0  | 2025년 06월 03일 | QIRO 기획팀 | 초기 명세서 안 작성 |

---