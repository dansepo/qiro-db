# **일회성 비용 부과 기능 상세 가이드**

### **1. 기능 개요**

본 문서는 정기 관리비와 별개로, 예측 불가능한 일회성 이벤트(예: 긴급 수리, 특정 요청 등)로 인해 발생하는 비용을 처리하기 위한 **'일회성 비용 부과' 기능**의 상세한 설계 및 동작 흐름을 정의합니다.

이 기능의 핵심은, 사용자가 `DIRECT_ASSIGNMENT`처럼 단순히 최종 금액만 입력하는 것이 아니라, 기존에 정의된 다양한 **배분/계산 방식(`TOTAL_PER_AREA`, `RATE_PER_QUANTITY` 등)을 일회성으로 적용**할 수 있도록 하는 것입니다.

### **2. '일회성 비용 부과' 화면의 처리 흐름**

관리자는 다음과 같은 단계적 절차를 통해 일회성 비용을 정확하게 부과할 수 있습니다.

#### **Step 1: 부과 사유 입력**

가장 먼저, 이 비용이 왜 발생하는지 명확히 기록합니다. 이 내용은 나중에 고지서에 표시되거나 내부 기록으로 활용됩니다.

- **UI 요소:** **[텍스트 입력 필드] 부과 사유**
- **입력 예시:** "3층 로비 긴급 오염 제거 청소비", "A구역 주차장 라인 재도색 공사비"

#### **Step 2: 부과 대상 지정 (Target Scope Selection)**

이 비용을 부담할 호실 그룹을 지정합니다. 이 로직은 정기 관리비 설정과 동일한 `target_scope` 개념을 사용합니다.

- **UI 요소:** **[드롭다운 메뉴] 부과 대상**
- **선택 옵션:**
  1. **전체 호실** (`ALL_UNITS`)
  2. **계약중인 호실** (`OCCUPIED_UNITS`)
  3. **공실** (`VACANT_UNITS`)
  4. **선택 호실** (`CUSTOM_UNITS`) → **[호실 선택] 버튼** 활성화

#### **Step 3: 계산 방식 선택 및 상세 정보 입력**

지정된 대상 그룹 내에서 비용을 어떻게 계산할지 선택하고, 필요한 값을 입력합니다.

- **UI 요소:** **[드롭다운 메뉴] 계산 방식**
- **선택 옵션 및 동적 UI:**
  - **`TOTAL_PER_AREA` (총액 면적 비례 배분) 선택 시:**
    - [숫자 입력] **총 부과액 (원)**
    - [드롭다운] **배분 기준 면적** (`전용면적`, `공급면적`, `계약면적`)
  - **`RATE_PER_QUANTITY` (수량 기반 단가 배분) 선택 시:**
    - [숫자 입력] **단위당 단가 (원)**
    - [드롭다운] **기준 수량** (`면적`, `차량 대수` 등)
  - **`FIXED_AMOUNT` (고정액 부과) 선택 시:**
    - [숫자 입력] **호실별 고정 부과액 (원)**
  - ... (기타 모든 배분/계산 방식 선택 가능)

#### **Step 4: 미리보기 및 확정**

사용자가 모든 설정을 마치면, 시스템은 최종 부과 전에 각 호실별로 계산된 예상 금액을 명확하게 보여주어 실수를 방지합니다.

- **UI 요소:** **[미리보기 표]** | 호실 번호 | 계산 근거 | 부과 예정 금액 | | :--- | :--- | :--- | | 301호 | 300,000원 × (50㎡/150㎡) | 100,000 원 | | 302호 | 300,000원 × (100㎡/150㎡)| 200,000 원 |
- **최종 동작:** 사용자가 미리보기 내용을 확인한 후 **[부과 확정]** 버튼을 클릭하면, 계산된 금액이 해당 월의 관리비 데이터에 일회성 항목으로 추가됩니다.

### **3. 이 방식의 장점**

- **유연성:** `DIRECT_ASSIGNMENT`의 한계를 넘어, 모든 종류의 일회성 비용 시나리오에 완벽하게 대응할 수 있습니다.
- **재사용성:** 정기 관리비를 위해 이미 정의된 강력한 배분/계산 로직을 그대로 재사용하므로 개발 효율성이 높습니다.
- **정확성:** 복잡한 배분 계산을 시스템이 자동으로 처리하고, 미리보기를 통해 검증하므로 수동 계산 오류를 원천적으로 방지합니다.

이처럼 **'일회성 비용 부과' 기능을 별도로 구현**하는 것이, 관리비 부과 시스템의 완성도를 결정하는 핵심적인 설계 포인트가 될 것입니다.