# 💳 QIRO - 납부 정보 설정 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - 납부 정보 설정 기능 명세서
- **기능 ID (선택 사항):** F-PAYINFO-001 (Payment Information Setup)
- **관련 요구사항 ID:** (예: QIRO-FR-CFG-001, QIRO-FR-CFG-002)
- **관련 사용자 스토리 ID:** (예: US-SA-XXX, US-BM-XXX)
- **작성일:** 2025년 06월 02일
- **최종 수정일:** 2025년 06월 02일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
관리비 및 기타 수납 항목에 대한 입금 계좌 정보, 정기적인 납부 마감일, 그리고 미납 시 적용될 연체료율 등 핵심적인 납부 관련 정책 및 정보를 설정하고 관리한다. 이를 통해 생성되는 고지서에 정확한 납부 안내 정보를 제공하고, 일관된 미납 및 연체 관리 기준을 시스템 전반에 적용한다.

### 2.2. 설명
본 기능은 관리자가 관리비 수납을 위한 하나 이상의 은행 계좌 정보를 등록, 수정, 삭제하고 그중 하나를 '기본 수납 계좌'로 지정할 수 있도록 한다. 또한, 매월 관리비 납부의 기준이 되는 마감일을 설정하고, 납부 마감일 경과 후 미납된 금액에 대해 적용할 연체료율을 정의한다. 여기서 설정된 정보는 고지서 생성, 미납 알림, 연체료 계산 등 다양한 기능에서 참조된다.

### 2.3. 범위
- **In-Scope (포함 범위):**
    - 관리비 수납 계좌 정보 CRUD (은행명, 계좌번호, 예금주, 용도).
    - 기본 수납 계좌 지정 및 변경 기능.
    - 월별 관리비 납부 마감일(일자) 설정.
    - 미납 시 적용될 연체료율(%) 설정.
- **Out-of-Scope (제외 범위):**
    - 은행 시스템과의 실시간 연동을 통한 계좌 유효성 검증 또는 자동 입금 확인 (본 기능은 정보 등록 및 설정에 집중).
    - 개별 고지서에 납부 정보를 삽입하는 로직 자체 (본 기능은 설정값을 제공, 실제 삽입은 "고지서 발급" 기능에서 담당).
    - 연체료의 상세 계산 로직 및 부과 실행 (본 기능은 '연체료율'만 설정, 실제 계산 및 부과는 "미납/연체 관리" 또는 "관리비 산정" 기능에서 담당).
    - 다수의 건물 또는 사업장별로 각기 다른 납부 정보 설정 (본 명세서는 시스템 전반 또는 단일 사업장 기준의 설정을 가정. 다중 사업장 지원 시 범위 확장 필요).

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면
- `관리자 포털 > 관리비 설정 > 납부 정보 설정` (탭)
    - (상위 탭 구조: 관리비 항목 | 외부 고지서 관리 | **납부 정보 설정**)

### 3.2. UI 요소별 상세 설명 (제공된 이미지 기반)
- **화면 1: 납부 정보 설정 메인 화면 (`납부정보설정 2025-06-02 오후 5.55.04.png` 참조)**
    * **A. 화면 제목 및 부제목:** "납부 정보 설정", "관리비 납부 관련 정보를 설정합니다."
    * **B. 관리비 수납 계좌 섹션:**
        - **섹션 제목 (암시적):** 관리비 수납 계좌
        | UI 요소 ID (선택) | 요소명 (Label)       | 유형 (Type) | 기본값/표시 데이터 | 동작 설명                                                    | 비고                                               |
        | :---------------- | :------------------- | :---------- | :----------------- | :----------------------------------------------------------- | :------------------------------------------------- |
        | PI-ACC-LST-01     | 수납 계좌 목록       | 카드/리스트 | -                  | 등록된 각 수납 계좌 정보를 표시 (은행명, 계좌번호, 예금주, 용도, 기본계좌 여부 배지) |                                                    |
        | (목록 내 항목)    | 은행명               | 텍스트      | (예: 우리은행)     |                                                              |                                                    |
        | (목록 내 항목)    | 계좌번호             | 텍스트      | (예: 123-...)      |                                                              |                                                    |
        | (목록 내 항목)    | 예금주               | 텍스트      | (예: 센트럴...)    |                                                              |                                                    |
        | (목록 내 항목)    | 용도                 | 텍스트      | (예: 관리비 수납)  |                                                              |                                                    |
        | (목록 내 항목)    | [기본 계좌] 배지     | 배지        | -                  | 해당 계좌가 기본 수납 계좌임을 표시                          | 하나의 계좌에만 표시                               |
        | (목록 내 항목)    | [수정] 아이콘 버튼   | 아이콘 버튼 | (연필 모양)        | 클릭 시 해당 계좌 정보를 수정하는 '관리비 수납 계좌 수정' 모달 팝업 표시 |                                                    |
        | (목록 내 항목)    | [삭제] 아이콘 버튼   | 아이콘 버튼 | (휴지통 모양)      | 클릭 시 해당 계좌 삭제 확인 팝업 표시 후, 확인 시 삭제 처리  | 기본 계좌는 삭제 전 다른 계좌를 기본으로 지정 유도 |
        | PI-ACC-ADD-01     | `[+ 계좌 추가]` 버튼 | 버튼        | -                  | 클릭 시 '관리비 수납 계좌 추가' 모달 팝업 표시               |                                                    |
    * **C. 납부 마감일 설정 섹션:**
        - **섹션 제목:** 납부 마감일 설정
        | UI 요소 ID (선택) | 요소명 (Label) | 유형 (Type) | 기본값/표시 데이터 | 동작 설명                                                 | 유효성 규칙/제약조건 |
        | :---------------- | :------------- | :---------- | :----------------- | :-------------------------------------------------------- | :------------------- |
        | PI-DUE-01         | 매월           | 텍스트      | 매월               | 고정 텍스트                                               |                      |
        | PI-DUE-02         | (일자 입력)    | 숫자 입력   | (예: 25)           | 납부 마감일(일)을 숫자로 입력 (1~31 또는 말일)            | 1~31 또는 '말일'     |
        | PI-DUE-03         | 일             | 텍스트      | 일                 | 고정 텍스트                                               |                      |
        | PI-DUE-SUB        | (안내 문구)    | 텍스트      | (이미지 참조)      | "설정된 날짜까지 납부되지 않은 경우 미납으로 처리됩니다." |                      |
    * **D. 연체료 설정 섹션:**
        - **섹션 제목:** 연체료 설정
        | UI 요소 ID (선택) | 요소명 (Label) | 유형 (Type) | 기본값/표시 데이터 | 동작 설명                                                    | 유효성 규칙/제약조건       |
        | :---------------- | :------------- | :---------- | :----------------- | :----------------------------------------------------------- | :------------------------- |
        | PI-LATE-01        | 연체료율       | 숫자 입력   | (예: 3)            | 연체료율을 백분율(%) 숫자로 입력                             | 숫자, 0 이상 (소수점 허용) |
        | PI-LATE-02        | %              | 텍스트      | %                  | 고정 텍스트                                                  |                            |
        | PI-LATE-SUB       | (안내 문구)    | 텍스트      | (이미지 참조)      | "납부 마감일 이후 미납 금액에 대해 적용되는 연체료율입니다." |                            |
    * **(화면 하단에 [저장] 버튼이 있을 것으로 예상 - 이미지에는 보이지 않음)**

- **화면 2 (모달): 관리비 수납 계좌 추가 (`납부정보설정 2025-06-02 오후 5.55.31.png` 참조)**
    * **모달 제목:** 관리비 수납 계좌 추가
    * **모달 부제목:** 새로운 관리비 수납 계좌를 추가합니다. 계좌 정보를 정확히 입력해주세요.
    | UI 요소 ID (선택) | 요소명 (Label) | 유형 (Type) | Placeholder/기본값                                        | 유효성 규칙/제약조건                       |
    | :---------------- | :------------- | :---------- | :-------------------------------------------------------- | :----------------------------------------- |
    | PI-ACCADD-01      | 은행명         | 입력 필드   | 은행명을 입력하세요                                       | 필수, 최대 50자                            |
    | PI-ACCADD-02      | 계좌번호       | 입력 필드   | 계좌번호를 입력하세요                                     | 필수, 계좌번호 형식(숫자,하이픈), 중복불가 |
    | PI-ACCADD-03      | 예금주         | 입력 필드   | 예금주를 입력하세요                                       | 필수, 최대 50자                            |
    | PI-ACCADD-04      | 용도           | 입력 필드   | 계좌 용도를 입력하세요 (예: 관리비 수납, 수선유지비 적립) | 최대 100자                                 |
    | PI-ACCADD-05      | 기본 계좌      | 체크박스    | (체크 해제)                                               | "기본 수납 계좌로 설정" 레이블             |
    | PI-ACCADD-BTN-01  | [취소]         | 버튼        | -                                                         |                                            |
    | PI-ACCADD-BTN-02  | [추가]         | 버튼        | -                                                         |                                            |

- **화면 3 (모달): 관리비 수납 계좌 수정 (`납부정보설정 2025-06-02 오후 5.55.15.png` 참조)**
    * **모달 제목:** 관리비 수납 계좌 수정
    * **모달 부제목:** 계좌 정보를 수정합니다. 정보를 정확히 입력해주세요.
    * (입력 필드는 '계좌 추가' 모달과 동일하나, 기존 값으로 채워져 있음)
    * **버튼:** `[취소]`, `[저장]`

#### 3.3. 주요 사용자 시나리오 (흐름)
- **시나리오 1: 신규 수납 계좌 등록 및 기본 계좌로 지정**
    1. 관리자가 '납부 정보 설정' 화면의 '관리비 수납 계좌' 섹션에서 `[+ 계좌 추가]` 버튼을 클릭한다.
    2. '관리비 수납 계좌 추가' 모달이 표시된다.
    3. 관리자가 은행명, 계좌번호, 예금주, 용도를 입력하고, '기본 계좌' 체크박스를 선택한다.
    4. [추가] 버튼을 클릭한다.
    5. 시스템은 유효성 검사(계좌번호 중복 등) 후 정보를 저장하고, "수납 계좌가 성공적으로 추가되었습니다." 메시지를 표시한다. 모달이 닫히고 목록이 갱신되며, 새로 추가된 계좌가 '기본 계좌'로 표시된다 (기존 기본 계좌는 일반 계좌로 변경).
- **시나리오 2: 납부 마감일 및 연체료율 변경**
    1. 관리자가 '납부 정보 설정' 화면에 접속한다.
    2. '납부 마감일 설정' 섹션에서 일자 입력 필드의 값을 수정한다 (예: 25일 -> 말일).
    3. '연체료 설정' 섹션에서 연체료율 입력 필드의 값을 수정한다 (예: 3% -> 2.5%).
    4. 화면 하단의 [저장] 버튼(가정)을 클릭한다.
    5. 시스템은 변경된 설정을 저장하고, "납부 정보가 성공적으로 업데이트되었습니다." 메시지를 표시한다.

### 4. 데이터 요구사항
#### 4.1. 입력 데이터
- **수납 계좌:** 은행명, 계좌번호, 예금주, 용도, 기본 계좌 지정 여부.
- **납부 마감일:** 매월 납부 마감 일자 (숫자: 1~31, 또는 '말일' 코드).
- **연체료율:** 백분율(%) 값 (숫자, 소수점 가능).

#### 4.2. 출력 데이터 (화면 표시용)
- 등록된 수납 계좌 목록 (각 계좌 상세 정보 포함).
- 현재 설정된 납부 마감일.
- 현재 설정된 연체료율.

#### 4.3. 관리비 수납 계좌 (ReceivingBankAccount) 엔티티 속성 (예시)
| 속성명 (Attribute)     | 데이터 타입 (Type) | 필수 | 설명                                       |
| :--------------------- | :----------------- | :--- | :----------------------------------------- |
| `accountId`            | UUID / Long (PK)   | Y    | 수납 계좌 고유 ID                          |
| `bankName`             | String(50)         | Y    | 은행명                                     |
| `accountNumber`        | String(50)         | Y    | 계좌번호 (암호화 저장 권장)                |
| `accountHolder`        | String(50)         | Y    | 예금주명                                   |
| `purpose`              | String(100)        | N    | 계좌 용도 (예: 관리비, 선수금, 수선충당금) |
| `isDefault`            | Boolean            | Y    | 기본 수납 계좌 여부 (기본값 `false`)       |
| `isActive`             | Boolean            | Y    | 사용 여부 (기본값 `true`)                  |
| ... (생성/수정일시 등) |                    |      |                                            |

#### 4.4. 납부 정책 (PaymentPolicy) 엔티티 또는 시스템 설정값 (예시)
| 속성명 (Attribute)     | 데이터 타입 (Type) | 필수 | 설명                                     |
| :--------------------- | :----------------- | :--- | :--------------------------------------- |
| `policyId`             | UUID / Long (PK)   | Y    | 정책 고유 ID (단일 레코드 또는 설정 키)  |
| `paymentDueDay`        | Integer / String   | Y    | 매월 납부 마감일 (1~31, 또는 'LAST_DAY') |
| `lateFeeRate`          | BigDecimal / Float | Y    | 연체료율 (%) (예: 3.0은 3%)              |
| ... (생성/수정일시 등) |                    |      |                                          |

### 5. 처리 로직 및 비즈니스 규칙
- **R-PAYINFO-001:** 시스템 내에는 최소 하나 이상의 '활성' 상태인 수납 계좌가 존재해야 한다.
- **R-PAYINFO-002:** '기본 수납 계좌'는 오직 하나만 지정될 수 있다. 다른 계좌를 기본으로 설정하면, 기존 기본 계좌는 자동으로 일반 계좌로 변경된다.
- **R-PAYINFO-003:** '기본 수납 계좌'는 삭제할 수 없다. 삭제하려면 먼저 다른 계좌를 기본으로 지정해야 한다. (또는, 마지막 남은 계좌는 삭제 불가).
- **R-PAYINFO-004:** 계좌번호는 시스템(또는 사업장 범위) 내에서 고유해야 한다.
- **R-PAYINFO-005:** 납부 마감일은 매월 반복 적용되는 일자(1~31) 또는 '말일'과 같은 특정 규칙으로 설정된다.
- **R-PAYINFO-006:** 연체료율은 0% 이상으로 설정 가능하며, 소수점 이하 자릿수를 지원할 수 있다.
- **R-PAYINFO-007:** 여기서 설정된 납부 정보(기본 계좌, 납부 마감일)는 '고지서 발급' 시 고지서 내용에 자동으로 반영된다.
- **R-PAYINFO-008:** 여기서 설정된 납부 마감일과 연체료율은 '미납/연체 관리' 및 '연체료 계산' 로직의 기준으로 사용된다.

### 6. 오류 처리 및 예외 관리
| 오류 코드 (선택) | 발생 조건                                        | 오류 메시지 (User-facing)                                    |
| :--------------- | :----------------------------------------------- | :----------------------------------------------------------- |
| E-PAYINFO-01     | 필수 입력 항목(은행명, 계좌번호, 예금주 등) 누락 | "[필드명]은(는) 필수 입력 항목입니다."                       |
| E-PAYINFO-02     | 계좌번호 형식 오류 또는 이미 등록된 계좌번호     | "계좌번호 형식이 올바르지 않거나 이미 등록된 계좌번호입니다." |
| E-PAYINFO-03     | 납부 마감일 또는 연체료율 형식/범위 오류         | "납부 마감일(또는 연체료율) 값이 유효하지 않습니다."         |
| E-PAYINFO-04     | 기본 계좌 삭제 시도 (대체 기본 계좌 없을 시)     | "기본 계좌는 삭제할 수 없습니다. 다른 계좌를 먼저 기본 계좌로 지정해주세요." |

### 7. (기능별) 성능 요구사항
- P-PAYINFO-01: 납부 정보 설정 화면 로드 및 현재 설정값 표시 1초 이내.
- P-PAYINFO-02: 수납 계좌 정보 저장(추가/수정) 및 납부 정책(마감일, 연체료율) 저장 시 1초 이내 처리 완료.

### 8. (기능별) 보안 요구사항
- S-PAYINFO-01: 납부 정보 설정 기능은 '총괄관리자' 또는 권한을 위임받은 '경리담당자' 등 인가된 역할만 접근 및 수정 가능하다.
- S-PAYINFO-02: 수납 계좌번호 등 민감한 금융 정보는 안전하게 관리되며, 변경 이력은 감사 로그로 기록된다.

### 9. 다른 기능/모듈과의 연관성
- **고지서 발급:** 본 기능에서 설정된 '기본 수납 계좌' 정보와 '납부 마감일'은 생성되는 관리비 고지서에 자동으로 포함된다.
- **미납/연체 관리:** 본 기능에서 설정된 '납부 마감일'은 미납 발생 여부를 판단하는 기준이 되며, '연체료율'은 실제 연체료를 계산하는 데 사용된다.
- **수납 처리:** 임차인이 납부한 관리비가 어떤 계좌로 입금되었는지 확인하거나, 시스템 내에서 입금 처리 시 참조 정보로 활용될 수 있다.
- **회계 관리:** 등록된 수납 계좌들은 회계 처리 시 입출금 계좌로 연동될 수 있다.

### 10. (선택 사항) 테스트 고려 사항
- 다양한 은행/계좌 정보로 수납 계좌 CRUD 기능 테스트.
- 기본 수납 계좌 지정, 변경, 삭제(제한 조건 포함) 시나리오 테스트.
- 납부 마감일 설정(1일, 31일, 말일 등) 및 유효성 검증 테스트.
- 연체료율 설정(0%, 소수점 포함 값 등) 및 유효성 검증 테스트.
- 설정된 납부 정보가 고지서 생성 및 연체료 계산 로직에 정확하게 반영되는지 연계 테스트.

### 11. 용어 정의 (선택 사항)
- **수납 계좌 (Receiving Bank Account):** 관리비, 임대료 등 입주민/임차인으로부터 납부금을 수령하는 데 사용되는 은행 계좌.
- **기본 수납 계좌 (Default Receiving Account):** 여러 수납 계좌 중 고지서 등에 우선적으로 안내되는 대표 계좌.
- **납부 마감일 (Payment Due Date):** 해당 월의 관리비 등을 납부해야 하는 최종 기한일.
- **연체료율 (Late Fee Rate):** 납부 마감일까지 미납된 금액에 대해 부과되는 이율(%).

### 12. 문서 이력
| 버전 | 날짜             | 작성자      | 주요 변경 내용                                     |
| :--- | :--------------- | :---------- | :------------------------------------------------- |
| 1.0  | 2025년 06월 02일 | QIRO 기획팀 | 납부 정보 설정 기능 명세서 초안 작성 (이미지 기반) |

---