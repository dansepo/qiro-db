# ⚙️ QIRO - 시스템 환경설정 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - 시스템 환경설정 기능 명세서
- **기능 ID (선택 사항):** F-SYSCONFIG-001 (System Configuration Management)
- **관련 요구사항 ID:** (예: QIRO-FR-CFG-001 ~ QIRO-FR-CFG-010)
- **관련 사용자 스토리 ID:** (예: US-SA-XXX)
- **작성일:** 2025년 06월 03일
- **최종 수정일:** 2025년 06월 03일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
QIRO 서비스의 전반적인 운영 환경, 기본 정책, 사용자 인터페이스 표시 방식, 외부 서비스 연동 정보 등을 시스템 관리자(주로 총괄관리자)가 설정하고 관리할 수 있도록 한다. 이를 통해 각 고객사(건물 관리 회사/사업장)의 특성에 맞는 서비스 환경을 구축하고, 일관된 업무 처리 기준을 마련하며, 서비스의 사용성과 효율성을 증진시킨다.

### 2.2. 설명
본 기능은 QIRO 서비스의 운영에 필요한 다양한 시스템 수준의 파라미터를 설정하는 관리자 인터페이스를 제공한다. 주요 설정 항목으로는 회사(사업장) 기본 정보, 로고, 기본 언어 및 날짜/숫자 형식, 관리비/임대료 관련 기본 정책(예: 납부 마감일 기본값, 연체료율 기본값), 알림 발송 기본 설정, 외부 연동 서비스(SMS, 이메일 등) 계정 정보 등이 포함된다. 여기서 설정된 값들은 서비스 내 다른 기능들의 기본값 또는 운영 기준으로 활용된다.

### 2.3. 범위
- **In-Scope (포함 범위):**
    - **회사/사업장 정보 관리:** 관리 회사/사업장 명칭, 사업자등록번호, 대표자명, 주소, 연락처, 로고 이미지 업로드 및 관리.
    - **기본 표시 설정:** 기본 언어(다국어 지원 시), 기본 시간대, 날짜 형식, 숫자 형식, 기본 통화 설정.
    - **관리비/임대료 정책 기본값 설정:**
        - (참고: "납부 정보 설정" 기능에서 상세 관리되는) 수납 계좌 관리 기능으로의 링크 또는 요약 정보.
        - 월별 납부 마감일 기본값 설정 (예: 매월 25일).
        - 연체료율 기본값(%) 및 연체료 계산 방식 기본값(예: 단리, 일할) 설정.
        - 관리비/임대료 계산 시 반올림/절사 등 숫자 처리 정책 기본값.
    - **알림 기본 설정:**
        - 시스템 알림 발송 기본 이메일 주소 및 발신자명.
        - SMS/LMS 발송 기본 발신 번호 (사전 인증된 번호).
        - (선택) 주요 알림 유형별 기본 활성화 여부.
    - **외부 서비스 연동 설정 (제한적):**
        - SMS 발송 서비스 연동 정보 (API 키 등 - 안전하게 저장 및 관리).
        - 이메일 발송 서비스(예: AWS SES) 연동 정보.
    - **(선택적 고급 기능) 기능 활성화/비활성화 토글:** 특정 부가 기능 모듈의 사용 여부 설정.
- **Out-of-Scope (제외 범위):**
    - 사용자별 개인화 설정 (이는 각 사용자 프로필 설정에서 다룸).
    - 각 기능 모듈의 상세 운영 데이터 설정 (예: 관리비 항목 상세 설정, 임대 계약 조건 설정 등은 각 해당 기능에서 직접 관리). 본 기능은 '시스템 전반의 기본값' 또는 '정책'에 집중.
    - 서버 인프라, 데이터베이스 등 하드웨어/플랫폼 수준의 환경 설정.
    - 보안 정책의 상세 항목 설정 (예: 비밀번호 최소 길이, MFA 강제 여부 등은 "사용자 계정 및 역할/권한 관리" 또는 "보안 정책" 문서에서 정의되고, 본 기능은 해당 정책을 따름).

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면
- `관리자 포털 > 시스템 관리 > 환경설정` (또는 `설정 > 전체 설정`)
    - 하위 탭 또는 섹션: `회사 정보`, `기본 표시 설정`, `납부/연체 정책`, `알림 설정`, `외부 서비스 연동` 등.

### 3.2. UI 요소별 상세 설명 (예시)
- **화면 1: 시스템 환경설정 메인 화면 (탭 구조)**
    * **탭 1: 회사 정보**
        | UI 요소 ID (선택) | 요소명 (Label)     | 유형 (Type) | 예시/설명                         |
        | :---------------- | :----------------- | :---------- | :-------------------------------- |
        | SC-COMP-01        | 회사/사업장명      | 입력 필드   |                                   |
        | SC-COMP-02        | 사업자등록번호     | 입력 필드   |                                   |
        | SC-COMP-03        | 대표자명           | 입력 필드   |                                   |
        | SC-COMP-04        | 주소               | 주소 검색   |                                   |
        | SC-COMP-05        | 대표 전화번호      | 입력 필드   |                                   |
        | SC-COMP-06        | 대표 이메일        | 입력 필드   |                                   |
        | SC-COMP-07        | 회사 로고          | 파일 업로드 | (지정된 크기/형식, 미리보기 지원) |
        | SC-COMP-BTN       | `[회사 정보 저장]` | 버튼        |                                   |
    * **탭 2: 기본 표시 설정**
        | UI 요소 ID (선택) | 요소명 (Label)     | 유형 (Type) | 예시/옵션                             |
        | :---------------- | :----------------- | :---------- | :------------------------------------ |
        | SC-DISP-01        | 기본 언어          | 드롭다운    | 한국어, English (다국어 지원 시)      |
        | SC-DISP-02        | 시간대             | 드롭다운    | Asia/Seoul 등                         |
        | SC-DISP-03        | 날짜 표시 형식     | 드롭다운    | YYYY-MM-DD, MM/DD/YYYY 등             |
        | SC-DISP-04        | 숫자 표시 형식     | 드롭다운    | 1,234.56 / 1.234,56 등                |
        | SC-DISP-05        | 기본 통화          | 드롭다운    | KRW, USD 등 (기본 KRW 고정일 수 있음) |
        | SC-DISP-BTN       | `[표시 설정 저장]` | 버튼        |                                       |
    * **탭 3: 납부/연체 정책 설정** (일부는 "납부 정보 설정" 기능과 연동 또는 해당 기능으로의 링크 제공)
        | UI 요소 ID (선택) | 요소명 (Label)          | 유형 (Type) | 예시/설명                                 |
        | :---------------- | :---------------------- | :---------- | :---------------------------------------- |
        | SC-PAY-01         | 수납 계좌 관리          | 링크/버튼   | "납부 정보 설정 > 수납 계좌 관리로 이동"  |
        | SC-PAY-02         | 납부 마감일 기본값      | 숫자 입력   | 매월 [XX] 일 (1~31 또는 '말일' 선택 옵션) |
        | SC-PAY-03         | 연체료율 기본값 (%)     | 숫자 입력   | 예: 3.0 (%)                               |
        | SC-PAY-04         | 연체료 계산 방식 기본값 | 드롭다운    | 단리 일할 계산, (기타 방식)               |
        | SC-PAY-BTN        | `[납부 정책 저장]`      | 버튼        |                                           |
    * **탭 4: 알림 설정**
        | UI 요소 ID (선택) | 요소명 (Label)               | 유형 (Type) | 예시/설명                                           |
        | :---------------- | :--------------------------- | :---------- | :-------------------------------------------------- |
        | SC-NOTI-01        | 기본 발신 이메일 주소        | 입력 필드   | 예: qiro-notice@company.com                         |
        | SC-NOTI-02        | 기본 발신자명 (메일)         | 입력 필드   | 예: QIRO 관리 시스템                                |
        | SC-NOTI-03        | SMS 발신번호                 | 입력 필드   | (사전 인증된 번호, 변경 시 재인증 필요)             |
        | SC-NOTI-04        | (알림 유형별 상세 설정 링크) | 링크/버튼   | "알림 및 공지사항 관리 > 시스템 알림 설정으로 이동" |
        | SC-NOTI-BTN       | `[알림 설정 저장]`           | 버튼        |                                                     |
    * **탭 5: 외부 서비스 연동**
        | UI 요소 ID (선택) | 요소명 (Label)     | 유형 (Type)       | 예시/설명                              |
        | :---------------- | :----------------- | :---------------- | :------------------------------------- |
        | SC-EXT-01         | SMS 서비스 API 키  | 입력 필드(마스킹) | (연동 SMS 업체 제공 API 키)            |
        | SC-EXT-02         | 이메일 서비스 설정 | (세부 설정 UI)    | (예: SMTP 정보 또는 AWS SES 연동 정보) |
        | SC-EXT-BTN        | `[연동 정보 저장]` | 버튼              |                                        |

#### 3.3. 주요 사용자 시나리오 (흐름)
- **시나리오 1: 초기 시스템 설정 (회사 정보 및 기본 정책 입력)**
    1. 총괄관리자가 최초 로그인 후 또는 필요시 '시스템 환경설정' 메뉴에 접근한다.
    2. '회사 정보' 탭에서 회사명, 사업자번호, 로고 등을 입력하고 저장한다.
    3. '기본 표시 설정' 탭에서 날짜/숫자 형식 등을 확인하고 필요시 수정 후 저장한다.
    4. '납부/연체 정책' 탭에서 관리비 납부 마감일 기본값(예: 매월 25일)과 연체료율 기본값(예: 3%)을 설정하고 저장한다. (수납 계좌는 별도 "납부 정보 설정"에서 상세 관리)
    5. '알림 설정' 및 '외부 서비스 연동' 탭에서 SMS/이메일 발송을 위한 기본 정보를 입력하고 저장한다.
- **시나리오 2: 연체료율 정책 변경**
    1. 총괄관리자가 '시스템 환경설정 > 납부/연체 정책' 탭으로 이동한다.
    2. 기존에 설정된 '연체료율 기본값'을 새로운 값으로 수정한다 (예: 3% -> 2.8%).
    3. `[납부 정책 저장]` 버튼을 클릭한다.
    4. 시스템은 변경된 연체료율을 저장하고, 이후 발생하는 신규 연체 건에 대해 변경된 요율이 적용됨을 안내할 수 있다 (또는 특정 적용 시점 선택 옵션 제공).

### 4. 데이터 요구사항
#### 4.1. 입력 데이터
- 회사/사업장 기본 정보 (문자열, 파일(로고))
- 기본 표시 형식 코드 (날짜, 숫자, 통화 등)
- 납부 마감일(일자), 연체료율(숫자), 연체료 계산 방식 코드
- 알림 발신 정보 (문자열)
- 외부 서비스 API 키 및 설정값 (문자열, 암호화 필요)

#### 4.2. 출력 데이터 (화면 표시용)
- 현재 시스템에 설정된 모든 환경설정 값.

#### 4.3. 주요 엔티티 또는 데이터 구조 (예시)
- **`SystemConfiguration` (시스템 설정 - Key-Value 또는 구조화된 테이블)**
    | 설정 키 (Key)                | 값 (Value)            | 데이터 타입  | 설명                      |
    | :--------------------------- | :-------------------- | :----------- | :------------------------ |
    | `company.name`               | "QIRO 관리 주식회사"  | String       | 회사/사업장명             |
    | `company.logo.s3key`         | "logos/qiro_logo.png" | String       | 회사 로고 파일 참조       |
    | `format.date`                | "YYYY-MM-DD"          | String       | 날짜 표시 형식            |
    | `policy.payment.dueDay`      | "25"                  | String/Int   | 납부 마감일 기본값 (매월) |
    | `policy.payment.lateFeeRate` | "3.0"                 | String/Float | 연체료율 기본값 (%)       |
    | `notification.sender.email`  | "notice@qiro.com"     | String       | 기본 발신 이메일          |
    | `integration.sms.apiKey`     | (암호화된 값)         | String       | SMS API 키                |
    | ... (기타 모든 설정 항목)    |                       |              |                           |

*(실제로는 각 설정 그룹별로 별도의 테이블 또는 객체로 관리될 수 있음)*

### 5. 처리 로직 및 비즈니스 규칙
- **R-SYSCFG-001:** 각 설정 항목은 유효한 형식과 범위 내의 값만 입력될 수 있도록 검증한다.
- **R-SYSCFG-002:** '회사 정보'는 시스템 내 각종 문서(고지서 등)나 알림에 회사명/연락처 등으로 활용될 수 있다.
- **R-SYSCFG-003:** '납부 마감일 기본값' 및 '연체료율 기본값'은 "납부 정보 설정" 기능에서 개별 건물/단지별로 다르게 설정되지 않은 경우, 시스템 전반의 기본값으로 사용된다. (우선순위: 개별 설정 > 시스템 기본 설정)
- **R-SYSCFG-004:** 외부 서비스 연동 정보(API 키 등) 변경 시, 즉시 또는 다음 요청부터 새로운 설정값이 적용되어야 한다.
- **R-SYSCFG-005:** 민감한 설정값(API 키 등)은 데이터베이스에 암호화하여 저장하고, UI에 표시할 때는 마스킹 처리한다.

### 6. 오류 처리 및 예외 관리
| 오류 코드 (선택) | 발생 조건                       | 오류 메시지 (User-facing)                                    |
| :--------------- | :------------------------------ | :----------------------------------------------------------- |
| E-SYSCFG-01      | 필수 설정값 누락 또는 형식 오류 | "[설정 항목명] 값이 유효하지 않거나 누락되었습니다."         |
| E-SYSCFG-02      | 숫자/날짜 범위 오류             | "[설정 항목명]은 [유효 범위] 내의 값이어야 합니다."          |
| E-SYSCFG-03      | 외부 서비스 연동 정보 저장 실패 | "외부 서비스 연동 정보 저장 중 오류가 발생했습니다."         |
| E-SYSCFG-04      | 로고 등 파일 업로드 실패        | "파일 업로드에 실패했습니다. 파일 형식 또는 크기를 확인해주세요." |

### 7. (기능별) 성능 요구사항
- P-SYSCFG-01: 시스템 환경설정 화면 로드 및 현재 설정값 표시 2초 이내.
- P-SYSCFG-02: 설정값 저장 시 1초 이내 처리 완료.

### 8. (기능별) 보안 요구사항
- S-SYSCFG-01: 시스템 환경설정 기능은 오직 최상위 관리자(예: 시스템 전체 총괄관리자 또는 QIRO 서비스 운영자) 역할만 접근 및 수정 가능하다. (고객사별 총괄관리자는 해당 고객사 범위 내 설정만 가능하도록 제한)
- S-SYSCFG-02: API 키, 비밀번호 등 민감한 설정 정보는 안전하게 암호화되어 저장되어야 하며, UI 표시 시 마스킹 처리한다.
- S-SYSCFG-03: 모든 환경설정 값의 변경 이력(변경자, 변경 시간, 변경 전/후 값)은 상세한 감사 로그로 기록되어야 한다.

### 9. 다른 기능/모듈과의 연관성
- **모든 QIRO 서비스 기능:** 본 기능에서 설정된 값들은 QIRO 서비스 전반의 기본 동작 방식, 표시 형식, 정책 기준 등으로 직간접적인 영향을 미친다.
    - 예: "고지서 발급" 시 회사 로고, 기본 납부 정보 참조. "미납 관리" 시 기본 연체료율 참조. "알림 발송" 시 기본 발신자 정보 참조.
- **납부 정보 설정:** 본 기능에서 설정된 납부 마감일/연체료율 등은 '기본값'이며, "납부 정보 설정" 기능에서 특정 건물/단지별로 이 기본값을 오버라이드(Override)하는 상세 설정을 할 수 있는 구조를 고려할 수 있다.

### 10. (선택 사항) 테스트 고려 사항
- 모든 설정 항목에 대한 유효한 값/경계값/잘못된 값 입력 및 저장 테스트.
- 각 설정값 변경 시, 연관된 다른 기능에서 변경된 설정이 올바르게 반영되는지 확인하는 통합 테스트.
- 민감 정보(API 키 등) 저장 시 암호화 및 UI 마스킹 처리 여부 확인.
- 역할 권한에 따른 환경설정 메뉴 접근 통제 테스트.
- 로고 등 파일 업로드 기능 테스트 (다양한 형식, 크기).

### 11. 용어 정의 (선택 사항)
- **시스템 환경설정 (System Configuration):** 소프트웨어 애플리케이션 전반의 동작 방식, 기본값, 정책 등을 정의하는 파라미터 집합.
- **기본값 (Default Value):** 사용자가 별도로 지정하지 않았을 때 시스템이 사용하는 초기 설정값.

### 12. 문서 이력
| 버전 | 날짜             | 작성자      | 주요 변경 내용      |
| :--- | :--------------- | :---------- | :------------------ |
| 1.0  | 2025년 06월 03일 | QIRO 기획팀 | 초기 명세서 안 작성 |

---