# 📈 QIRO - 보고서 및 통계 관리 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - 보고서 및 통계 관리 기능 명세서
- **기능 ID (선택 사항):** F-RPTMGMT-001 (Reporting & Statistics Management)
- **관련 요구사항 ID:** (예: QIRO-FR-RP-001 ~ QIRO-FR-RP-020)
- **관련 사용자 스토리 ID:** (예: US-SA-XXX, US-BM-XXX, US-AS-XXX)
- **작성일:** 2025년 06월 03일
- **최종 수정일:** 2025년 06월 03일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
QIRO 시스템 내에 기록되고 관리되는 다양한 운영 데이터(임대, 관리비, 수납, 시설, 민원, 회계 등)를 기반으로, 건물 관리 및 운영 현황을 종합적으로 파악하고 분석할 수 있는 표준 보고서 및 통계 정보를 제공한다. 이를 통해 관리자는 데이터 기반의 신속하고 정확한 의사결정을 내릴 수 있으며, 운영 효율성을 개선하고, 필요한 경우 외부 이해관계자(예: 임대인, 회계 감사)에게 제출할 자료를 생성할 수 있다.

### 2.2. 설명
본 기능은 사용자가 사전에 정의된 다양한 유형의 보고서를 조회하고, 특정 조건(기간, 건물, 상태 등)에 따라 데이터를 필터링하며, 조회된 결과를 화면으로 확인하거나 파일(PDF, Excel, CSV 등)로 내보낼 수 있도록 지원한다. 주요 운영 지표는 시각화된 형태(차트, 그래프)로도 제공될 수 있으며, (선택적으로) 대시보드와 연동하여 핵심 정보를 요약 제공할 수 있다.

### 2.3. 범위
- **In-Scope (포함 범위):**
    - **표준 보고서 유형 제공:**
        - **임대 관련:** 임대 현황(공실률 포함), 계약 만료 예정, 월별/연간 임대료 수입 현황.
        - **관리비 관련:** 월별 관리비 부과 총괄표, 수납 현황(수납률 포함), 미납 현황(연령 분석 포함), 연체료 발생 현황.
        - **시설 관리 관련:** 시설물 점검 이력, 점검 예정 목록, (선택) 수리/보수 현황 요약.
        - **민원 관련:** 민원 접수 및 처리 현황(유형별, 상태별, 처리 기간별).
        - **회계 관련 (기본):** 기간별 수입/지출 요약 보고서 (건물 운영 중심), (선택) 계정별 원장 요약. (상세 재무제표는 "회계 관리" 기능과 연계)
    - 보고서 조회 조건 설정: 기간(월별, 분기별, 연간, 사용자 지정), 건물 선택, 동 선택, 상태 선택 등 보고서 유형별 필터링 옵션.
    - 화면 내 보고서 결과 조회: 테이블, 요약 정보, (선택) 기본 차트/그래프.
    - 보고서 데이터 내보내기: PDF, Excel, CSV 형식 지원.
    - 보고서 인쇄 기능.
- **Out-of-Scope (제외 범위):**
    - 사용자가 직접 보고서 양식(레이아웃, 계산식 등)을 처음부터 디자인하는 고급 맞춤형 보고서(Custom Report Builder) 기능 (초기 버전 제외).
    - 복잡한 BI(Business Intelligence) 도구 수준의 심층 데이터 분석 및 예측 기능.
    - 보고서 자동 정기 발송(스케줄링) 기능 (향후 확장 고려).
    - 각 개별 기능(예: 임대 계약 목록)에서 제공하는 단순 목록 조회 및 내보내기 (본 기능은 이를 종합하거나 특정 목적에 맞게 가공된 형태의 '보고서'를 지칭).

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면
- `관리자 포털 > 보고서` (또는 `통계/분석 > 보고서 조회`)
    - 하위 메뉴: `임대 관련 보고서`, `관리비 관련 보고서`, `시설 관련 보고서` 등 카테고리별 접근.
- 각 보고서 유형별 조건 설정 및 결과 조회 화면.

### 3.2. UI 요소별 상세 설명 (예시)
- **화면 1: 보고서 선택 및 조건 설정 화면**
    * **보고서 카테고리 선택:** (예: 좌측 메뉴 또는 탭으로 임대/관리비/시설/민원/회계 등 구분)
    * **보고서 종류 선택:** 선택된 카테고리 내의 보고서 목록 (예: "월별 수납 현황 보고서", "계약 만료 예정 보고서")에서 선택.
    * **조회 조건 설정 영역:** (선택된 보고서 유형에 따라 동적으로 변경)
        | UI 요소 ID (선택) | 요소명 (Label)       | 유형 (Type)              | 예시/설명                                            |
        | :---------------- | :------------------- | :----------------------- | :--------------------------------------------------- |
        | RPT-COND-01       | 조회 기간            | 날짜 범위 선택           | 시작일, 종료일 (또는 월/분기/연간 단위 선택)         |
        | RPT-COND-02       | 건물 선택            | 다중선택 드롭다운/리스트 | (관리 중인 건물 목록)                                |
        | RPT-COND-03       | 동 선택 (선택적)     | 다중선택 드롭다운        | (선택된 건물 내 동 목록)                             |
        | RPT-COND-04       | (보고서별) 상태 필터 | 드롭다운                 | 예: 계약 상태(임대중, 만료), 민원 상태(처리중, 완료) |
        | RPT-COND-05       | (보고서별) 기타 조건 | (다양)                   | 예: 특정 관리비 항목, 특정 민원 유형                 |
    * **액션 버튼:** `[보고서 조회]` (또는 `[생성]`), `[조건 초기화]`

- **화면 2: 보고서 결과 조회 화면**
    * **보고서 제목 및 조회 조건 표시 영역:** (예: "2025년 5월 월별 수납 현황 보고서 (행복아파트 A동)")
    * **상단 액션 버튼 영역:** `[인쇄]`, `[PDF로 내보내기]`, `[Excel로 내보내기]`, `[CSV로 내보내기]`
    * **보고서 내용 표시 영역:**
        * **요약 정보:** (보고서 유형에 따라) 주요 합계, 평균, 비율 등 KPI 값 표시.
        * **상세 데이터:** 테이블 형태로 세부 내역 표시. (컬럼은 보고서 유형에 따라 다름)
            * 예 (월별 수납 현황): 호실, 임차인, 청구액, 납부액, 미납액, 수납일, 수납방법 등.
        * **(선택) 시각화:** 주요 데이터를 차트나 그래프 형태로 함께 표시 (예: 월별 수입 추이, 미납액 연령 분포 파이 차트).
    * **(선택) 드릴다운 링크:** 테이블 내 특정 항목 클릭 시 관련 상세 정보(예: 특정 세대의 상세 수납 이력) 팝업 또는 새 화면으로 이동.

#### 3.3. 주요 사용자 시나리오 (흐름)
- **시나리오 1: 특정 건물의 지난달 관리비 미납 현황 보고서 조회 및 Excel 저장**
    1. 관리자가 `보고서 > 관리비 관련 보고서` 메뉴에서 "미납 현황 보고서"를 선택한다.
    2. '조회 조건 설정' 영역에서 '조회 기간'을 지난달로, '건물 선택'에서 특정 건물을 지정한다.
    3. `[보고서 조회]` 버튼을 클릭한다.
    4. 시스템은 해당 조건의 미납 현황 데이터를 집계하여 '보고서 결과 조회 화면'에 표시한다 (미납 세대 목록, 미납액, 연체일수 등).
    5. 관리자가 내용을 확인 후, `[Excel로 내보내기]` 버튼을 클릭하여 파일을 다운로드 받는다.
- **시나리오 2: 전체 관리 건물의 계약 만료 예정(향후 3개월) 현황 조회**
    1. 관리자가 `보고서 > 임대 관련 보고서` 메뉴에서 "계약 만료 예정 보고서"를 선택한다.
    2. '조회 조건 설정' 영역에서 '조회 기간'을 현재부터 3개월 후까지로 설정하고, '건물 선택'은 '전체'로 둔다.
    3. `[보고서 조회]` 버튼을 클릭한다.
    4. 시스템은 모든 관리 건물의 해당 기간 내 만료 예정 계약 목록을 화면에 표시한다.

### 4. 데이터 요구사항
#### 4.1. 입력 데이터 (사용자 선택 조건)
- 보고서 유형 선택 값.
- 조회 기간 (시작일, 종료일).
- 건물 ID(들), 동 ID(들).
- 상태 코드(들) (계약 상태, 민원 상태 등).
- 기타 보고서 유형별 특정 필터 조건 값.

#### 4.2. 출력 데이터
- 각 보고서 유형별로 정의된 데이터 필드 및 집계 값.
- 테이블 형태 데이터, 차트/그래프용 데이터.
- PDF, Excel, CSV 형식의 파일.

#### 4.3. 주요 참조 엔티티 (데이터 원천)
- `Building`, `Unit`, `LeaseContract`, `Tenant`, `Lessor` (임대 관련 보고서)
- `FeeItem`, `BillingMonth`, `MonthlyFeeCalculation` (또는 유사 고지/산정 엔티티), `PaymentHistory`, `DelinquencyRecord` (관리비 관련 보고서)
- `Facility`, `FacilityInspectionRecord` (시설 관련 보고서)
- `Complaint`, `ComplaintHistory` (민원 관련 보고서)
- `JournalEntry`, `JournalEntryLine`, `ChartOfAccount` (회계 관련 보고서)
- (기타 필요한 모든 QIRO 데이터 엔티티)

### 5. 처리 로직 및 비즈니스 규칙
- **R-RPT-001:** 각 보고서 유형별로 사전에 정의된 데이터 집계 방식, 계산 로직, 필터링 규칙을 따른다.
- **R-RPT-002:** 사용자가 선택한 조회 조건(기간, 건물 등)을 정확히 반영하여 데이터를 추출하고 가공한다.
- **R-RPT-003:** 보고서 내 금액, 비율, 건수 등의 집계 값은 소스 데이터의 최신 상태를 기준으로 정확하게 계산되어야 한다.
- **R-RPT-004:** 데이터 시각화(차트, 그래프)는 보고서의 내용을 효과적으로 전달할 수 있도록 적절한 유형과 형태로 제공한다.
- **R-RPT-005 (데이터 범위):** 사용자의 역할 및 권한에 따라 조회 가능한 데이터 범위(예: 특정 건물)가 제한될 수 있다.
- **R-RPT-006 (내보내기 형식):** Excel 내보내기 시에는 원본 데이터의 형식(숫자, 날짜 등)을 최대한 유지하고, 여러 시트로 구분하여 제공할 수 있다. PDF는 인쇄에 적합한 형태로 제공한다.

### 6. 오류 처리 및 예외 관리
| 오류 코드 (선택) | 발생 조건                                 | 오류 메시지 (User-facing)                                    |
| :--------------- | :---------------------------------------- | :----------------------------------------------------------- |
| E-RPT-01         | 필수 조회 조건 누락 (예: 기간)            | "보고서 조회를 위한 필수 조건([조건명])을 입력(선택)해주세요." |
| E-RPT-02         | 조회 기간 설정 오류 (예: 시작일 > 종료일) | "조회 기간 설정이 올바르지 않습니다."                        |
| E-RPT-03         | 데이터 집계/생성 중 오류 발생             | "보고서 생성 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요." |
| E-RPT-04         | 조회 결과 데이터 없음                     | "선택하신 조건에 해당하는 데이터가 없습니다."                |
| E-RPT-05         | 내보내기 파일 생성 실패                   | "파일 내보내기 중 오류가 발생했습니다."                      |

### 7. (기능별) 성능 요구사항
- P-RPT-01: 대부분의 표준 보고서는 조회 조건 설정 후 5~10초 이내에 결과가 화면에 표시되어야 한다 (일반적인 데이터 양 기준).
- P-RPT-02: 대량 데이터(예: 1년치 전체 건물 수납 상세 내역)를 집계하는 복잡한 보고서의 경우, 최대 30초~1분 이내 결과를 제공하거나, 비동기 생성 후 완료 시 알림 방식을 고려한다.
- P-RPT-03: 보고서 데이터 내보내기(Excel 기준, 10,000행) 시 30초 이내 파일 생성 완료.

### 8. (기능별) 보안 요구사항
- S-RPT-01: 보고서 조회 기능은 사용자의 역할 및 데이터 접근 권한(예: 담당 건물 범위)에 따라 엄격히 통제되어야 한다. 자신이 접근 권한 없는 건물의 데이터는 보고서에 포함되어서는 안 된다.
- S-RPT-02: 보고서에 개인정보(임차인 연락처, 임대인 계좌 등)가 포함될 경우, 해당 정보는 역할에 따라 마스킹 처리되거나 접근이 제한될 수 있다.
- S-RPT-03: 보고서 생성 및 조회 이력은 필요한 경우 감사 로그로 기록될 수 있다.

### 9. 다른 기능/모듈과의 연관성
- **모든 QIRO 핵심 기능 모듈:** 본 기능은 QIRO 시스템 내의 모든 주요 모듈(`임대 계약 관리`, `관리비 관리`, `수납 처리`, `시설 관리`, `민원 관리`, `회계 관리` 등)에서 생성된 데이터를 원천 소스로 사용하여 보고서를 생성한다. 각 모듈의 데이터 구조와 정확성이 본 기능의 품질에 직접적인 영향을 미친다.
- **대시보드:** (선택적) 본 기능에서 집계된 주요 통계 지표들은 메인 대시보드에 위젯 형태로 요약 제공될 수 있다.

### 10. (선택 사항) 테스트 고려 사항
- 각 표준 보고서 유형별로 다양한 조회 조건(기간, 건물, 상태 등)을 적용하여 데이터 정확성 및 계산 로직 검증 (수동 계산 결과와 비교).
- 데이터가 없는 경우, 데이터가 매우 많은 경우(경계값, 대용량)에 대한 보고서 생성 및 성능 테스트.
- 사용자 역할 및 권한에 따른 데이터 조회 범위 제한 기능 정확성 테스트.
- 모든 내보내기 형식(PDF, Excel, CSV)의 파일 생성 및 내용 정확성 검증.
- 차트/그래프 등 시각화 요소의 데이터 표현 정확성 및 가독성 테스트.

### 11. 용어 정의 (선택 사항)
- **KPI (Key Performance Indicator):** 핵심 성과 지표. 특정 목표 달성도를 측정하기 위한 정량적/정성적 지표.
- **데이터 드릴다운 (Data Drill-down):** 요약된 데이터에서 시작하여 점차 상세한 수준의 데이터로 탐색해 들어가는 분석 기법.
- **연령 분석 보고서 (Aging Report):** 미수채권 등이 발생 시점으로부터 얼마나 오래되었는지를 기간별로 구분하여 보여주는 보고서.

### 12. 문서 이력
| 버전 | 날짜             | 작성자      | 주요 변경 내용      |
| :--- | :--------------- | :---------- | :------------------ |
| 1.0  | 2025년 06월 03일 | QIRO 기획팀 | 초기 명세서 안 작성 |

---