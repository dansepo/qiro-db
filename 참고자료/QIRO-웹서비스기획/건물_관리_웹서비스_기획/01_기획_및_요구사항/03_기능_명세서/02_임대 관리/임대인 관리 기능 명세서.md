# 📝 QIRO - 임대인 관리 기능 명세서

## 1. 문서 정보

- **문서명:** QIRO - 임대인 관리 기능 명세서
- **기능 ID (선택 사항):** F-LSMGMT-001 (Lessor Management)
- **관련 요구사항 ID:** (예: QIRO-FR-LM-001, QIRO-FR-LM-002, QIRO-FR-AUDIT-001)
- **관련 사용자 스토리 ID:** (예: US-SA-XXX, US-BM-XXX)
- **작성일:** 2025년 06월 27일
- **최종 수정일:** 2025년 06월 27일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.1 (이력 관리 요구사항 추가)

## 2. 기능 개요

### 2.1. 목적

QIRO 서비스를 사용하는 건물 관리 회사 또는 관리자가 위탁받은 건물의 소유주(임대인) 정보를 체계적으로 등록, 조회, 수정, 관리할 수 있도록 한다. 이를 통해 임대인과의 계약 관계, 소유 자산 정보, 정산 정보 등을 효율적으로 관리하고, 원활한 커뮤니케이션 및 보고의 기초를 마련한다. 또한, 주요 정보의 변경 이력을 관리하여 데이터의 신뢰성과 추적성을 확보한다.

### 2.2. 설명

본 기능은 임대인의 기본 정보(성명, 연락처, 사업자 정보 등), 임대인이 소유한 건물/호실 정보, 임대료 및 관리비 정산 계좌 정보 등을 관리하는 CRUD 기능을 제공한다. 또한, 특정 임대인과 관련된 계약, 수입/지출 내역(요약) 등을 쉽게 확인할 수 있는 인터페이스를 포함할 수 있으며, 중요 정보가 변경될 때마다 그 이력을 자동으로 기록하고 조회하는 기능을 제공한다.

### 2.3. 범위

- **In-Scope (포함 범위):**
  - 신규 임대인 정보 등록 (개인/법인 구분 포함).
  - 임대인 목록 조회 (검색 및 필터링 기능 포함).
  - 임대인 상세 정보 조회 및 수정.
  - 임대인 소유 자산(건물/호실) 연결 및 관리.
  - 임대인 정산 계좌 정보 등록 및 관리.
  - 임대인 상태 관리 (예: 계약 중, 계약 만료).
  - **주요 정보에 대한 변경 이력 기록 및 조회.**
- **Out-of-Scope (제외 범위):**
  - 임대인 대상 실제 정산금 지급 및 회계 처리 (이는 별도 '회계 관리' 또는 '정산 관리' 기능에서 처리).
  - 임대 계약 자체의 상세 조건 관리 (이는 '임대 계약 관리' 기능에서 주로 다루며, 본 기능은 임대인과 계약 간의 연결 정보를 가질 수 있음).
  - 임대인용 별도 포털 제공 (본 명세서는 관리자용 기능에 한정).

## 3. 사용자 인터페이스 (UI) 및 상호작용

### 3.1. 관련 화면

- `관리자 포털 > 임대 관리 > 임대인 관리` (또는 유사 경로)

### 3.2. UI 요소별 상세 설명 (예시)

- **화면 1: 임대인 목록 조회 화면**

  | UI 요소 ID (선택) | 요소명 (Label)       | 유형 (Type)  | 기본값/표시 데이터 | 동작 설명                                                    | 비고                              |
  | :---------------- | :------------------- | :----------- | :----------------- | :----------------------------------------------------------- | :-------------------------------- |
  | LS-LST-01         | [검색] 입력 필드     | 입력 필드    | -                  | 임대인명, 연락처, 사업자명 등으로 검색                       |                                   |
  | LS-LST-02         | [검색] 버튼          | 버튼         | -                  | 입력된 조건으로 임대인 목록 조회                             |                                   |
  | LS-LST-03         | [+ 임대인 추가] 버튼 | 버튼         | -                  | '임대인 등록 폼 화면'으로 이동                               |                                   |
  | LS-LST-04         | 임대인 목록          | 표           | -                  | 임대인 ID, 임대인명/법인명, 연락처, 사업자번호, 등록 건물 수, 상태 등을 표시 | 정렬, 클릭 시 상세 조회 화면 이동 |
  | LS-LST-05         | 페이지네이션         | 페이지네이션 | 1                  | 목록이 많을 경우 페이지 이동                                 |                                   |

- **화면 2: 임대인 등록/수정 폼 화면**

  * **탭 구성:** `기본 정보`, `소유 자산 정보`, `정산 계좌 정보`, **`변경 이력`**

  | UI 요소 ID (선택) | 요소명 (Label)      | 유형 (Type)     | 예시/설명                                     | 유효성 규칙/제약조건            |
  | :---------------- | :------------------ | :-------------- | :-------------------------------------------- | :------------------------------ |
  | LS-FRM-01         | 임대인 구분         | 라디오/드롭다운 | 개인, 법인 사업자, 개인 사업자 등             | 필수 선택                       |
  | LS-FRM-02         | 임대인명/법인명     | 입력 필드       |                                               | 필수, 최대 50자                 |
  | LS-FRM-03         | 대표자명 (법인시)   | 입력 필드       |                                               | (법인시) 필수, 최대 30자        |
  | LS-FRM-04         | 사업자등록번호      | 입력 필드       |                                               | (사업자시) 형식 검증, 중복 불가 |
  | LS-FRM-05         | 연락처 (휴대폰)     | 입력 필드       |                                               | 필수, 휴대폰 형식 검증          |
  | LS-FRM-06         | 이메일 주소         | 입력 필드       |                                               | 이메일 형식 검증                |
  | LS-FRM-07         | 주소                | 주소 검색       | (우편번호 API 연동)                           |                                 |
  | LS-FRM-08         | **소유 자산 추가**  | 버튼/모달       | 클릭 시 건물/호실 선택 모달 표시              |                                 |
  | LS-FRM-09         | 소유 자산 목록      | 표/리스트       | 선택된 건물/호실 목록 (건물명, 동/호수 등)    |                                 |
  | LS-FRM-10         | **정산 계좌 추가**  | 버튼/모달       | 클릭 시 은행, 계좌번호, 예금주 입력 모달 표시 |                                 |
  | LS-FRM-11         | 정산 계좌 목록      | 표/리스트       | 등록된 계좌 정보 (은행명, 계좌번호 마스킹)    |                                 |
  | LS-FRM-12         | 계약 상태           | 드롭다운        | 계약 중, 계약 예정, 계약 만료 등              |                                 |
  | LS-FRM-13         | [저장], [취소] 버튼 | 버튼            |                                               |                                 |

#### 3.3. 주요 사용자 시나리오 (흐름)

- **시나리오 1: 신규 임대인 등록**
  1. 관리자가 '임대인 목록 조회 화면'에서 [+ 임대인 추가] 버튼을 클릭한다.
  2. '임대인 등록 폼 화면'으로 이동한다.
  3. 관리자가 임대인 구분(개인/법인)을 선택하고, 임대인명, 사업자번호(해당 시), 연락처 등 기본 정보를 입력한다.
  4. [소유 자산 추가]를 통해 해당 임대인이 소유한 건물/호실을 시스템에서 선택하여 연결한다.
  5. [정산 계좌 추가]를 통해 임대료/관리비 등을 정산받을 계좌 정보를 입력한다.
  6. 모든 정보 입력 후 [저장] 버튼을 클릭한다.
  7. 시스템은 유효성 검사 후 임대인 정보를 저장하고, "임대인 정보가 성공적으로 등록되었습니다." 메시지를 표시한 후 목록 화면으로 이동하거나 상세 조회 화면으로 이동한다.
- **시나리오 2: 기존 임대인 정보 수정 (예: 정산 계좌 변경)**
  1. 관리자가 '임대인 목록 조회 화면'에서 수정할 임대인을 선택하여 상세 조회 화면으로 이동하거나, 목록에서 바로 수정 아이콘을 클릭한다.
  2. '임대인 수정 폼 화면'에서 '정산 계좌 정보' 섹션으로 이동한다.
  3. 기존 계좌를 수정하거나 새 계좌를 추가하고, 이전 계좌는 비활성화 또는 삭제한다.
  4. [저장] 버튼을 클릭하여 변경사항을 저장한다.
- **시나리오 3: 임대인 정보 변경 이력 조회**
  1. 관리자가 특정 임대인을 선택하여 상세 조회 화면으로 이동한다.
  2. `[변경 이력]` 탭을 클릭한다.
  3. 시스템은 해당 임대인과 관련된 모든 주요 정보(기본 정보, 소유 자산, 정산 계좌)의 변경 이력을 시간 역순으로 표시한다.
  4. 관리자는 언제, 누가, 어떤 항목을, 어떻게 변경했는지 확인하여 데이터 변경의 투명성을 확보한다.

### 4. 데이터 요구사항

#### 4.1. 입력 데이터

- 임대인 기본 정보: 구분(개인/법인), 성명/법인명, 대표자명, 연락처, 이메일, 주소 등
- 사업자 정보: 사업자등록번호, 업태, 종목 등
- 소유 자산 정보: 연결된 건물 ID, 호실 ID 목록
- 정산 계좌 정보: 은행명, 계좌번호, 예금주명

#### 4.2. 출력 데이터 (화면 표시 및 보고서용)

- 임대인 목록 및 상세 정보
- 임대인별 소유 자산 현황
- **임대인별 정보 변경 이력 목록**
- (연계) 임대인별 계약 현황 요약
- (연계) 임대인별 수입/지출 현황 요약 (정산 보고서용)

#### 4.3. 임대인 (Lessor) 엔티티 속성 (예시)

| 속성명 (Attribute)   | 데이터 타입 (Type) | 필수       | 설명                                                         |
| :------------------- | :----------------- | :--------- | :----------------------------------------------------------- |
| `lessorId`           | UUID / Long (PK)   | Y          | 임대인 고유 ID                                               |
| `lessorType`         | Enum / String      | Y          | 임대인 구분 (예: `INDIVIDUAL`, `CORPORATION`, `SOLE_PROPRIETOR`) |
| `name`               | String             | Y          | 임대인명 또는 법인명                                         |
| `representativeName` | String             | (조건부 Y) | 대표자명 (법인 또는 개인사업자 시)                           |
| `businessNumber`     | String             | (조건부 Y) | 사업자등록번호 (사업자 시)                                   |
| `contactNumber`      | String             | Y          | 연락처 (휴대폰 번호)                                         |
| `email`              | String             | N          | 이메일 주소                                                  |
| `address`            | String             | N          | 주소 (상세주소 포함)                                         |
| `status`             | Enum / String      | Y          | 계약 상태 (예: `ACTIVE`, `PENDING`, `EXPIRED`)               |
| `createdAt`          | DateTime           | Y          | 생성 일시                                                    |
| `createdBy`          | String             | Y          | 생성자 ID                                                    |
| `lastModifiedAt`     | DateTime           | Y          | 최종 수정 일시                                               |
| `lastModifiedBy`     | String             | Y          | 최종 수정자 ID                                               |

#### 4.4. 임대인-소유자산 연결 (LessorPropertyLink) 엔티티 (예시, Many-to-Many)

| 속성명 (Attribute)   | 데이터 타입 (Type) | 필수 | 설명                        |
| :------------------- | :----------------- | :--- | :-------------------------- |
| `linkId`             | UUID / Long (PK)   | Y    | 연결 고유 ID                |
| `lessorId`           | UUID / Long (FK)   | Y    | 임대인 ID                   |
| `buildingId`         | UUID / Long (FK)   | Y    | 건물 ID                     |
| `unitId`             | UUID / Long (FK)   | N    | (특정 호실 소유 시) 호실 ID |
| `ownershipStartDate` | Date               | Y    | 소유 시작일                 |
| `ownershipEndDate`   | Date               | N    | 소유 종료일                 |
| `createdAt`          | DateTime           | Y    | 생성 일시                   |
| `createdBy`          | String             | Y    | 생성자 ID                   |

#### 4.5. 임대인 정산 계좌 (LessorBankAccount) 엔티티 (예시, One-to-Many)

| 속성명 (Attribute)  | 데이터 타입 (Type) | 필수 | 설명                        |
| :------------------ | :----------------- | :--- | :-------------------------- |
| `accountId`         | UUID / Long (PK)   | Y    | 계좌 고유 ID                |
| `lessorId`          | UUID / Long (FK)   | Y    | 임대인 ID                   |
| `bankName`          | String             | Y    | 은행명                      |
| `accountNumber`     | String             | Y    | 계좌번호 (암호화 저장 권장) |
| `accountHolderName` | String             | Y    | 예금주명                    |
| `isPrimary`         | Boolean            | Y    | 주 사용 계좌 여부           |
| `createdAt`         | DateTime           | Y    | 생성 일시                   |
| `createdBy`         | String             | Y    | 생성자 ID                   |

#### 4.6. **(신규) 임대인 변경 이력 로그 (LessorAuditLog) 엔티티 (예시)**

| 속성명 (Attribute)  | 데이터 타입 (Type)       | 필수 | 설명                                                         |
| :------------------ | :----------------------- | :--- | :----------------------------------------------------------- |
| `logId`             | UUID / Long (PK)         | Y    | 로그 고유 ID                                                 |
| `lessorId`          | UUID / Long (FK)         | Y    | 변경이 발생한 임대인 ID                                      |
| `changeTimestamp`   | TIMESTAMP WITH TIME ZONE | Y    | 변경 발생 일시                                               |
| `changedByUserId`   | UUID / String (FK)       | Y    | 변경을 수행한 관리자(내부 사용자) ID                         |
| `changeCategory`    | String                   | Y    | 변경 항목의 대분류 (예: `기본 정보`, `소유 자산`, `정산 계좌`) |
| `fieldName`         | String                   | N    | (필드 단위 변경 시) 변경된 필드명 (예: `contactNumber`)      |
| `oldValue`          | Text                     | N    | 변경 전 데이터 값                                            |
| `newValue`          | Text                     | N    | 변경 후 데이터 값                                            |
| `changeDescription` | String                   | Y    | 변경 내용 요약 (예: "정산 계좌 추가: QIRO은행 123-...")      |

### 5. 처리 로직 및 비즈니스 규칙

- **R-LSMGMT-001:** 사업자등록번호는 시스템 내에서 고유해야 한다 (중복 등록 방지).
- **R-LSMGMT-002:** 임대인 등록 시, 구분(개인/법인/개인사업자)에 따라 필수 입력 사업자 정보가 달라질 수 있다.
- **R-LSMGMT-003:** 임대인 정보 삭제는 해당 임대인과 연결된 활성 임대 계약이 없거나, 위탁 관리 계약이 종료된 경우에만 가능하다 (또는 '비활성' 상태로 변경하여 데이터 보존).
- **R-LSMGMT-004:** 정산 계좌 정보는 여러 개 등록 가능하며, 그중 하나를 '주 사용 계좌'로 지정할 수 있다.
- **R-LSMGMT-005:** 임대인이 소유한 자산(건물/호실) 정보는 실제 건물/호실 정보와 연결되어 관리되어야 한다.
- **R-LSMGMT-006 (신규 - 이력 기록):** 이력 관리 대상(2.2절 참조)으로 지정된 정보가 생성, 수정, 삭제될 때마다, 시스템은 변경 사항(변경 일시, 변경자, 변경 항목, 변경 전/후 값 등)을 `LessorAuditLog` 테이블에 자동으로 기록해야 한다.

### 6. 오류 처리 및 예외 관리

| 오류 코드 (선택) | 발생 조건                         | 오류 메시지 (User-facing)                                    | 시스템 처리 방안                       |
| :--------------- | :-------------------------------- | :----------------------------------------------------------- | :------------------------------------- |
| E-LSMGMT-01      | 필수 입력 항목 누락               | "[필드명]은(는) 필수 입력 항목입니다."                       | 저장 차단, 해당 필드에 오류 표시       |
| E-LSMGMT-02      | 사업자등록번호 형식 오류/중복     | "유효하지 않거나 이미 등록된 사업자번호입니다."              | 저장 차단, 사업자번호 필드에 오류 표시 |
| E-LSMGMT-03      | 연락처/이메일 형식 오류           | "올바른 형식의 [연락처/이메일] 주소를 입력해주세요."         | 저장 차단, 해당 필드에 오류 표시       |
| E-LSMGMT-04      | 삭제 불가 조건 위배               | "해당 임대인은 연결된 계약 또는 자산 정보가 있어 삭제할 수 없습니다. 비활성 처리만 가능합니다." | 삭제 차단, 안내 메시지 표시            |
| E-LSMGMT-05      | 유효하지 않은 소유 자산 연결 시도 | "선택한 건물 또는 호실 정보가 유효하지 않습니다."            | 저장 차단, 안내 메시지 표시            |

### 7. (기능별) 성능 요구사항

- P-LSMGMT-01: 임대인 목록 조회 시 (1,000명 기준, 기본 필터) 2초 이내 응답.
- P-LSMGMT-02: 임대인 정보 저장(생성/수정) 시 이력 로그 기록을 포함하여 1.5초 이내 처리 완료.

### 8. (기능별) 보안 요구사항

- S-LSMGMT-01: 임대인 관리 기능은 인가된 역할만 접근 가능하다.
- S-LSMGMT-02: 임대인의 개인정보 및 금융정보(계좌번호)는 암호화하여 저장하고, 접근 권한을 엄격히 통제한다.
- S-LSMGMT-03: 임대인 정보의 모든 변경 이력은 감사 로그로 기록하여 추적성을 보장한다.

### 9. 다른 기능/모듈과의 연관성

- **임대 계약 관리:** 계약 당사자인 임대인 정보를 본 기능에서 선택/참조한다.
- **회계 관리 / 정산 관리:** 임대인에게 정산 시 본 기능에 등록된 정산 계좌 정보를 활용한다.
- **감사 로그 시스템:** 본 기능에서 발생하는 모든 중요 변경 사항은 중앙 감사 로그 시스템에 기록될 수 있다.

### 10. (선택 사항) 테스트 고려 사항

- 개인 임대인, 법인 임대인 등 다양한 유형별 등록/수정/삭제 테스트.
- 다수 소유 자산 및 다수 정산 계좌 등록/관리 기능 테스트.
- **(신규)** 주요 정보(연락처, 계좌, 소유자산 등) 변경 시, 변경 이력이 정확하게 기록되는지 확인하는 테스트.
- **(신규)** '변경 이력' 탭에서 이력 정보가 올바른 형식으로 시간 역순으로 조회되는지 테스트.
- 개인정보 및 금융정보 암호화 저장 및 마스킹 표시(필요시) 확인.

### 11. 용어 정의 (선택 사항)

- **임대인 (Lessor/Landlord):** 건물 또는 특정 공간(호실)의 소유주.
- **정산 계좌 (Settlement Account):** 임대료 등이 임대인에게 지급될 때 입금되는 계좌.
- **이력 관리 (History Management / Audit Trail):** 데이터의 생성, 수정, 삭제 등 변경에 관한 내용을 기록하고 추적하는 것.

### 12. 문서 이력

| 버전    | 날짜                 | 작성자          | 주요 변경 내용                                    |
| :------ | :------------------- | :-------------- | :------------------------------------------------ |
| 1.0     | 2025년 06월 02일     | QIRO 기획팀     | 초기 명세서 안 작성                               |
| **1.1** | **2025년 06월 27일** | **QIRO 기획팀** | **주요 정보 변경에 대한 이력 관리 요구사항 추가** |