# 👥 QIRO - 임차인 관리 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - 임차인 관리 기능 명세서
- **기능 ID (선택 사항):** F-TNMGMT-001 (Tenant Management)
- **관련 요구사항 ID:** (예: QIRO-FR-LM-010, QIRO-FR-LM-011, QIRO-FR-CMN-003)
- **관련 사용자 스토리 ID:** (예: US-BM-XXX, US-AS-XXX)
- **작성일:** 2025년 06월 02일
- **최종 수정일:** 2025년 06월 02일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
QIRO 서비스를 통해 관리되는 건물 내 각 호실을 점유하고 있는 임차인(또는 세대주, 입주민)의 정보를 체계적으로 등록, 조회, 수정, 관리할 수 있도록 한다. 이를 통해 임대 계약 이행, 관리비 부과 및 수납, 민원 처리, 공지사항 전달 등 임차인 대상의 다양한 관리 업무를 효율적으로 지원한다.

### 2.2. 설명
본 기능은 임차인의 기본 인적 사항(성명, 연락처 등), 계약 정보(연결된 임대 계약), 거주/사업장 정보(해당 호실), 차량 정보, 동거인 정보 등을 관리하는 CRUD 기능을 제공한다. 임차인 정보는 관리비 고지, 민원 대응, 각종 안내 등 건물 관리의 핵심 대상 정보로 활용된다.

### 2.3. 범위
- **In-Scope (포함 범위):**
    - 신규 임차인 정보 등록 (개인/사업자 구분 포함 가능)
    - 임차인 목록 조회 (건물별, 동/호수별, 계약 상태별 검색 및 필터링 기능 포함)
    - 임차인 상세 정보 조회 및 수정
    - 임차인과 임대 계약 정보 연결
    - 임차인 연락처(비상 연락처 포함), 차량 정보, (선택)동거인/가족 정보 관리
    - 임차인 입주/퇴거일 관리 및 상태 변경 (예: 거주중, 퇴거 예정, 퇴거 완료)
    - (선택) 임차인 대상 커뮤니케이션 이력 기록 (간단 메모 수준)
- **Out-of-Scope (제외 범위):**
    - 임대 계약 조건의 상세 관리 및 전자 계약 기능 (이는 '임대 계약 관리' 기능에서 주로 다룸)
    - 임차인용 포털 접속 계정 관리 (별도 '사용자 계정 관리' 또는 '입주민 포털 관리' 기능에서 정의)
    - 관리비 수납 처리 자체 (이는 '수납 처리' 기능에서 다룸)

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면
- `관리자 포털 > 임대 관리 > 임차인 관리` (또는 `건물 관리 > [건물선택] > 입주 현황/임차인`)

### 3.2. UI 요소별 상세 설명 (예시)
- **화면 1: 임차인 목록 조회 화면**
    | UI 요소 ID (선택) | 요소명 (Label)       | 유형 (Type)  | 기본값/표시 데이터 | 동작 설명                                                    | 비고                              |
    | :---------------- | :------------------- | :----------- | :----------------- | :----------------------------------------------------------- | :-------------------------------- |
    | TN-LST-01         | [건물/동] 필터       | 드롭다운     | 전체               | 특정 건물 또는 동의 임차인만 필터링                          |                                   |
    | TN-LST-02         | [검색] 입력 필드     | 입력 필드    | -                  | 임차인명, 연락처, 호실 등으로 검색                           |                                   |
    | TN-LST-03         | [검색] 버튼          | 버튼         | -                  | 입력된 조건으로 임차인 목록 조회                             |                                   |
    | TN-LST-04         | [+ 임차인 추가] 버튼 | 버튼         | -                  | '임차인 등록 폼 화면'으로 이동 (보통 계약 등록 시 함께 처리) |                                   |
    | TN-LST-05         | 임차인 목록          | 표           | -                  | 호실, 임차인명, 연락처, 계약 기간, 상태(거주중 등) 등을 표시 | 정렬, 클릭 시 상세 조회 화면 이동 |
    | TN-LST-06         | 페이지네이션         | 페이지네이션 | 1                  | 목록이 많을 경우 페이지 이동                                 |                                   |

- **화면 2: 임차인 등록/수정 폼 화면**
    * **탭 또는 섹션 구성:** 기본 정보, 계약 정보 연결, 연락처 정보, 차량 정보, (선택)동거인 정보, 입퇴거 정보 등
    | UI 요소 ID (선택) | 요소명 (Label)               | 유형 (Type)      | 예시/설명                                        | 유효성 규칙/제약조건   |
    | :---------------- | :--------------------------- | :--------------- | :----------------------------------------------- | :--------------------- |
    | TN-FRM-01         | 임차인명                     | 입력 필드        |                                                  | 필수, 최대 30자        |
    | TN-FRM-02         | 연락처 (휴대폰)              | 입력 필드        |                                                  | 필수, 휴대폰 형식 검증 |
    | TN-FRM-03         | 이메일 주소                  | 입력 필드        |                                                  | 이메일 형식 검증       |
    | TN-FRM-04         | **거주/사업장 호실**         | 호실 선택 (검색) | 시스템에 등록된 건물/동/호실 선택                | 필수, 유효한 호실 선택 |
    | TN-FRM-05         | **연결 임대 계약**           | 계약 선택 (검색) | 해당 호실의 유효한 임대 계약 선택/신규 생성 연결 |                        |
    | TN-FRM-06         | 입주일                       | 날짜 선택        |                                                  | 계약 시작일 이후       |
    | TN-FRM-07         | 퇴거(예정)일                 | 날짜 선택        |                                                  | 입주일 이후            |
    | TN-FRM-08         | 임차인 상태                  | 드롭다운         | 거주중, 퇴거 예정, 퇴거 완료 등                  |                        |
    | TN-FRM-09         | 비상 연락처 (이름/관계/번호) | 복합 입력        |                                                  |                        |
    | TN-FRM-10         | 차량 정보 (번호/차종)        | 목록 입력        | [차량 추가] 버튼으로 여러 대 등록 가능           | 차량 번호 형식 검증    |
    | TN-FRM-11         | [저장], [취소] 버튼          | 버튼             |                                                  |                        |

#### 3.3. 주요 사용자 시나리오 (흐름)
- **시나리오 1: 신규 임차인 등록 (임대 계약 진행 시)**
    1. 관리자가 '임대 계약 관리'에서 신규 계약을 등록하면서 임차인 정보를 입력하거나, '임차인 관리'에서 [+ 임차인 추가]를 통해 직접 등록을 시작한다.
    2. '임차인 등록 폼 화면'에서 임차인명, 연락처, 거주 호실 등 기본 정보를 입력한다.
    3. 해당 임차인과 관련된 임대 계약 정보를 연결하거나 신규로 생성하여 연결한다.
    4. 입주일, 차량 정보 등 추가 정보를 입력한다.
    5. 모든 정보 입력 후 [저장] 버튼을 클릭한다.
    6. 시스템은 유효성 검사 후 임차인 정보를 저장하고, "임차인 정보가 성공적으로 등록되었습니다." 메시지를 표시한다. 해당 호실의 상태도 '임대중'으로 변경될 수 있다.
- **시나리오 2: 기존 임차인 퇴거 처리**
    1. 관리자가 '임차인 목록'에서 퇴거할 임차인을 선택하여 상세 정보 화면으로 이동한다.
    2. '임차인 수정 폼 화면'에서 '퇴거(예정)일'을 입력하고, '임차인 상태'를 '퇴거 완료'로 변경한다.
    3. (필요시) 관리비 정산, 보증금 반환 등 퇴거 관련 메모를 남긴다 (이사 정산 기능 연계).
    4. [저장] 버튼을 클릭하여 변경사항을 저장한다.
    5. 시스템은 해당 임차인의 상태를 '퇴거 완료'로 변경하고, 연결된 호실의 상태도 '공실'로 변경할 수 있다. 관련 임대 계약도 '종료' 상태로 업데이트된다.

### 4. 데이터 요구사항
#### 4.1. 입력 데이터
- 임차인 기본 정보: 성명, 연락처, 이메일 등
- 거주 정보: 건물 ID, 동/호실 ID
- 계약 정보: 연결된 임대 계약 ID
- 차량 정보: 차량번호, 차종
- 입퇴거 정보: 입주일, 퇴거(예정)일, 임차인 상태

#### 4.2. 출력 데이터 (화면 표시 및 보고서용)
- 임차인 목록 및 상세 정보
- 특정 호실의 현재 및 과거 임차인 이력
- 계약 만료 예정 임차인 목록
- (연계) 임차인별 관리비 미납 현황

#### 4.3. 임차인 (Tenant) 엔티티 속성 (예시)
| 속성명 (Attribute)         | 데이터 타입 (Type) | 필수 | 설명                                                    |
| :------------------------- | :----------------- | :--- | :------------------------------------------------------ |
| `tenantId`                 | UUID / Long (PK)   | Y    | 임차인 고유 ID                                          |
| `name`                     | String             | Y    | 임차인명 (개인 또는 사업체명)                           |
| `contactNumber`            | String             | Y    | 연락처 (휴대폰 번호)                                    |
| `email`                    | String             | N    | 이메일 주소                                             |
| `unitId`                   | UUID / Long (FK)   | Y    | 현재 거주(또는 계약된) 호실 ID                          |
| `leaseContractId`          | UUID / Long (FK)   | Y    | 연결된 주 임대 계약 ID                                  |
| `moveInDate`               | Date               | Y    | 입주일                                                  |
| `moveOutDate`              | Date               | N    | 퇴거일 (실제 퇴거 또는 계약상 만료일)                   |
| `status`                   | Enum / String      | Y    | 임차인 상태 (예: `RESIDING`, `MOVING_OUT`, `MOVED_OUT`) |
| `emergencyContactName`     | String             | N    | 비상 연락처 - 이름                                      |
| `emergencyContactRelation` | String             | N    | 비상 연락처 - 관계                                      |
| `emergencyContactNumber`   | String             | N    | 비상 연락처 - 번호                                      |
| `createdAt`                | DateTime           | Y    | 생성 일시                                               |
| `createdBy`                | String             | Y    | 생성자 ID                                               |
| `lastModifiedAt`           | DateTime           | Y    | 최종 수정 일시                                          |
| `lastModifiedBy`           | String             | Y    | 최종 수정자 ID                                          |

#### 4.4. 임차인 차량 정보 (TenantVehicle) 엔티티 (예시, Tenant에 One-to-Many)
| 속성명 (Attribute) | 데이터 타입 (Type) | 필수 | 설명               |
| :----------------- | :----------------- | :--- | :----------------- |
| `vehicleId`        | UUID / Long (PK)   | Y    | 차량 정보 고유 ID  |
| `tenantId`         | UUID / Long (FK)   | Y    | 임차인 ID          |
| `vehicleNumber`    | String             | Y    | 차량 번호          |
| `vehicleModel`     | String             | N    | 차종               |
| `remarks`          | String             | N    | 비고 (방문차량 등) |
| `createdAt`        | DateTime           | Y    | 생성 일시          |
| `createdBy`        | String             | Y    | 생성자 ID          |

### 5. 처리 로직 및 비즈니스 규칙
- **R-TNMGMT-001:** 한 호실에는 특정 기간 동안 오직 하나의 '거주중' 상태 임차인(또는 활성 임대 계약)만 존재할 수 있다 (중복 입주 방지).
- **R-TNMGMT-002:** 임차인 등록 시(주로 계약과 함께), 해당 호실의 상태는 '공실'에서 '임대중(또는 거주중)'으로 변경되어야 한다.
- **R-TNMGMT-003:** 임차인 퇴거 처리 시, 해당 호실의 상태는 다시 '공실'로 변경되고, 연결된 임대 계약의 상태도 '종료'로 업데이트된다. 이 때 "이사 정산" 기능이 호출되거나 관련 절차가 진행되어야 한다.
- **R-TNMGMT-004:** 임차인 정보 변경(특히 연락처)은 관리비 고지, 공지사항 전달 등 다른 기능에 즉시 반영되어야 한다.
- **R-TNMGMT-005:** 임차인의 상태(`status`)는 연결된 임대 계약의 상태(`LeaseContract.status`) 및 입주/퇴거일(`moveInDate`, `moveOutDate`)과 동기화되거나 논리적으로 일관성을 유지해야 한다.

### 6. 오류 처리 및 예외 관리
| 오류 코드 (선택) | 발생 조건                           | 오류 메시지 (User-facing)                                    | 시스템 처리 방안                 |
| :--------------- | :---------------------------------- | :----------------------------------------------------------- | :------------------------------- |
| E-TNMGMT-01      | 필수 입력 항목 누락                 | "[필드명]은(는) 필수 입력 항목입니다."                       | 저장 차단, 해당 필드에 오류 표시 |
| E-TNMGMT-02      | 연락처/이메일 형식 오류             | "올바른 형식의 [연락처/이메일] 주소를 입력해주세요."         | 저장 차단, 해당 필드에 오류 표시 |
| E-TNMGMT-03      | 이미 임차인이 있는 호실에 등록 시도 | "해당 호실은 지정된 기간에 이미 다른 임차인이 계약/거주 중입니다." | 저장 차단, 안내 메시지 표시      |
| E-TNMGMT-04      | 유효하지 않은 호실/계약 정보 연결   | "선택한 호실 또는 계약 정보가 유효하지 않습니다."            | 저장 차단, 안내 메시지 표시      |

### 7. (기능별) 성능 요구사항
- P-TNMGMT-01: 임차인 목록 조회 시 (특정 건물 1,000세대 기준, 기본 필터) 2초 이내 응답.
- P-TNMGMT-02: 임차인 정보 저장(생성/수정, 차량 정보 포함) 시 1.5초 이내 처리 완료.

### 8. (기능별) 보안 요구사항
- S-TNMGMT-01: 임차인 관리 기능은 '총괄관리자', '관리소장', '경리담당자' 등 인가된 역할만 접근 가능하다. (데이터 조회 권한은 더 넓게, 수정 권한은 제한적일 수 있음)
- S-TNMGMT-02: 임차인의 개인정보(연락처, 성명, 이메일 등)는 개인정보보호법에 따라 안전하게 관리하며, 저장 시 암호화를 고려하고 접근 권한을 엄격히 통제한다.
- S-TNMGMT-03: 임차인 정보의 주요 변경(입주, 퇴거, 연락처 변경 등) 이력은 감사 로그로 기록한다.

### 9. 다른 기능/모듈과의 연관성
- **건물/호실 정보 관리:** 임차인이 거주하는 호실 정보를 참조하고 연결한다. 임차인 입주/퇴거에 따라 호실의 상태(공실/임대중)에 영향을 준다.
- **임대 계약 관리:** 임차인은 임대 계약의 주요 당사자이다. 임차인 정보는 계약 정보와 밀접하게 연동되며, 계약 생성/변경 시 임차인 정보가 활용된다.
- **관리비 관리 (부과, 고지, 수납):** 관리비 부과 및 고지 대상은 본 기능에서 관리되는 임차인(또는 세대주) 정보다. 수납 처리 시 임차인별 미납 현황에 영향을 준다.
- **민원 관리:** 민원 제기자 또는 관련자로 임차인 정보가 활용된다.
- **공지사항/알림:** 특정 임차인 또는 전체 임차인 대상 공지/알림 발송 시 본 기능의 연락처 정보를 사용한다.
- **이사 정산 관리:** 임차인 퇴실 시, 본 기능의 임차인 정보 및 입주/퇴거 정보를 바탕으로 정산 절차가 진행된다.

### 10. (선택 사항) 테스트 고려 사항
- 신규 임차인 등록, 정보 수정, 퇴거 처리(상태 변경) 등 기본 CRUD 기능 테스트.
- 임차인 상태 변경에 따른 호실 및 계약 상태 연동 변경 정확성 테스트.
- 다수 차량 정보 등록 및 관리 기능 테스트.
- 다양한 조건(건물, 동, 호수, 임차인명, 연락처 등)의 검색 및 필터링 기능 정확성 테스트.
- 개인정보 암호화 저장 및 접근 통제 관련 보안 테스트.
- 임차인 정보가 관리비 고지, 민원 처리 등 다른 기능에 올바르게 연동되어 사용되는지 확인.

### 11. 용어 정의 (선택 사항)
- **임차인 (Tenant/Lessee):** 임대차 계약에 따라 건물 또는 특정 공간(호실)을 사용하는 개인 또는 사업자. (상황에 따라 세대주, 입주민과 혼용 가능)
- **입주/퇴거 (Move-in/Move-out):** 임차인이 특정 호실에 거주를 시작하거나 종료하는 행위 및 관련 절차.

### 12. 문서 이력
| 버전 | 날짜             | 작성자      | 주요 변경 내용      |
| :--- | :--------------- | :---------- | :------------------ |
| 1.0  | 2025년 06월 02일 | QIRO 기획팀 | 초기 명세서 안 작성 |