# 📊 QIRO - 임대 현황 조회 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - 임대 현황 조회 기능 명세서
- **기능 ID (선택 사항):** F-LSSTAT-001 (Leasing Status Inquiry)
- **관련 요구사항 ID:** (예: QIRO-FR-RP-001, QIRO-FR-DSBD-002)
- **관련 사용자 스토리 ID:** (예: US-BM-XXX, US-SA-XXX)
- **작성일:** 2025년 06월 02일
- **최종 수정일:** 2025년 06월 02일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
관리자가 담당하는 건물 내 각 세대(또는 상가 등 임대 단위)의 현재 임대 상태(임대중, 공실), 주요 계약 정보(임차인, 임대료, 계약 만료일), 그리고 건물 전체 또는 선택된 범위의 임대 운영 현황에 대한 핵심 지표(KPI: 임대율, 총 임대 수입, 계약 만료 예정 건수 등)를 한눈에 파악하고 효과적으로 관리할 수 있도록 지원한다.

### 2.2. 설명
본 기능은 QIRO 시스템에 등록된 건물, 호실, 임대 계약, 임차인 정보를 종합하여 실시간 임대 현황을 대시보드 형태의 KPI 요약과 상세 목록 형태로 제공한다. 사용자는 다양한 필터와 검색 조건을 활용하여 원하는 데이터를 손쉽게 조회할 수 있으며, 조회된 데이터는 외부 파일로 내보내거나, (선택적으로) 시각화된 형태로 확인할 수 있다. 또한, 계약 만료 임박 건과 같은 주요 알림 정보를 제공하여 선제적인 임대 관리를 돕는다.

### 2.3. 범위
- **In-Scope (포함 범위):**
    - 주요 임대 현황 KPI 요약 정보 표시 (임대율, 총 임대 수입, 계약 만료 예정 건수 등).
    - 세대별 임대 상태 상세 목록 조회 (세대 정보, 임차인, 임대료, 계약 만료일, 상태 등).
    - 목록 조회 시 필터링 (계약 상태, 건물 등) 및 검색 (세대 번호, 임차인명 등) 기능.
    - 임대 현황 목록 데이터 내보내기 (Excel, CSV 등).
    - 계약 만료 임박 알림 표시.
    - (선택) 임대 현황 데이터 일괄 업로드/가져오기 기능 (예: 초기 데이터 마이그레이션, 일괄 상태 업데이트).
    - (선택) 임대 현황 시각화 뷰 (예: 층별 임대 현황도, 통계 차트 등) 전환 기능.
- **Out-of-Scope (제외 범위):**
    - 임대 계약의 신규 등록, 수정, 삭제, 갱신, 해지 등 상세 편집 기능 (이는 "임대 계약 관리" 기능에서 주로 처리).
    - 임차인 및 임대인 정보의 상세 편집 기능 (이는 각 "임차인 관리", "임대인 관리" 기능에서 처리).
    - 실제 관리비/임대료 청구 및 수납 처리 기능.
    - 전자 계약 작성 기능 자체 (본 화면에서는 해당 기능으로의 링크 또는 연동 결과 표시만 가능).

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면
- `관리자 포털 > 임대 관리 > 임대 현황` (또는 `대시보드 > 임대 현황 요약`)
    - **화면 제목:** 임대 현황
    - **화면 부제목:** 건물 내 각 세대의 임대 현황, 공실 현황, 임대료 현황 등을 확인합니다.

### 3.2. UI 요소별 상세 설명 (예시 - 제공된 이미지 `image_9208f6.jpg` 참조)
- **화면 1: 임대 현황 조회 화면**
    * **A. 최상단 액션 바:**
        | UI 요소 ID (선택) | 요소명 (Label)                     | 유형 (Type) | 동작 설명                                                    |
        | :---------------- | :--------------------------------- | :---------- | :----------------------------------------------------------- |
        | LS-TOP-01         | [파일 업로드/가져오기] 아이콘 버튼 | 아이콘 버튼 | 클릭 시 임대 현황 관련 데이터 일괄 업로드/가져오기 기능 실행 (팝업 또는 새 페이지) |
        | LS-TOP-02         | [내보내기] 아이콘 버튼             | 아이콘 버튼 | 클릭 시 현재 조회된 임대 현황 목록을 파일(Excel, CSV 등) 형태로 다운로드 |

    * **B. KPI 요약 정보 영역:**
        | UI 요소 ID (선택) | 요소명 (Label) | 유형 (Type)      | 예시 값/설명                                                 |
        | :---------------- | :------------- | :--------------- | :----------------------------------------------------------- |
        | LS-KPI-01         | 임대율         | 텍스트 + 진행 바 | "85%" (전체 20세대 중 17세대 임대중, 3세대 공실)             |
        | LS-KPI-02         | 총 임대 수입   | 텍스트           | "45,000,000원" (월 임대료 총액 2,100만원, 공실 2세대). *표시 기준(월/년/보증금총액 등) 명확화 필요* |
        | LS-KPI-03         | 계약 만료 예정 | 텍스트           | "3세대" (3개월 이내 계약 만료 예정 세대)                     |

    * **C. 계약 만료 임박 알림 영역:**
        | UI 요소 ID (선택) | 요소명 (Label)      | 유형 (Type)        | 예시 값/설명                                                 |
        | :---------------- | :------------------ | :----------------- | :----------------------------------------------------------- |
        | LS-NTF-01         | 계약 만료 임박 알림 | 알림 영역 (텍스트) | "현재 2건의 계약이 90일 이내에 만료될 예정입니다. 갱신 또는 종료 처리가 필요합니다." |

    * **D. 필터 및 검색 영역:**
        | UI 요소 ID (선택) | 요소명 (Label)      | 유형 (Type) | 기본값/표시 데이터                           | 동작 설명                                             |
        | :---------------- | :------------------ | :---------- | :------------------------------------------- | :---------------------------------------------------- |
        | LS-FLT-TTL        | 필터 및 검색 (제목) | 텍스트      | "필터 및 검색"                               |                                                       |
        | LS-FLT-SUB        | (부제목)            | 텍스트      | "조회할 데이터를 필터링하세요"               |                                                       |
        | LS-FLT-01         | 계약 상태           | 드롭다운    | 전체                                         | 계약 상태(전체, 임대중, 공실, 만료 예정 등) 선택 필터 |
        | LS-FLT-02         | 건물 선택 (가정)    | 드롭다운    | 전체                                         | 관리하는 건물이 여러 개일 경우 특정 건물 선택 필터    |
        | LS-FLT-03         | 세대/임차인 검색    | 입력 필드   | "Q 세대 번호 또는 임차인 검색" (Placeholder) | 키워드 입력                                           |
        | LS-FLT-04         | [필터 적용] 버튼    | 버튼        | -                                            | 선택/입력된 조건으로 아래 목록을 다시 조회            |

    * **E. 뷰 모드 전환 영역:**
        | UI 요소 ID (선택) | 요소명 (Label) | 유형 (Type) | 기본값/표시 데이터 | 동작 설명                                          |
        | :---------------- | :------------- | :---------- | :----------------- | :------------------------------------------------- |
        | LS-VIEW-01        | 목록 형식      | 버튼/탭     | (선택됨)           | 임대 현황을 테이블 목록 형태로 표시                |
        | LS-VIEW-02        | 시각화 형식    | 버튼/탭     | -                  | 임대 현황을 차트, 그래프, 맵 등 시각화 형태로 표시 |

    * **F. 임대 현황 목록 테이블 영역:**
        | UI 요소 ID (선택) | 요소명 (Label)        | 유형 (Type)        | 기본값/표시 데이터                   | 동작 설명                                       |
        | :---------------- | :-------------------- | :----------------- | :----------------------------------- | :---------------------------------------------- |
        | LS-TBL-TTL        | 임대 현황 목록 (제목) | 텍스트             | "임대 현황 목록"                     |                                                 |
        | LS-TBL-SUB        | (부제목)              | 텍스트             | "건물 내 각 세대의 임대 현황입니다." |                                                 |
        | LS-TBL-01         | 임대 현황 목록표      | 표                 | -                                    | 세대별 상세 임대 정보 표시                      |
        | (표 컬럼)         | 세대                  | 텍스트             | (예: @ 1001)                         | 호실 정보 (건물명 약자 또는 동 + 호수)          |
        | (표 컬럼)         | 층                    | 텍스트             | (예: 10F)                            | 해당 호실의 층 정보                             |
        | (표 컬럼)         | 면적                  | 텍스트             | (예: 85㎡)                           | 해당 호실의 면적 정보                           |
        | (표 컬럼)         | 상태                  | 텍스트 (배지 형태) | (예: 임대중)                         | 현재 호실의 임대 상태 (임대중, 공실, 수리중 등) |
        | (표 컬럼)         | 임차인                | 텍스트             | (예: 김철수)                         | 현재 임차인 명칭 (공실 시 비어있음)             |
        | (표 컬럼)         | 임대료                | 통화               | (예: 2,500,000원)                    | 해당 계약의 (월)임대료                          |
        | (표 컬럼)         | 계약 만료일           | 날짜 (YYYY-MM-DD)  | (예: 2025-12-31)                     | 현재 계약의 만료 예정일                         |
        | LS-TBL-BTM-01     | 조회 결과 건수        | 텍스트             | (표시되지 않음)                      | (이미지에는 없으나, "총 X건 조회" 등 표시 가능) |
        | LS-TBL-PAG        | 페이지네이션          | 페이지네이션       | (표시되지 않음)                      | (이미지에는 없으나, 목록 많을 시 필요)          |

#### 3.3. 주요 사용자 시나리오 (흐름)
- **시나리오 1: 전체 임대 현황 및 KPI 확인**
    1. 관리자가 QIRO 시스템 로그인 후 [임대 현황] 메뉴를 선택한다.
    2. 시스템은 기본 필터(예: 전체 건물, 전체 계약 상태)로 임대 현황 화면을 로드한다.
    3. 상단에 주요 KPI(임대율, 총 임대 수입, 계약 만료 예정 건수)와 계약 만료 임박 알림이 표시된다.
    4. 하단에는 전체 세대의 임대 현황 목록이 테이블 형태로 표시된다.
- **시나리오 2: 특정 조건으로 임대 현황 필터링 및 검색**
    1. 관리자가 '필터 및 검색' 영역에서 [계약 상태]를 '공실'로 선택한다.
    2. (선택) 특정 건물을 선택한다.
    3. (선택) '세대/임차인 검색' 필드에 특정 키워드(예: "301호", "홍길동")를 입력한다.
    4. [필터 적용] 버튼을 클릭한다.
    5. 시스템은 지정된 조건에 맞는 임대 현황 목록만 테이블에 표시하고, 상단 KPI도 해당 필터 기준으로 재계산하여 보여줄 수 있다 (정책에 따라).
- **시나리오 3: 임대 현황 데이터 내보내기**
    1. 관리자가 원하는 조건으로 임대 현황 목록을 조회한다.
    2. 화면 상단의 [내보내기] 아이콘 버튼을 클릭한다.
    3. 시스템은 현재 조회된 목록의 데이터를 Excel 또는 CSV 파일로 생성하여 다운로드할 수 있도록 제공한다.
- **시나리오 4: (선택) 임대 현황 시각화 뷰 확인**
    1. 관리자가 '뷰 모드 전환' 영역에서 [시각화 형식] 버튼/탭을 클릭한다.
    2. 시스템은 현재 임대 현황 데이터를 차트(예: 월별 임대율 변화, 상태별 분포도) 또는 건물/층별 임대 상태 맵 등의 시각화된 형태로 표시한다.

### 4. 데이터 요구사항
#### 4.1. 입력 데이터 (필터링/검색용)
- 건물 ID (선택)
- 계약 상태 (선택)
- 검색 키워드 (세대번호, 임차인명, 임대인명 등)
- 계약 만료일 범위 (선택)

#### 4.2. 출력 데이터 (화면 표시 및 내보내기용)
- **KPI 요약:** 임대율(%), 총 임대 수입(금액), 계약 만료 예정(건수).
- **목록 데이터 (각 세대별):** 세대번호, 층, 면적, 현재 임대 상태(임대중/공실 등), 임차인명(임대중일 경우), (월)임대료, 계약 만료일, (계산된) 계약 남은 기간.
- **내보내기 파일:** 위 목록 데이터를 포함하는 Excel, CSV 파일.

#### 4.3. 주요 참조 엔티티
- `Building` (건물 정보)
- `Unit` (세대/호실 정보 - 층, 면적, 현재 상태 등)
- `LeaseContract` (임대 계약 정보 - 임차인ID, 임대료, 계약기간, 계약상태 등)
- `Tenant` (임차인 정보 - 임차인명 등)

### 5. 처리 로직 및 비즈니스 규칙
- **R-LSSTAT-001 (KPI 계산 - 임대율):** `(현재 '임대중' 상태인 총 세대 수 / 관리 대상 총 세대 수) * 100` (선택된 건물 범위 기준).
- **R-LSSTAT-002 (KPI 계산 - 총 임대 수입):** 선택된 범위 내 '계약중' 상태인 모든 계약의 (월)임대료 합계. (또는 화면 KPI 정의에 따라 다른 기준 적용 가능 - 예: 연간 총액, 총 보증금액)
- **R-LSSTAT-003 (KPI 계산 - 계약 만료 예정):** 선택된 범위 내 '계약중' 상태이면서 계약 종료일이 현재로부터 X일(예: 90일) 이내인 계약 건수. 알림 영역에도 동일한 기준 적용.
- **R-LSSTAT-004 (세대 상태 결정):** 각 세대의 '상태'는 연결된 유효한 `LeaseContract`의 현재 '계약 상태'에 따라 결정된다. (예: 유효한 '계약중' 계약이 있으면 '임대중', 없으면 '공실'. '수리중', '임대불가' 등 추가 상태 가능).
- **R-LSSTAT-005 (계약 남은 기간 계산):** `(계약 종료일 - 현재 날짜)`를 일(day) 수 또는 개월 수로 계산하여 표시. 특정 임계치 이하일 경우 시각적 강조.
- **R-LSSTAT-006 (필터링 및 검색):** 사용자가 선택/입력한 조건에 따라 `Unit`, `LeaseContract`, `Tenant` 테이블을 조합하여 결과를 조회한다.
- **R-LSSTAT-007 (내보내기):** 현재 화면에 필터링/검색된 목록 기준으로 데이터를 추출하여 파일 생성. (대용량 데이터의 경우 비동기 처리 고려)
- **R-LSSTAT-008 (파일 업로드/가져오기 - 선택 사항):** (기능이 확정되면 상세 로직 기술 필요 - 예: 특정 형식의 파일(CSV, Excel)을 읽어들여 다수 세대의 임대 상태 또는 기본 정보를 일괄 업데이트. 업데이트 전 유효성 검증 및 미리보기 기능 포함.)

### 6. 오류 처리 및 예외 관리
| 오류 코드 (선택) | 발생 조건                                 | 오류 메시지 (User-facing)                                    |
| :--------------- | :---------------------------------------- | :----------------------------------------------------------- |
| E-LSSTAT-01      | 데이터 조회 중 오류 발생                  | "임대 현황 데이터를 불러오는 중 오류가 발생했습니다."        |
| E-LSSTAT-02      | 필터/검색 조건 적용 중 오류               | "필터 적용 중 오류가 발생했습니다. 조건을 다시 확인해주세요." |
| E-LSSTAT-03      | 내보내기 파일 생성 실패                   | "파일 내보내기 중 오류가 발생했습니다."                      |
| E-LSSTAT-04      | (파일 업로드 시) 파일 형식 또는 내용 오류 | "업로드한 파일의 형식이 올바르지 않거나, 내용에 오류가 있습니다." |

### 7. (기능별) 성능 요구사항
- P-LSSTAT-01: 임대 현황 화면 초기 로드 및 KPI 요약 정보 표시까지 3초 이내.
- P-LSSTAT-02: 목록 조회 (필터/검색 적용, 1,000개 세대 기준) 시 3초 이내 응답.
- P-LSSTAT-03: 데이터 내보내기(1,000건 기준) 시 10초 이내 파일 생성 및 다운로드 시작.

### 8. (기능별) 보안 요구사항
- S-LSSTAT-01: 임대 현황 조회 기능은 인가된 관리자 역할(총괄관리자, 관리소장, 경리담당자 등)만 접근 가능하다.
- S-LSSTAT-02: 사용자의 권한 범위에 따라 조회 가능한 건물/데이터 범위가 제한될 수 있다 (예: 관리소장은 담당 건물 현황만 조회).
- S-LSSTAT-03: 내보내기되는 데이터에 개인정보가 포함될 경우, 관련 법규(개인정보보호법)를 준수하는 방식으로 처리되어야 하며, 다운로드 이력이 기록될 수 있다.

### 9. 다른 기능/모듈과의 연관성
- **건물/호실 정보 관리:** 임대 현황의 기본 단위인 건물 및 호실(세대)의 정보(면적, 층, 총 세대수 등)를 제공받는다.
- **임대 계약 관리:** 각 호실의 임대 상태(임대중/공실), 임차인 정보, 임대료, 계약 기간 등 핵심 데이터를 제공받는다. 본 화면의 정보는 대부분 '임대 계약 관리'의 데이터를 요약/집계하여 보여주는 것이다.
- **임차인 관리:** 임차인 명칭 등 관련 정보를 제공받는다.
- **(선택) 알림 서비스:** 계약 만료 임박 등의 주요 이벤트 발생 시 알림을 생성하고 사용자에게 통지하는 기능과 연동될 수 있다.

### 10. (선택 사항) 테스트 고려 사항
- 다양한 건물/세대/계약 상태 조합에 따른 KPI 계산(임대율, 총수입, 만료예정) 정확성 검증.
- 모든 필터 및 검색 조건 조합에 대한 결과 정확성 테스트.
- 계약 상태 변경(신규, 갱신, 해지) 시 임대 현황 화면(KPI, 목록)에 실시간 또는 적절한 주기로 반영되는지 확인.
- '남은 기간' 계산 및 만료 임박 강조 표시 정확성 테스트.
- 데이터 내보내기 기능의 다양한 형식(Excel, CSV) 및 데이터 범위 정확성 테스트.
- (파일 업로드 기능 구현 시) 다양한 정상/오류 케이스 파일에 대한 업로드 및 데이터 반영 테스트.
- (시각화 뷰 구현 시) 데이터 시각화 내용의 정확성 및 사용성 테스트.

### 11. 용어 정의 (선택 사항)
- **임대율 (Occupancy Rate):** 전체 임대 가능 면적 또는 세대 수 대비 현재 임대 계약이 체결되어 사용 중인 면적 또는 세대 수의 비율.
- **공실 (Vacancy):** 임대 계약이 체결되지 않아 비어 있는 세대 또는 공간.
- **KPI (Key Performance Indicator):** 핵심 성과 지표. 임대 운영 상태를 파악하기 위한 주요 데이터 요약.

### 12. 문서 이력
| 버전 | 날짜             | 작성자      | 주요 변경 내용                    |
| :--- | :--------------- | :---------- | :-------------------------------- |
| 1.0  | 2025년 06월 02일 | QIRO 기획팀 | 초기 명세서 안 작성 (이미지 기반) |

---