# 💰 QIRO - 임대료 관리 기능 명세서

## 1. 문서 정보
- **문서명:** QIRO - 임대료 관리 기능 명세서
- **기능 ID (선택 사항):** F-RENTMGMT-001 (Rent Management)
- **관련 요구사항 ID:** (예: QIRO-FR-LM-030, QIRO-FR-FE-010)
- **관련 사용자 스토리 ID:** (예: US-AS-XXX, US-BM-XXX)
- **작성일:** 2025년 06월 02일
- **최종 수정일:** 2025년 06월 02일
- **작성자:** QIRO 기획팀
- **검토자/승인자 (선택 사항):** (이름 또는 팀)
- **문서 버전:** 1.0

## 2. 기능 개요
### 2.1. 목적
QIRO 서비스 내에서 체결된 임대 계약을 기반으로 각 임차인의 월별 임대료 납부 의무를 생성하고, 실제 납부 현황을 기록하며, 미납 및 연체 상태를 효과적으로 추적 관리한다. 이를 통해 안정적인 임대 수익 관리를 지원하고, 관련 회계 처리의 정확성을 높인다.

### 2.2. 설명
본 기능은 "임대 계약 관리"에서 정의된 계약 조건(임대료, 납부일, 납부 주기 등)에 따라 매월(또는 해당 주기별) 임차인이 납부해야 할 임대료 내역(이하 '월별 임대료 청구분')을 자동으로 생성하거나 관리자가 확인할 수 있도록 한다. 실제 임대료 납부 시 해당 내역을 기록(수납 처리)하고, 납부 기한 경과 시 미납/연체로 처리하여 관련 통계 및 보고서를 제공한다.
(참고: 임대료가 관리비 고지서에 합산되어 청구되는 경우, 이 기능은 관리비 모듈의 '수납 처리'와 긴밀히 연동되거나 해당 모듈 내에서 임대료 항목을 구분하여 관리하는 방식으로 구현될 수 있다.)

### 2.3. 범위
- **In-Scope (포함 범위):**
    - 활성 임대 계약 기반 월별 임대료 청구분 자동 생성 (또는 수동 생성/확인).
    - 월별 임대료 청구분 목록 조회 (건물별, 임차인별, 납부 상태별 필터링 및 검색).
    - 임대료 납부 내역 기록 (수납일, 납부 금액, 납부 방법 등 - "수납 처리" 기능과 연동 또는 유사 기능).
    - 임대료 납부 상태 관리 (`청구됨`, `부분납부`, `완납`, `미납`, `연체`).
    - 임대료 미납/연체 현황 조회 및 관리.
    - (선택) 미납/연체 임차인 대상 알림(예: SMS, 이메일) 발송 연동 기초 데이터 제공.
    - (선택) 계약 조건에 따른 연체료 자동 계산 로직 (또는 수동 입력).
    - 임대료 수납 현황 관련 기본 보고서 조회 (예: 월별 수납액, 미납액 현황).
- **Out-of-Scope (제외 범위):**
    - 임대 계약 조건 자체의 설정 (이는 "임대 계약 관리" 기능).
    - 관리비 등 기타 비용의 청구 및 수납 (이는 별도 "관리비 관리" 및 "수납 처리" 기능).
    - 실제 은행 연동을 통한 자동 입금 확인 및 대사 (초기 버전 제외, 향후 확장 고려).
    - 상세 회계 전표 자동 생성 (회계 관리 기능과 연동, 본 기능은 기초 데이터 제공).

## 3. 사용자 인터페이스 (UI) 및 상호작용
### 3.1. 관련 화면
- `관리자 포털 > 임대 관리 > 임대료 관리`
- `관리자 포털 > 임대 관리 > 임대 계약 관리 > [계약 선택] > 임대료 납부 현황 탭` (상세 조회 시)

### 3.2. UI 요소별 상세 설명 (예시)
- **화면 1: 월별 임대료 관리 목록 화면**
    | UI 요소 ID (선택) | 요소명 (Label)             | 유형 (Type)       | 기본값/표시 데이터 | 동작 설명                                                    | 비고                                             |
    | :---------------- | :------------------------- | :---------------- | :----------------- | :----------------------------------------------------------- | :----------------------------------------------- |
    | RM-LST-01         | [청구 연월] 선택           | 드롭다운/날짜선택 | 현재 연월          | 조회할 임대료 청구 대상 연월 선택                            |                                                  |
    | RM-LST-02         | [건물/동/호실] 필터        | 드롭다운/검색     | 전체               | 특정 건물/동/호실의 임대료 내역만 필터링                     |                                                  |
    | RM-LST-03         | [납부 상태] 필터           | 드롭다운          | 전체               | `청구됨`, `완납`, `미납` 등 상태별 필터링                    |                                                  |
    | RM-LST-04         | [검색] 입력 필드           | 입력 필드         | -                  | 임차인명, 계약번호 등으로 검색                               |                                                  |
    | RM-LST-05         | [검색] 버튼                | 버튼              | -                  | 입력된 조건으로 목록 조회                                    |                                                  |
    | RM-LST-06         | 임대료 청구/수납 목록      | 표                | -                  | 호실, 임차인, 계약번호, 청구금액, 납부금액, 납부일, 상태, 미납액, (수납처리 버튼) 등을 표시 | 정렬, 클릭 시 상세 팝업 또는 수납 처리 화면 이동 |
    | RM-LST-07         | (표 내부) [수납 처리] 버튼 | 버튼/링크         | -                  | 해당 건에 대한 수납 정보 입력 팝업 호출                      | '미납' 또는 '부분납부' 상태일 때 활성화          |
    | RM-LST-08         | 요약 정보 표시 영역        | 텍스트/차트       | -                  | 선택된 조건의 총 청구액, 총 수납액, 총 미납액, 수납률 등 요약 표시 |                                                  |
    | RM-LST-09         | 페이지네이션               | 페이지네이션      | 1                  | 목록이 많을 경우 페이지 이동                                 |                                                  |

- **화면 2: 임대료 수납 처리 팝업/화면** (기존 "수납 처리" 기능 명세서의 UI와 유사하거나 통합될 수 있음)
    | UI 요소 ID (선택) | 요소명 (Label)           | 유형 (Type)       | 기본값/표시 데이터 | 동작 설명                                                    | 유효성 규칙/제약조건                   |
    | :---------------- | :----------------------- | :---------------- | :----------------- | :----------------------------------------------------------- | :------------------------------------- |
    | RM-PAY-01         | 대상 정보 (호실, 임차인) | 텍스트 (읽기전용) | (선택된 건)        | 수납 처리 대상 호실, 임차인명, 해당월 청구액, 기납부액, 현재 미납액 표시 |                                        |
    | RM-PAY-02         | 납부일                   | 날짜 선택         | 오늘 날짜          | 실제 임대료 납부일 입력                                      | 필수, 청구월 이후                      |
    | RM-PAY-03         | 납부 금액                | 숫자 입력         | (미납액)           | 실제 납부된 금액 입력                                        | 필수, 숫자, 0 초과                     |
    | RM-PAY-04         | 납부 방법                | 드롭다운          | 계좌이체           | 은행이체, 현금, 카드 등 선택                                 | 필수                                   |
    | RM-PAY-05         | 납부자명 (선택)          | 입력 필드         | (임차인명)         | 실제 납부자 이름 (임차인과 다를 경우)                        |                                        |
    | RM-PAY-06         | 수납 메모 (선택)         | 텍스트 영역       | -                  | 수납 관련 특이사항 기록                                      |                                        |
    | RM-PAY-07         | [저장], [취소] 버튼      | 버튼              |                    |                                                              | 입력 금액 유효성(예: 미납액 초과 여부) |

#### 3.3. 주요 사용자 시나리오 (흐름)
- **시나리오 1: 월별 임대료 청구 내역 자동 생성 확인 및 수동 조정 (필요시)**
    1. 관리자가 특정 '청구 연월'을 선택하여 '월별 임대료 관리 목록 화면'을 조회한다.
    2. 시스템은 해당 연월에 도래하는 활성 임대 계약들을 기반으로 자동 생성된 월별 임대료 청구분 목록을 표시한다. (각 건은 '청구됨' 상태)
    3. 관리자는 목록을 검토하고, (필요시 시스템 정책에 따라) 특정 건에 대해 예외적인 조정(예: 일시적 감면 반영 - 별도 기능)을 수행할 수 있다.
- **시나리오 2: 임대료 납부 내역 기록 (개별 건)**
    1. 관리자가 '월별 임대료 관리 목록 화면'에서 수납 처리할 건(예: '미납' 상태)의 [수납 처리] 버튼을 클릭한다.
    2. '임대료 수납 처리 팝업/화면'이 표시되고, 해당 건의 청구 정보가 나타난다.
    3. 관리자가 실제 납부일, 납부 금액, 납부 방법 등을 입력하고 [저장] 버튼을 클릭한다.
    4. 시스템은 수납 정보를 저장하고, 해당 건의 납부 상태(예: '완납', '부분납부') 및 미납액을 업데이트한다. 목록 화면에도 변경 사항이 반영된다.
- **시나리오 3: 미납 임대료 현황 조회 및 관리**
    1. 관리자가 '월별 임대료 관리 목록 화면'에서 [납부 상태] 필터를 '미납' 또는 '연체'로 설정하고 조회한다.
    2. 시스템은 해당 조건의 임대료 미납 건 목록을 표시한다.
    3. 관리자는 목록을 확인하고, (필요시) 미납 임차인에게 연락하거나, 시스템과 연동된 알림 기능을 통해 미납 안내를 발송할 수 있다.

### 4. 데이터 요구사항
#### 4.1. 입력 데이터
- **시스템 자동 생성:**
    - 임대 계약 ID, 청구 연월, 계약상 임대료 금액, 납부 예정일.
- **사용자 입력 (수납 처리 시):**
    - 실제 납부일, 납부 금액, 납부 방법, 납부자명, 수납 메모.

#### 4.2. 출력 데이터 (화면 표시 및 보고서용)
- 월별/건물별/임차인별 임대료 청구 및 수납 현황.
- 미납/연체 목록 및 상세 내역.
- 기간별 임대료 수입 통계.

#### 4.3. 월별 임대료 원장 (MonthlyRentLedger) 엔티티 속성 (예시)
| 속성명 (Attribute)     | 데이터 타입 (Type)  | 필수 | 설명                                                         |
| :--------------------- | :------------------ | :--- | :----------------------------------------------------------- |
| `rentLedgerId`         | UUID / Long (PK)    | Y    | 임대료 원장 고유 ID                                          |
| `contractId`           | UUID / Long (FK)    | Y    | 관련 임대 계약 ID (LeaseContract 참조)                       |
| `unitId`               | UUID / Long (FK)    | Y    | 해당 호실 ID                                                 |
| `tenantId`             | UUID / Long (FK)    | Y    | 해당 임차인 ID                                               |
| `billingYearMonth`     | String (YYYY-MM)    | Y    | 청구 연월                                                    |
| `rentDueDate`          | Date                | Y    | 해당월 임대료 납부 예정일 (계약 기반 자동 생성)              |
| `billedRentAmount`     | BigDecimal / Double | Y    | 해당월 청구 임대료 금액 (계약 기반 자동 생성, 조정 가능)     |
| `paidAmount`           | BigDecimal / Double | Y    | 실제 납부된 총 금액 (초기값 0)                               |
| `unpaidAmount`         | BigDecimal / Double | Y    | 미납 금액 (billedRentAmount - paidAmount, 자동 계산)         |
| `paymentStatus`        | Enum / String       | Y    | 납부 상태 (예: `BILLED`, `PARTIALLY_PAID`, `FULLY_PAID`, `OVERDUE`) |
| `lastPaymentDate`      | Date                | N    | 최종 납부일                                                  |
| `lateFeeApplied`       | BigDecimal / Double | N    | (적용 시) 연체료 금액                                        |
| `remarks`              | Text                | N    | 관련 비고 (예: 감면 사유, 분할 납부 약정 등)                 |
| ... (생성/수정일시 등) |                     |      |                                                              |

*(참고: 실제 `수납 이력`은 별도의 `PaymentHistory` 테이블에서 관리하고, `MonthlyRentLedger`의 `paidAmount`는 이력의 합계로 업데이트될 수 있음. 이는 "수납 처리 기능 명세서"와 정합성 유지 필요)*

### 5. 처리 로직 및 비즈니스 규칙
- **R-RENTMGMT-001:** 매월 초(또는 지정된 일자)에 시스템은 활성 상태인 모든 임대 계약을 기준으로 해당 월의 임대료 청구분(`MonthlyRentLedger` 레코드)을 자동으로 생성한다. (상태: `BILLED`)
- **R-RENTMGMT-002:** 임대료 수납 처리 시, 납부 금액에 따라 `paidAmount`가 업데이트되고, `unpaidAmount`가 재계산되며, `paymentStatus`가 변경된다 (예: `PARTIALLY_PAID`, `FULLY_PAID`).
- **R-RENTMGMT-003:** 납부 예정일이 지나도 `unpaidAmount`가 0보다 크면, `paymentStatus`는 `OVERDUE`로 변경될 수 있다.
- **R-RENTMGMT-004 (선택):** 계약 조건에 연체료 규정이 있는 경우, 납부 예정일로부터 특정 일수 경과 시 미납액에 대해 연체료를 자동 계산하여 `lateFeeApplied`에 반영하고 `unpaidAmount`를 조정할 수 있다.
- **R-RENTMGMT-005:** 임대 계약 변경(예: 임대료 조정, 계약 해지) 시, 아직 도래하지 않은 청구월의 `billedRentAmount`는 변경된 계약 조건을 반영하여 업데이트되어야 한다. 이미 청구된 월에 대해서는 정산 처리 규칙 필요.

### 6. 오류 처리 및 예외 관리
| 오류 코드 (선택) | 발생 조건                                  | 오류 메시지 (User-facing)                                    |
| :--------------- | :----------------------------------------- | :----------------------------------------------------------- |
| E-RENTMGMT-01    | 수납 처리 시 필수 입력 항목 누락           | "[필드명]은(는) 필수 입력 항목입니다."                       |
| E-RENTMGMT-02    | 납부 금액이 음수이거나 형식 오류           | "납부 금액은 0보다 큰 숫자로 입력해야 합니다."               |
| E-RENTMGMT-03    | 존재하지 않는 계약/청구분에 대한 수납 시도 | "수납 처리 대상 정보를 찾을 수 없습니다."                    |
| E-RENTMGMT-04    | 과납 처리 시 (정책 미정의 시)              | "청구 금액을 초과하여 납부할 수 없습니다. 분할 납부 또는 예치금 처리를 확인하세요." |

### 7. (기능별) 성능 요구사항
- P-RENTMGMT-01: 월별 임대료 관리 목록 조회(1,000건 계약 기준) 시 2초 이내 응답.
- P-RENTMGMT-02: 수납 처리 저장 시 1초 이내 완료.
- P-RENTMGMT-03: 월초 임대료 청구분 자동 생성 작업(1,000건 계약 기준)은 백그라운드로 5분 이내 완료.

### 8. (기능별) 보안 요구사항
- S-RENTMGMT-01: 임대료 관리 및 수납 처리 기능은 '경리담당자', '관리소장' 등 인가된 역할만 접근 가능하다.
- S-RENTMGMT-02: 임대료 및 수납 관련 금융 정보는 안전하게 처리되며, 주요 변경(수납 등록/수정/삭제) 이력은 감사 로그로 기록된다.

### 9. 다른 기능/모듈과의 연관성
- **임대 계약 관리:** 본 기능의 모든 임대료 청구는 '임대 계약 관리'에 등록된 계약 조건을 기반으로 한다. 계약 변경 시 본 기능의 데이터에 영향을 미친다.
- **수납 처리:** 임대료 수납 기록은 전사적인 "수납 처리" 기능의 일부로 통합되거나, 긴밀하게 연동되어야 한다. 만약 임대료가 관리비에 합산 청구된다면, 본 기능은 관리비의 '임대료 항목'에 대한 상세 관리 역할 수행.
- **회계 관리:** 수납된 임대료는 '임대 수익'으로 회계 처리되어야 한다. 미수 임대료는 '미수금' 계정으로 관리될 수 있다.
- **알림 서비스:** 임대료 납부 예정일 알림, 미납/연체 알림 등을 위해 본 기능의 데이터를 활용할 수 있다.
- **보고서/통계:** 임대료 수입 현황, 미납 현황 등 다양한 보고서의 기초 데이터를 제공한다.

### 10. (선택 사항) 테스트 고려 사항
- 다양한 임대료 납부 주기(월납, 분기납 등)에 대한 청구분 자동 생성 테스트.
- 정상 납부, 부분 납부, 완납, 미납, 연체 등 모든 납부 상태 변경 로직 테스트.
- (구현 시) 연체료 계산 로직의 정확성 검증.
- 계약 변경(임대료 조정, 중도 해지 등) 시 임대료 청구분 데이터 반영 테스트.
- 대량 데이터에 대한 자동 생성 및 조회 성능 테스트.

### 11. 용어 정의 (선택 사항)
- **월별 임대료 청구분 (Monthly Rent Ledger/Billed Rent):** 특정 임대 계약에 대해 해당 청구월에 납부해야 할 것으로 시스템에 기록된 임대료 내역.
- **미납액 (Unpaid Amount):** 납부 기한까지 납부되지 않은 임대료 금액.
- **연체료 (Late Fee):** 납부 기한을 어겼을 때 계약 조건에 따라 추가로 부과되는 금액.

### 12. 문서 이력
| 버전 | 날짜             | 작성자      | 주요 변경 내용      |
| :--- | :--------------- | :---------- | :------------------ |
| 1.0  | 2025년 06월 02일 | QIRO 기획팀 | 초기 명세서 안 작성 |