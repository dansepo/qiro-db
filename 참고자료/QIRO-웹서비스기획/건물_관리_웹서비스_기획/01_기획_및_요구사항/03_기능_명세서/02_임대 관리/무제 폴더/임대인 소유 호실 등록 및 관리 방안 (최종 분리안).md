# **임대인 소유 호실 등록 및 관리 방안 (최종 분리안)**

### **1. 문서 개요**

본 문서는 건물관리 시스템에서 임대인(소유주)과 소유 호실을 연결하는 두 가지 명확히 구분된 시나리오, 즉 **①소유 호실 신규 등록**과 **②소유권 이전**에 대한 전체적인 업무 절차와 화면 설계 방안을 정의합니다. 이 설계는 **소유권 변경 이력(`unit_ownership_history`)**을 완벽하게 지원하는 것을 목표로 합니다.

### **2. 핵심 원칙: "업무 목적에 따른 화면 분리"**

이 설계의 핵심은 가장 빈번하게 발생하는 **'신규 등록'은 매우 빠르고 단순하게** 처리하고, 중요하고 민감한 **'소유권 이전'은 명확하고 안전한 절차**를 통해 처리하도록 화면과 기능을 완전히 분리하는 것입니다.

### **방법 1: 소유 호실 신규 등록 (가장 일반적인 경우)**

> **이럴 때 사용합니다:** 분양 후 최초 소유주를 등록하거나, 기존에 소유주 정보가 없던 호실에 새로운 소유주를 연결할 때 사용합니다.

- **관련 화면:** `[임대 관리] > [임대인 관리]` 목록 화면
- **화면 구성:** 임대인 목록의 각 행(row)마다 소유 호실을 바로 추가할 수 있는 **`[+ 소유 호실 추가]`** 버튼을 제공합니다.

| 임대인명 | 소유 호실 수 | 관리                                   |
| -------- | ------------ | -------------------------------------- |
| 홍길동   | 3            | **`[+ 소유 호실 추가]`** `[상세 보기]` |
| 김철수   | 0            | **`[+ 소유 호실 추가]`** `[상세 보기]` |

- **호실 등록 절차:**
  1. 관리자가 새로운 소유주가 될 '김철수' 옆의 **`[+ 소유 호실 추가]`** 버튼을 클릭합니다.
  2. **'소유 호실 신규 등록' 팝업(Modal) 창**이 나타납니다.

| UI 요소            | 입력 방식            | 설명                                                         |
| ------------------ | -------------------- | ------------------------------------------------------------ |
| **새로운 소유주**  | 고정 텍스트          | **'김철수'** (버튼을 클릭한 행의 임대인)                     |
| **소유 시작일**    | **날짜 선택 (필수)** | 이 소유권이 효력을 **시작**하는 날짜를 선택합니다.           |
| **대상 호실 선택** | **체크박스 목록**    | **오직 '소유주 미지정' 상태인 호실 목록만 표시됩니다.** 이를 통해 실수로 다른 사람의 호실을 등록하는 것을 원천적으로 방지합니다. |


  3.  **[저장]** 버튼을 클릭하면, 시스템은 선택된 호실들에 대해 '김철수'를 새로운 소유주로 하는 **첫 번째 소유권 이력을 생성**합니다.
  4.  목록의 '김철수' 소유 호실 수가 업데이트되어 즉시 변경 사항을 확인할 수 있습니다.

**테이블 등록/갱신 내용:**

1. 사용자가 '소유 시작일'을 `2025-08-01`로, '대상 호실'로 `103호`를 선택하고 **[저장]** 버튼을 클릭합니다.
2. 시스템은 `bms.unit_ownership_history` 테이블에 다음과 같이 **새로운 행을 `INSERT`** 합니다.
   - `unit_id`: 103호의 ID
   - `owner_id`: '김철수'의 ID
   - `effective_start_date`: `2025-08-01`
   - `effective_end_date`: `NULL` (현재 소유주임을 의미)
3. `[임대인 관리]` 목록 화면의 '김철수' 소유 호실 수가 업데이트되어 즉시 변경 사항을 확인할 수 있습니다.



### **방법 2: 소유권 이전 (특수한 경우)**

> **이럴 때 사용합니다:** 매매, 증여 등으로 인해 기존 소유주('홍길동')가 있던 호실의 소유권이 새로운 소유주('김철수')에게 넘어갈 때 사용합니다.

- **관련 화면:** `[건물 정보] > [호실 관리]`에서 소유권을 이전할 호실(예: 101호)을 클릭하여 진입하는 **'호실 상세 관리'** 화면
- **핵심 UI:** 화면의 소유주 정보 영역에 **`[소유주 변경]`** 버튼을 제공합니다.

| 현재 소유주                |                 |
| -------------------------- | --------------- |
| 홍길동 (2020-01-01 ~ 현재) | `[소유주 변경]` |

- **소유권 이전 절차:**
  1. 관리자가 `[소유주 변경]` 버튼을 클릭합니다.
  2. **'소유권 이전' 팝업(Modal) 창**이 나타납니다.

| UI 요소            | 입력 방식            | 설명                                                         |
| ------------------ | -------------------- | ------------------------------------------------------------ |
| **이전 대상 호실** | 고정 텍스트          | **101호**                                                    |
| **현재 소유주**    | 고정 텍스트          | '홍길동'                                                     |
| **새로운 소유주**  | **검색/선택 (필수)** | 시스템에 등록된 소유주 목록에서 새로운 소유주('김철수')를 검색하여 선택합니다. |
| **소유권 변경일**  | **날짜 선택 (필수)** | '김철수'의 소유권이 효력을 **시작**하는 날짜를 선택합니다.   |
| **변경 사유**      | 텍스트 입력          | '매매', '상속' 등 변경 사유를 기입합니다.                    |


3.  **[저장]** 버튼을 클릭하면, 시스템은 다음과 같이 두 가지 작업을 하나의 트랜잭션으로 처리합니다.
    * **(기존 이력 마감):** '홍길동'의 소유 이력의 `종료일`을 '소유권 변경일 - 1일'로 업데이트합니다.
    * **(신규 이력 생성):** '김철수'의 새로운 소유 이력을 '소유권 변경일'부터 시작하는 것으로 생성합니다.

**테이블 등록/갱신 내용:**

1. 사용자가 '소유권 변경일'을 `2025-08-01`로, '새로운 소유주'를 '김철수'로 선택하고 **[저장]** 버튼을 클릭합니다.
2. 시스템은 **하나의 트랜잭션**으로 다음 두 가지 작업을 순차적으로 수행합니다.
   - **① (기존 이력 마감):** `bms.unit_ownership_history` 테이블에서, `unit_id`가 101호이고 `owner_id`가 '홍길동'인 레코드의 `effective_end_date`를 **`2025-07-31`** (변경일 - 1일)로 **`UPDATE`** 합니다.
   - **② (신규 이력 생성):** `bms.unit_ownership_history` 테이블에 다음과 같이 **새로운 행을 `INSERT`** 합니다.
     - `unit_id`: 101호의 ID
     - `owner_id`: '김철수'의 ID
     - `effective_start_date`: `2025-08-01`
     - `effective_end_date`: `NULL`

### **4. 이 방식의 장점**

- **직관적인 UX:** 가장 흔한 작업인 '신규 등록'은 매우 단순하고 빠르게, 중요한 작업인 '소유권 이전'은 명확한 절차를 통해 안전하게 처리할 수 있습니다.
- **오류 감소:** 각 업무의 목적에 맞는 화면과 데이터만 제공하므로, 관리자의 실수를 크게 줄일 수 있습니다.
- **업무의 명확성:** '등록'과 '이전'이라는 실제 업무 용어와 시스템의 기능이 일치하여, 시스템을 배우고 사용하기가 더 쉬워집니다.