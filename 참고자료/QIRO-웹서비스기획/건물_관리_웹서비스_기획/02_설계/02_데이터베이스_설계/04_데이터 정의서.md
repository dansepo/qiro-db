## 📚 QIRO 서비스 데이터 정의서 (Data Dictionary)

### 문서 개요

본 데이터 정의서는 QIRO 서비스의 데이터베이스를 구성하는 각 테이블과 컬럼에 대한 상세한 명세를 기술합니다. 이 문서는 데이터베이스의 구조를 이해하고, 개발 과정에서 데이터의 일관성과 무결성을 유지하며, 향후 유지보수를 용이하게 하는 것을 목적으로 합니다.

**컬럼 설명:**

- **컬럼명 (Column Name):** 데이터베이스 테이블의 실제 물리적 컬럼 이름 (snake_case 표기).
- **데이터 타입 (Data Type):** PostgreSQL 기준의 데이터 타입.
- **제약 조건 (Constraints):** PK(기본키), FK(외래키), NOT NULL, UNIQUE, DEFAULT 등 주요 제약 조건.
- **설명:** 해당 컬럼이 저장하는 데이터의 의미와 역할에 대한 한글 설명.

------

### **Part 1: 사용자, 건물, 임대차 핵심 엔티티**

------

### 1. 사용자 및 접근 관리 (User & Access Management)

#### 1.1. `internal_user` (내부 사용자/직원 계정)

- **테이블 설명:** QIRO 시스템을 사용하는 건물 관리 회사 또는 사업장의 내부 직원 계정 정보를 저장합니다.

| **컬럼명**         | **데이터 타입**            | **제약조건**                    | **설명**                                   |
| ------------------ | -------------------------- | ------------------------------- | ------------------------------------------ |
| `user_id`          | `UUID`                     | PK, DEFAULT `gen_random_uuid()` | 사용자 고유 ID                             |
| `email`            | `VARCHAR(255)`             | NOT NULL, UNIQUE                | 로그인 ID로 사용될 이메일 주소             |
| `password_hash`    | `VARCHAR(255)`             | NOT NULL                        | Bcrypt 등으로 해시된 비밀번호              |
| `name`             | `VARCHAR(50)`              | NOT NULL                        | 사용자 이름                                |
| `department`       | `VARCHAR(100)`             |                                 | 소속 부서                                  |
| `position`         | `VARCHAR(100)`             |                                 | 직책                                       |
| `contact_number`   | `VARCHAR(20)`              |                                 | 연락처                                     |
| `status`           | `VARCHAR(20)`              | NOT NULL, DEFAULT `'ACTIVE'`    | 계정 상태 (`ACTIVE`, `INACTIVE`, `LOCKED`) |
| `mfa_enabled`      | `BOOLEAN`                  | NOT NULL, DEFAULT `false`       | 2단계 인증(MFA) 사용 여부                  |
| `last_login_at`    | `TIMESTAMP WITH TIME ZONE` |                                 | 최근 로그인 일시                           |
| `created_at`       | `TIMESTAMP WITH TIME ZONE` | NOT NULL, DEFAULT `now()`       | 생성일시                                   |
| `created_by`       | `VARCHAR(50)`              |                                 | 생성자 ID (또는 이메일)                    |
| `last_modified_at` | `TIMESTAMP WITH TIME ZONE` | NOT NULL, DEFAULT `now()`       | 최종수정일시                               |
| `last_modified_by` | `VARCHAR(50)`              |                                 | 최종수정자 ID (또는 이메일)                |

#### 1.2. `role` (역할)

- **테이블 설명:** 사용자에게 부여할 수 있는 역할(권한 그룹)을 정의합니다.

| **컬럼명**         | **데이터 타입**            | **제약조건**              | **설명**                                                   |
| ------------------ | -------------------------- | ------------------------- | ---------------------------------------------------------- |
| `role_id`          | `VARCHAR(50)`              | PK                        | 역할 고유 ID (코드, 예: `SUPER_ADMIN`, `BUILDING_MANAGER`) |
| `role_name`        | `VARCHAR(100)`             | NOT NULL, UNIQUE          | 역할명 (예: 총괄관리자, 관리소장)                          |
| `description`      | `TEXT`                     |                           | 역할 상세 설명                                             |
| `is_system_role`   | `BOOLEAN`                  | NOT NULL, DEFAULT `false` | 시스템 기본 제공 역할 여부 (수정/삭제 제한)                |
| `created_at`       | `TIMESTAMP WITH TIME ZONE` | NOT NULL, DEFAULT `now()` | 생성일시                                                   |
| `last_modified_at` | `TIMESTAMP WITH TIME ZONE` | NOT NULL, DEFAULT `now()` | 최종수정일시                                               |

#### 1.3. `user_role_link` (사용자-역할 매핑)

- **테이블 설명:** 사용자와 역할 간의 다대다(M:N) 관계를 연결합니다.

| **컬럼명** | **데이터 타입** | **제약조건**                       | **설명**  |
| ---------- | --------------- | ---------------------------------- | --------- |
| `user_id`  | `UUID`          | PK, FK to `internal_user(user_id)` | 사용자 ID |
| `role_id`  | `VARCHAR(50)`   | PK, FK to `role(role_id)`          | 역할 ID   |

------

### 2. 건물 및 호실 정보 관리 (Building & Unit Information Management)

#### 2.1. `building` (건물)

- **테이블 설명:** 관리 대상 건물(단지)의 마스터 정보를 저장합니다.

| **컬럼명**              | **데이터 타입** | **제약조건**                    | **설명**                                                |
| ----------------------- | --------------- | ------------------------------- | ------------------------------------------------------- |
| `building_id`           | `UUID`          | PK, DEFAULT `gen_random_uuid()` | 건물 고유 ID                                            |
| `building_name`         | `VARCHAR(100)`  | NOT NULL                        | 건물명 (예: QIRO 프리미엄 타워, 행복아파트)             |
| `address_zip_code`      | `VARCHAR(10)`   |                                 | 우편번호                                                |
| `address_street`        | `VARCHAR(255)`  | NOT NULL                        | 도로명/지번 주소                                        |
| `address_detail`        | `VARCHAR(255)`  |                                 | 상세 주소                                               |
| `building_type_code`    | `VARCHAR(20)`   | NOT NULL                        | 건물 유형 코드 (별도 마스터 테이블 또는 Enum)           |
| `total_unit_count`      | `INTEGER`       | NOT NULL, DEFAULT 0             | 관리 대상 총 세대(호실) 수                              |
| `management_start_date` | `DATE`          | NOT NULL                        | QIRO 시스템 관리 시작일                                 |
| `status`                | `VARCHAR(20)`   | NOT NULL, DEFAULT `'ACTIVE'`    | 건물 관리 상태 (`ACTIVE`, `INACTIVE`, `PREPARING_MGMT`) |
| `remarks`               | `TEXT`          |                                 | 건물 관련 비고                                          |
| ... (감사 필드)         |                 |                                 |                                                         |

#### 2.2. `unit` (호실/세대)

- **테이블 설명:** 건물 내 개별 호실(세대, 상가 등)의 상세 정보를 저장합니다.

| **컬럼명**                  | **데이터 타입**                           | **제약조건**                    | **설명**                                                     |
| --------------------------- | ----------------------------------------- | ------------------------------- | ------------------------------------------------------------ |
| `unit_id`                   | `UUID`                                    | PK, DEFAULT `gen_random_uuid()` | 호실 고유 ID                                                 |
| `building_id`               | `UUID`                                    | NOT NULL, FK to `building`      | 소속 건물 ID                                                 |
| `dong_name`                 | `VARCHAR(50)`                             |                                 | 동 명칭 (예: 101동, A동) - 단일 동 건물은 null 또는 기본값   |
| `unit_number`               | `VARCHAR(20)`                             | NOT NULL                        | 호실 번호 (예: 101, B203)                                    |
| `floor`                     | `VARCHAR(10)`                             | NOT NULL                        | 소재 층 (예: 10, "B1")                                       |
| `unit_type_code`            | `VARCHAR(20)`                             | NOT NULL                        | 호실 유형 코드 (별도 마스터 테이블 또는 Enum)                |
| `exclusive_area`            | `NUMERIC(10, 2)`                          | NOT NULL                        | 전용 면적 (㎡)                                               |
| `contract_area`             | `NUMERIC(10, 2)`                          |                                 | 계약 면적 (㎡)                                               |
| `current_status`            | `VARCHAR(20)`                             | NOT NULL, DEFAULT `'VACANT'`    | 현재 호실 상태 (`VACANT`, `LEASED`, `UNDER_REPAIR`, `NOT_FOR_LEASE`) |
| `current_lessor_id`         | `UUID`                                    | FK to `lessor`                  | 현재 연결된 주 임대인 ID (선택 사항)                         |
| `current_tenant_id`         | `UUID`                                    | FK to `tenant`                  | 현재 연결된 주 임차인 ID (선택 사항, 임대중일 경우)          |
| `current_lease_contract_id` | `UUID`                                    | FK to `lease_contract`          | 현재 유효한 임대 계약 ID (선택 사항)                         |
| ... (감사 필드)             |                                           |                                 |                                                              |
| **UNIQUE 제약**             | `building_id`, `dong_name`, `unit_number` |                                 | 동일 건물/동 내 호실번호 중복 방지                           |

------

### 3. 임대인 및 임차인 관리 (Lessor & Tenant Management)

#### 3.1. `lessor` (임대인)

- **테이블 설명:** 건물 소유주(임대인)의 정보를 저장합니다.

| **컬럼명**            | **데이터 타입** | **제약조건**                    | **설명**                                                     |
| --------------------- | --------------- | ------------------------------- | ------------------------------------------------------------ |
| `lessor_id`           | `UUID`          | PK, DEFAULT `gen_random_uuid()` | 임대인 고유 ID                                               |
| `lessor_type`         | `VARCHAR(20)`   | NOT NULL                        | 임대인 구분 (`INDIVIDUAL`, `CORPORATION`, `SOLE_PROPRIETOR`) |
| `name`                | `VARCHAR(100)`  | NOT NULL                        | 임대인명 또는 법인명                                         |
| `representative_name` | `VARCHAR(50)`   |                                 | 대표자명 (법인/개인사업자 시)                                |
| `business_number`     | `VARCHAR(20)`   | UNIQUE                          | 사업자등록번호 (암호화 고려)                                 |
| `contact_number`      | `VARCHAR(20)`   | NOT NULL                        | 주 연락처                                                    |
| `email`               | `VARCHAR(255)`  |                                 | 이메일 주소                                                  |
| `address`             | `TEXT`          |                                 | 주소                                                         |
| `status`              | `VARCHAR(20)`   | NOT NULL, DEFAULT `'ACTIVE'`    | 임대인 관리 상태 (`ACTIVE`, `INACTIVE`)                      |
| ... (감사 필드)       |                 |                                 |                                                              |

#### 3.2. `tenant` (임차인/세대주)

- **테이블 설명:** 임차인(세대주)의 정보를 저장합니다.

| **컬럼명**       | **데이터 타입** | **제약조건**                    | **설명**                                                     |
| ---------------- | --------------- | ------------------------------- | ------------------------------------------------------------ |
| `tenant_id`      | `UUID`          | PK, DEFAULT `gen_random_uuid()` | 임차인 고유 ID                                               |
| `name`           | `VARCHAR(50)`   | NOT NULL                        | 임차인명 (개인 또는 사업체명)                                |
| `contact_number` | `VARCHAR(20)`   | NOT NULL                        | 주 연락처                                                    |
| `email`          | `VARCHAR(255)`  |                                 | 이메일 주소                                                  |
| `status`         | `VARCHAR(20)`   | NOT NULL, DEFAULT `'RESIDING'`  | 임차인 상태 (`RESIDING`, `MOVING_OUT_SCHEDULED`, `MOVED_OUT`, `CONTRACT_PENDING`) |
| ... (감사 필드)  |                 |                                 |                                                              |

------

### 4. 임대 계약 관리 (Lease Contract Management)

#### 4.1. `lease_contract` (임대 계약)

- **테이블 설명:** 임대차 계약의 상세 정보를 저장합니다.

| **컬럼명**           | **데이터 타입**          | **제약조건**                    | **설명**                                                     |
| -------------------- | ------------------------ | ------------------------------- | ------------------------------------------------------------ |
| `contract_id`        | `UUID`                   | PK, DEFAULT `gen_random_uuid()` | 계약 고유 ID                                                 |
| `unit_id`            | `UUID`                   | NOT NULL, FK to `unit`          | 임대 대상 호실 ID                                            |
| `lessor_id`          | `UUID`                   | NOT NULL, FK to `lessor`        | 임대인 ID                                                    |
| `tenant_id`          | `UUID`                   | NOT NULL, FK to `tenant`        | 임차인 ID                                                    |
| `contract_number`    | `VARCHAR(50)`            | UNIQUE                          | 계약 관리 번호 (시스템 자동 채번 또는 수기 입력)             |
| `contract_date`      | `DATE`                   | NOT NULL                        | 계약 체결일                                                  |
| `start_date`         | `DATE`                   | NOT NULL                        | 계약 시작일                                                  |
| `end_date`           | `DATE`                   | NOT NULL                        | 계약 종료일                                                  |
| `deposit_amount`     | `NUMERIC(15, 2)`         | NOT NULL, DEFAULT 0             | 보증금                                                       |
| `rent_amount`        | `NUMERIC(15, 2)`         | NOT NULL, DEFAULT 0             | 월 임대료 (또는 해당 주기 임대료)                            |
| `rent_payment_day`   | `VARCHAR(10)`            | NOT NULL                        | 임대료 납부일 (예: "25", "LAST_DAY")                         |
| `status`             | `VARCHAR(20)`            | NOT NULL                        | 계약 상태 (`SCHEDULED`, `ACTIVE`, `EXPIRING_SOON`, `EXPIRED`, `TERMINATED`, `RENEWED`) |
| `parent_contract_id` | `UUID`                   | FK to `lease_contract`          | 갱신 계약의 경우 이전 계약 ID (Self-referencing)             |
| ... (감사 필드)      |                          |                                 |                                                              |
| **CHECK 제약**       | `end_date >= start_date` |                                 | 계약 종료일은 시작일보다 빠를 수 없음                        |

### 5. 관리비 설정 (Fee Item & Policy Setup)

#### 5.1. `fee_item` (관리비 부과 항목 마스터)

- **테이블 설명:** 관리비에 포함될 수 있는 모든 부과 항목의 종류와 기본 부과 방식을 정의하는 마스터 테이블입니다.

| **컬럼명**             | **데이터 타입**  | **제약조건**                    | **설명**                                                     |
| ---------------------- | ---------------- | ------------------------------- | ------------------------------------------------------------ |
| `fee_item_id`          | `UUID`           | PK, DEFAULT `gen_random_uuid()` | 관리비 항목 고유 ID                                          |
| `item_name`            | `VARCHAR(100)`   | NOT NULL, UNIQUE                | 항목명 (예: 일반관리비, 청소비, 승강기유지비)                |
| `item_category`        | `VARCHAR(30)`    | NOT NULL                        | 항목 대분류 (예: `COMMON_FEE`, `INDIVIDUAL_FEE`, `OTHER_LEVY`) |
| `imposition_method`    | `VARCHAR(30)`    | NOT NULL                        | 부과(배분) 방식 코드 (예: `PER_AREA_RATE`, `TOTAL_COMMON_PER_UNIT_EQUAL`) |
| `default_unit_price`   | `NUMERIC(15, 2)` | DEFAULT 0                       | 기본 단가/금액 (단가 기반 항목일 경우)                       |
| `default_unit`         | `VARCHAR(20)`    |                                 | 기본 단위 (예: 원/세대, 원/㎡)                               |
| `is_vat_applicable`    | `BOOLEAN`        | NOT NULL, DEFAULT `false`       | 부가세 적용 여부                                             |
| `is_active`            | `BOOLEAN`        | NOT NULL, DEFAULT `true`        | 사용 여부 (마스터 항목의 활성 상태)                          |
| `is_system_default`    | `BOOLEAN`        | NOT NULL, DEFAULT `false`       | 시스템 기본 제공 항목 여부 (삭제/주요 변경 제한)             |
| `description`          | `TEXT`           |                                 | 항목 설명                                                    |
| `effective_start_date` | `DATE`           | NOT NULL                        | 적용 시작일                                                  |
| `effective_end_date`   | `DATE`           |                                 | 적용 종료일                                                  |
| ... (감사 필드)        |                  |                                 |                                                              |

#### 5.2. `external_bill_account` (외부 고지서 계정 정보)

- **테이블 설명:** 한전, 수도사업소, 가스회사 등 외부 공급자로부터 받는 건물 단위 공과금 고지서의 고객번호 정보를 관리합니다.

| **컬럼명**                | **데이터 타입** | **제약조건**                    | **설명**                                        |
| ------------------------- | --------------- | ------------------------------- | ----------------------------------------------- |
| `ext_bill_account_id`     | `UUID`          | PK, DEFAULT `gen_random_uuid()` | 외부 고지서 계정 고유 ID                        |
| `building_id`             | `UUID`          | NOT NULL, FK to `building`      | 연결된 건물 ID                                  |
| `customer_number`         | `VARCHAR(50)`   | NOT NULL                        | 공급자가 부여한 고객번호/납부자번호             |
| `utility_type`            | `VARCHAR(30)`   | NOT NULL                        | 공과금 종류 (예: `ELECTRICITY`, `WATER`, `GAS`) |
| `supplier_name`           | `VARCHAR(100)`  | NOT NULL                        | 공급자 명칭                                     |
| `account_nickname`        | `VARCHAR(100)`  | NOT NULL                        | 계정 별칭 (사용자 식별용, 예: 본관 공용 전기)   |
| `meter_number`            | `VARCHAR(50)`   |                                 | 관련 대표 계량기 번호                           |
| `is_for_individual_usage` | `BOOLEAN`       | NOT NULL, DEFAULT `false`       | 개별 사용료 청구 용도 여부                      |
| `is_for_common_usage`     | `BOOLEAN`       | NOT NULL, DEFAULT `false`       | 공용 사용료 청구 대상 여부                      |
| `is_active`               | `BOOLEAN`       | NOT NULL, DEFAULT `true`        | 활성 여부                                       |
| `remarks`                 | `TEXT`          |                                 | 메모                                            |
| ... (감사 필드)           |                 |                                 |                                                 |

#### 5.3. `receiving_bank_account` (관리비 수납 계좌)

- **테이블 설명:** 임차인으로부터 관리비를 수납받는 은행 계좌 정보를 관리합니다.

| **컬럼명**       | **데이터 타입** | **제약조건**                    | **설명**                                     |
| ---------------- | --------------- | ------------------------------- | -------------------------------------------- |
| `account_id`     | `UUID`          | PK, DEFAULT `gen_random_uuid()` | 수납 계좌 고유 ID                            |
| `bank_name`      | `VARCHAR(50)`   | NOT NULL                        | 은행명                                       |
| `account_number` | `VARCHAR(255)`  | NOT NULL, UNIQUE                | 계좌번호 (암호화하여 저장)                   |
| `account_holder` | `VARCHAR(50)`   | NOT NULL                        | 예금주명                                     |
| `purpose`        | `VARCHAR(255)`  |                                 | 계좌 용도 (예: 관리비 수납, 수선유지비 적립) |
| `is_default`     | `BOOLEAN`       | NOT NULL, DEFAULT `false`       | 기본 수납 계좌 여부                          |
| `is_active`      | `BOOLEAN`       | NOT NULL, DEFAULT `true`        | 사용 여부                                    |
| ... (감사 필드)  |                 |                                 |                                              |

#### 5.4. `payment_policy` (납부 정책)

- **테이블 설명:** 시스템 전반 또는 사업장 단위의 납부 관련 기본 정책을 저장합니다. (보통 단일 레코드로 관리)

| **컬럼명**                    | **데이터 타입** | **제약조건** | **설명**                                                     |
| ----------------------------- | --------------- | ------------ | ------------------------------------------------------------ |
| `policy_id`                   | `VARCHAR(50)`   | PK           | 정책 고유 ID (예: `DEFAULT_POLICY`)                          |
| `payment_due_day`             | `VARCHAR(10)`   | NOT NULL     | 매월 납부 마감일 (예: "25", "LAST_DAY")                      |
| `late_fee_rate`               | `NUMERIC(5, 2)` | NOT NULL     | 연체료율 (%)                                                 |
| `late_fee_calculation_method` | `VARCHAR(30)`   | NOT NULL     | 연체료 계산 방식 (예: `DAILY_SIMPLE_INTEREST` - 단리 일할계산) |
| `rounding_policy`             | `VARCHAR(30)`   | NOT NULL     | 금액 반올림/절사 정책 (예: `ROUND_HALF_UP`, `FLOOR`)         |
| ... (감사 필드)               |                 |              |                                                              |

### 6. 청구월 및 월별 데이터 관리 (Billing Month & Monthly Data)

#### 6.1. `billing_month` (청구월)

- **테이블 설명:** 관리비 부과 및 정산의 기준이 되는 특정 연월(청구월)의 마스터 정보 및 상태를 관리합니다.

| **컬럼명**         | **데이터 타입**                                              | **제약조건**                             | **설명**                                              |
| ------------------ | ------------------------------------------------------------ | ---------------------------------------- | ----------------------------------------------------- |
| `billing_month_id` | `UUID`                                                       | PK, DEFAULT `gen_random_uuid()`          | 청구월 고유 ID                                        |
| `year`             | `INTEGER`                                                    | NOT NULL                                 | 대상 연도 (YYYY)                                      |
| `month`            | `INTEGER`                                                    | NOT NULL, CHECK (month BETWEEN 1 AND 12) | 대상 월 (1-12)                                        |
| `status`           | `VARCHAR(20)`                                                | NOT NULL, DEFAULT `'PREPARING'`          | 청구월 상태 (`PREPARING`, `IN_PROGRESS`, `COMPLETED`) |
| `description`      | `TEXT`                                                       |                                          | 해당 청구월에 대한 설명 또는 메모                     |
| `start_date`       | `DATE`                                                       | NOT NULL                                 | 청구 기간 시작일                                      |
| `end_date`         | `DATE`                                                       | NOT NULL                                 | 청구 기간 종료일                                      |
| `payment_due_date` | `DATE`                                                       | NOT NULL                                 | 이 청구월의 납부 마감일                               |
| `closed_date`      | `DATE`                                                       |                                          | 최종 마감 처리 일자                                   |
| ... (감사 필드)    |                                                              |                                          |                                                       |
| **UNIQUE 제약**    | `year`, `month` (사업장/건물별 고유해야 하므로 building_id 포함 필요) |                                          |                                                       |

#### 6.2. `unit_monthly_meter_reading` (개별 호실 월별 검침)

- **테이블 설명:** 특정 청구월의 각 개별 호실별 공과금 계량기 검침 데이터를 저장합니다.

| **컬럼명**               | **데이터 타입**                                    | **제약조건**                    | **설명**                                        |
| ------------------------ | -------------------------------------------------- | ------------------------------- | ----------------------------------------------- |
| `unit_reading_id`        | `UUID`                                             | PK, DEFAULT `gen_random_uuid()` | 개별 호실 월별 검침 고유 ID                     |
| `billing_month_id`       | `UUID`                                             | NOT NULL, FK to `billing_month` | 청구월 ID                                       |
| `unit_id`                | `UUID`                                             | NOT NULL, FK to `unit`          | 호실 ID                                         |
| `utility_type_code`      | `VARCHAR(30)`                                      | NOT NULL                        | 공과금 항목 코드 (예: `ELEC_I` - 세대전기)      |
| `reading_date`           | `DATE`                                             | NOT NULL                        | 검침일                                          |
| `previous_meter_reading` | `NUMERIC(15, 2)`                                   | NOT NULL                        | 전월(이전) 검침 지침 값                         |
| `current_meter_reading`  | `NUMERIC(15, 2)`                                   | NOT NULL                        | 당월 검침 지침 값                               |
| `usage_calculated`       | `NUMERIC(15, 2)`                                   | NOT NULL                        | 계산된 사용량 (`current` - `previous`)          |
| `remarks`                | `TEXT`                                             |                                 | 검침 관련 비고                                  |
| ... (감사 필드)          |                                                    |                                 |                                                 |
| **UNIQUE 제약**          | `billing_month_id`, `unit_id`, `utility_type_code` |                                 | 한 청구월에 동일 호실, 동일 항목 중복 검침 방지 |
| **CHECK 제약**           | `current_meter_reading >= previous_meter_reading`  |                                 | (계량기 교체 등 예외 제외)                      |

#### 6.3. `monthly_external_bill_amount` (월별 외부 고지서 청구 금액)

- **테이블 설명:** 특정 청구월에 대해 외부 공급자로부터 청구된 건물 단위 고지서의 총액 및 분배 정보를 저장합니다.

| **컬럼명**                      | **데이터 타입**                                   | **제약조건**                            | **설명**                                          |
| ------------------------------- | ------------------------------------------------- | --------------------------------------- | ------------------------------------------------- |
| `monthly_ext_bill_amount_id`    | `UUID`                                            | PK, DEFAULT `gen_random_uuid()`         | 월별 외부고지서금액 고유 ID                       |
| `billing_month_id`              | `UUID`                                            | NOT NULL, FK to `billing_month`         | 청구월 ID                                         |
| `ext_bill_account_id`           | `UUID`                                            | NOT NULL, FK to `external_bill_account` | 외부 고지서 계정 ID                               |
| `total_billed_amount`           | `NUMERIC(15, 2)`                                  | NOT NULL                                | 해당 고객번호로 청구된 해당 월 총액               |
| `common_usage_allocated_amount` | `NUMERIC(15, 2)`                                  |                                         | 위 총액 중 공용 사용료로 배분(지정)된 금액        |
| `individual_usage_pool_amount`  | `NUMERIC(15, 2)`                                  |                                         | 위 총액 중 개별 사용료 풀로 배분(지정)된 금액     |
| `bill_statement_file_key`       | `VARCHAR(255)`                                    |                                         | 고지서 스캔 파일 S3 Key                           |
| `remarks`                       | `TEXT`                                            |                                         | 비고                                              |
| ... (감사 필드)                 |                                                   |                                         |                                                   |
| **UNIQUE 제약**                 | `billing_month_id`, `ext_bill_account_id`         |                                         | 한 청구월에 동일 고객번호 금액 중복 입력 방지     |
| **CHECK 제약**                  | (total_billed_amount = common... + individual...) |                                         | (분배액 입력 시) 분배액 합계는 총액과 일치해야 함 |

### 7. 관리비 정산, 고지, 수납 (Fee Calculation, Invoicing, Payment)

#### 7.1. `unit_monthly_fee` (월별 세대 관리비 - 계산 결과 총괄)

- **테이블 설명:** 특정 청구월에 특정 세대에 부과될 관리비의 최종 계산 결과를 총괄하여 저장합니다. 이 정보는 고지서의 기초가 됩니다.

| **컬럼명**                       | **데이터 타입**               | **제약조건**                    | **설명**                                                     |
| -------------------------------- | ----------------------------- | ------------------------------- | ------------------------------------------------------------ |
| `unit_monthly_fee_id`            | `UUID`                        | PK, DEFAULT `gen_random_uuid()` | 월별 세대 관리비 고유 ID                                     |
| `billing_month_id`               | `UUID`                        | NOT NULL, FK to `billing_month` | 청구월 ID                                                    |
| `unit_id`                        | `UUID`                        | NOT NULL, FK to `unit`          | 호실 ID                                                      |
| `total_fee_before_adjustments`   | `NUMERIC(15, 2)`              | NOT NULL                        | 순수 당월 관리비 항목 합계 (부가세 포함)                     |
| `previous_unpaid_amount_applied` | `NUMERIC(15, 2)`              | DEFAULT 0                       | 이 고지에 적용된 전월 미납액                                 |
| `late_fee_applied`               | `NUMERIC(15, 2)`              | DEFAULT 0                       | 이 고지에 적용된 연체료                                      |
| `adjustments_total`              | `NUMERIC(15, 2)`              | DEFAULT 0                       | 기타 가감액 합계 (감면액은 음수)                             |
| `final_amount_due`               | `NUMERIC(15, 2)`              | NOT NULL                        | 최종 납부 요청 금액 (모든 항목 합산)                         |
| `paid_amount`                    | `NUMERIC(15, 2)`              | NOT NULL, DEFAULT 0             | 현재까지 납부된 금액 (`payment_record` 합계로 업데이트)      |
| `current_unpaid_balance`         | `NUMERIC(15, 2)`              | NOT NULL, DEFAULT 0             | 현재 미납 잔액 (`final_amount_due` - `paid_amount`)          |
| `payment_status`                 | `VARCHAR(20)`                 | NOT NULL, DEFAULT `'UNPAID'`    | 납부 상태 (`UNPAID`, `PARTIALLY_PAID`, `FULLY_PAID`, `OVERDUE`) |
| `calculation_status`             | `VARCHAR(20)`                 | NOT NULL, DEFAULT `'SUCCESS'`   | 산정 상태 (`SUCCESS`, `ERROR`, `RECALC_NEEDED`)              |
| `calculation_log`                | `TEXT`                        |                                 | 산정 관련 로그 또는 오류 메시지                              |
| `confirmed_by`                   | `VARCHAR(50)`                 |                                 | 관리비 산정 확정자 ID                                        |
| `confirmed_at`                   | `TIMESTAMP WITH TIME ZONE`    |                                 | 관리비 산정 확정 일시                                        |
| ... (감사 필드)                  |                               |                                 |                                                              |
| **UNIQUE 제약**                  | `billing_month_id`, `unit_id` |                                 | 한 청구월에 동일 호실의 관리비 총괄 내역은 하나만 존재       |

#### 7.2. `unit_fee_detail` (세대별 월별 관리비 상세 항목)

- **테이블 설명:** 특정 세대의 특정 청구월 관리비를 구성하는 각 항목별 상세 계산 내역을 저장합니다.

| **컬럼명**              | **데이터 타입**                      | **제약조건**                       | **설명**                                                 |
| ----------------------- | ------------------------------------ | ---------------------------------- | -------------------------------------------------------- |
| `unit_fee_detail_id`    | `UUID`                               | PK, DEFAULT `gen_random_uuid()`    | 세대 관리비 상세 항목 고유 ID                            |
| `unit_monthly_fee_id`   | `UUID`                               | NOT NULL, FK to `unit_monthly_fee` | 월별 세대 관리비 ID                                      |
| `fee_item_id`           | `UUID`                               | NOT NULL, FK to `fee_item`         | 관리비 항목 ID                                           |
| `item_name`             | `VARCHAR(100)`                       | NOT NULL                           | 항목명 (산정 시점의 `fee_item.item_name` 복사 또는 참조) |
| `calculation_basis`     | `VARCHAR(255)`                       |                                    | 산출근거 (예: 100kWh * 120원/kWh, 84.5㎡ * 1000원/㎡)    |
| `amount_before_vat`     | `NUMERIC(15, 2)`                     | NOT NULL                           | 항목별 금액 (부가세 제외)                                |
| `vat_amount`            | `NUMERIC(15, 2)`                     | NOT NULL, DEFAULT 0                | 항목별 부가세액                                          |
| `total_amount_with_vat` | `NUMERIC(15, 2)`                     | NOT NULL                           | 항목별 합계 (부가세 포함)                                |
| ... (감사 필드)         |                                      |                                    |                                                          |
| **UNIQUE 제약**         | `unit_monthly_fee_id`, `fee_item_id` |                                    | 동일 관리비 내역에 동일 항목 중복 방지                   |

#### 7.3. `invoice` (관리비 고지서)

- **테이블 설명:** 산정된 관리비를 바탕으로 입주민/임차인에게 발급되는 고지서 정보를 관리합니다.

| **컬럼명**            | **데이터 타입**               | **제약조건**                       | **설명**                                                     |
| --------------------- | ----------------------------- | ---------------------------------- | ------------------------------------------------------------ |
| `invoice_id`          | `UUID`                        | PK, DEFAULT `gen_random_uuid()`    | 고지서 고유 ID                                               |
| `unit_monthly_fee_id` | `UUID`                        | NOT NULL, FK to `unit_monthly_fee` | 이 고지서의 근거가 되는 월별 세대 관리비                     |
| `billing_month_id`    | `UUID`                        | NOT NULL, FK to `billing_month`    | 청구월 ID                                                    |
| `unit_id`             | `UUID`                        | NOT NULL, FK to `unit`             | 호실 ID                                                      |
| `tenant_id`           | `UUID`                        | NOT NULL, FK to `tenant`           | 임차인 ID                                                    |
| `issue_date`          | `DATE`                        | NOT NULL                           | 고지서 발급(생성)일                                          |
| `due_date`            | `DATE`                        | NOT NULL                           | 납부 기한일                                                  |
| `total_amount_billed` | `NUMERIC(15, 2)`              | NOT NULL                           | 해당 고지서의 총 청구 금액                                   |
| `status`              | `VARCHAR(20)`                 | NOT NULL, DEFAULT `'GENERATED'`    | 고지서 상태 (`DRAFT`, `GENERATED`, `ISSUED`, `SENT`, `VIEWED`) |
| `invoice_content_ref` | `VARCHAR(255)`                |                                    | 생성된 고지서 파일 참조 (S3 Key 등)                          |
| `notified_at`         | `TIMESTAMP WITH TIME ZONE`    |                                    | 실제 입주민에게 통지된 일시                                  |
| ... (감사 필드)       |                               |                                    |                                                              |
| **UNIQUE 제약**       | `billing_month_id`, `unit_id` |                                    | 한 청구월에 동일 호실 고지서는 하나만 존재 (정정고지 제외)   |

#### 7.4. `payment_record` (수납 이력)

- **테이블 설명:** 관리비, 임대료 등 납부된 금액의 상세 이력을 기록합니다. 분할 납부 시 여러 레코드가 생성될 수 있습니다.

| **컬럼명**                  | **데이터 타입**  | **제약조건**                       | **설명**                                                |
| --------------------------- | ---------------- | ---------------------------------- | ------------------------------------------------------- |
| `payment_record_id`         | `UUID`           | PK, DEFAULT `gen_random_uuid()`    | 수납 이력 고유 ID                                       |
| `unit_monthly_fee_id`       | `UUID`           | NOT NULL, FK to `unit_monthly_fee` | 어느 월별 관리비에 대한 수납인지 연결                   |
| `invoice_id`                | `UUID`           | FK to `invoice`                    | (선택) 관련 고지서 ID                                   |
| `payment_date`              | `DATE`           | NOT NULL                           | 실제 납부일                                             |
| `paid_amount`               | `NUMERIC(15, 2)` | NOT NULL, CHECK > 0                | 납부된 금액                                             |
| `payment_method`            | `VARCHAR(30)`    | NOT NULL                           | 납부 수단 (예: `BANK_TRANSFER`, `CASH`, `CARD`)         |
| `payer_name`                | `VARCHAR(50)`    |                                    | 실제 납부자명 (임차인과 다를 경우)                      |
| `transaction_details`       | `VARCHAR(255)`   |                                    | 거래 관련 추가 정보 (예: 은행, 계좌번호 일부, 거래번호) |
| `receiving_bank_account_id` | `UUID`           | FK to `receiving_bank_account`     | 입금된 QIRO측 수납 계좌 ID                              |
| `remarks`                   | `TEXT`           |                                    | 수납 관련 메모                                          |
| `is_cancelled`              | `BOOLEAN`        | NOT NULL, DEFAULT `false`          | 취소된 수납 여부                                        |
| ... (감사 필드)             |                  |                                    |                                                         |

#### 7.5. `delinquency_record` (미납/연체 기록)

- **테이블 설명:** 납부 마감일이 지난 미납 건에 대한 정보를 관리합니다.

| **컬럼명**                | **데이터 타입**  | **제약조건**                         | **설명**                                                     |
| ------------------------- | ---------------- | ------------------------------------ | ------------------------------------------------------------ |
| `delinquency_id`          | `UUID`           | PK, DEFAULT `gen_random_uuid()`      | 미납 기록 고유 ID                                            |
| `target_ledger_id`        | `UUID`           | NOT NULL, FK (to `unit_monthly_fee`) | 미납이 발생한 원본 청구/고지 ID                              |
| `unit_id`                 | `UUID`           | NOT NULL, FK to `unit`               | 해당 호실 ID                                                 |
| `tenant_id`               | `UUID`           | NOT NULL, FK to `tenant`             | 해당 임차인 ID                                               |
| `billing_year_month`      | `VARCHAR(7)`     | NOT NULL, (YYYY-MM 형식)             | 미납 발생 청구 연월                                          |
| `original_unpaid_amount`  | `NUMERIC(15, 2)` | NOT NULL                             | 최초 미납 원금                                               |
| `current_unpaid_amount`   | `NUMERIC(15, 2)` | NOT NULL                             | 현재 미납 잔액 (부분 수납 반영)                              |
| `due_date`                | `DATE`           | NOT NULL                             | 납부 마감일                                                  |
| `overdue_days`            | `INTEGER`        | NOT NULL, DEFAULT 0                  | 연체 일수 (매일 배치 또는 조회 시 계산하여 업데이트)         |
| `total_late_fee_applied`  | `NUMERIC(15, 2)` | NOT NULL, DEFAULT 0                  | 총 부과된 연체료                                             |
| `status`                  | `VARCHAR(30)`    | NOT NULL, DEFAULT `'OVERDUE'`        | 미납 상태 (`OVERDUE`, `LATE_FEE_APPLIED`, `REMINDER_SENT`, `RESOLVED`) |
| `last_reminder_sent_date` | `DATE`           |                                      | 최종 독촉 알림 발송일                                        |
| ... (감사 필드)           |                  |                                      |                                                              |

#### 7.6. `late_fee_transaction` (연체료 부과 이력)

- **테이블 설명:** 미납 건에 대해 연체료가 계산되고 부과될 때마다의 이력을 기록합니다.

| **컬럼명**            | **데이터 타입**  | **제약조건**                         | **설명**                            |
| --------------------- | ---------------- | ------------------------------------ | ----------------------------------- |
| `late_fee_tx_id`      | `UUID`           | PK, DEFAULT `gen_random_uuid()`      | 연체료 거래 고유 ID                 |
| `delinquency_id`      | `UUID`           | NOT NULL, FK to `delinquency_record` | 관련 미납 기록 ID                   |
| `calculation_date`    | `DATE`           | NOT NULL                             | 연체료 계산/부과일                  |
| `late_fee_amount`     | `NUMERIC(15, 2)` | NOT NULL                             | 해당 시점에 계산/부과된 연체료 금액 |
| `applied_rate`        | `NUMERIC(5, 2)`  | NOT NULL                             | 적용된 연체료율 (%)                 |
| `applied_period_days` | `INTEGER`        | NOT NULL                             | 연체료 계산 대상 기간(일수)         |
| `remarks`             | `TEXT`           |                                      | 비고                                |
| ... (감사 필드)       |                  |                                      |                                     |

#### 7.7. `move_out_settlement` (이사 정산)

- **테이블 설명:** 임차인 퇴실 시 발생하는 모든 정산 내역을 종합하여 관리합니다.

| **컬럼명**                    | **데이터 타입**  | **제약조건**                     | **설명**                                                     |
| ----------------------------- | ---------------- | -------------------------------- | ------------------------------------------------------------ |
| `settlement_id`               | `UUID`           | PK, DEFAULT `gen_random_uuid()`  | 이사 정산 고유 ID                                            |
| `contract_id`                 | `UUID`           | NOT NULL, FK to `lease_contract` | 관련 임대 계약 ID                                            |
| `move_out_date`               | `DATE`           | NOT NULL                         | 실제 이사일 (정산 기준일)                                    |
| `deposit_amount_held`         | `NUMERIC(15, 2)` | NOT NULL                         | 계약 시 납입된 보증금                                        |
| `calculation_details_json`    | `JSONB`          | NOT NULL                         | 정산 항목 상세 내역 (임대료, 관리비, 공과금, 기타 비용/환급 등) |
| `total_deductions_calculated` | `NUMERIC(15, 2)` | NOT NULL                         | 총 공제액 (시스템 자동 계산)                                 |
| `net_settlement_amount`       | `NUMERIC(15, 2)` | NOT NULL                         | 최종 정산액 (양수: 반환, 음수: 추가 징수)                    |
| `status`                      | `VARCHAR(20)`    | NOT NULL, DEFAULT `'CALCULATED'` | 정산 상태 (`PENDING_CALC`, `CALCULATED`, `SETTLED`)          |
| `settlement_processed_date`   | `DATE`           |                                  | 실제 정산금 지급/수령 완료일                                 |
| `remarks`                     | `TEXT`           |                                  | 정산 관련 비고                                               |
| ... (감사 필드)               |                  |                                  |                                                              |

### 8. 시설 관리 (Facility Management)

#### 8.1. `facility` (시설물)

- **테이블 설명:** 건물 내 관리 대상이 되는 주요 설비, 장비, 구조물 등의 시설물 마스터 정보를 저장합니다. (공용 계량기 등 포함 가능)

| **컬럼명**              | **데이터 타입** | **제약조건**                    | **설명**                                                     |
| ----------------------- | --------------- | ------------------------------- | ------------------------------------------------------------ |
| `facility_id`           | `UUID`          | PK, DEFAULT `gen_random_uuid()` | 시설물 고유 ID                                               |
| `building_id`           | `UUID`          | NOT NULL, FK to `building`      | 소속 건물 ID                                                 |
| `name`                  | `VARCHAR(100)`  | NOT NULL                        | 시설물명 (예: 엘리베이터 1호기, 중앙 냉난방 시스템)          |
| `facility_type_code`    | `VARCHAR(30)`   | NOT NULL                        | 시설물 유형 코드 (마스터 데이터, 예: `ELEVATOR`, `HVAC`, `METER_ELEC_COMMON`) |
| `location`              | `VARCHAR(255)`  | NOT NULL                        | 설치 위치 (예: 1층 주출입구 옆, 옥상 기계실)                 |
| `installation_date`     | `DATE`          |                                 | 설치일                                                       |
| `manufacturer`          | `VARCHAR(100)`  |                                 | 제조사                                                       |
| `model_name`            | `VARCHAR(100)`  |                                 | 모델명                                                       |
| `inspection_cycle_days` | `INTEGER`       |                                 | 권장 점검 주기 (일 단위)                                     |
| `last_inspection_date`  | `DATE`          |                                 | 가장 최근 점검일 (점검 기록에서 업데이트)                    |
| `next_inspection_date`  | `DATE`          |                                 | 다음 점검 예정일 (자동계산 또는 수동입력)                    |
| `status`                | `VARCHAR(20)`   | NOT NULL, DEFAULT `'NORMAL'`    | 현재 시설물 상태 (`NORMAL`, `INSPECTION_NEEDED`, `UNDER_REPAIR`, `OUT_OF_SERVICE`) |
| `remarks`               | `TEXT`          |                                 | 시설물 관련 비고                                             |
| ... (감사 필드)         |                 |                                 |                                                              |

#### 8.2. `facility_inspection_record` (시설물 점검 기록)

- **테이블 설명:** 각 시설물에 대해 수행된 정기/비정기 점검의 이력을 상세히 기록합니다.

| **컬럼명**                         | **데이터 타입**  | **제약조건**                    | **설명**                                                     |
| ---------------------------------- | ---------------- | ------------------------------- | ------------------------------------------------------------ |
| `inspection_record_id`             | `UUID`           | PK, DEFAULT `gen_random_uuid()` | 점검 기록 고유 ID                                            |
| `facility_id`                      | `UUID`           | NOT NULL, FK to `facility`      | 점검 대상 시설물 ID                                          |
| `inspection_date`                  | `DATE`           | NOT NULL                        | 실제 점검 수행일                                             |
| `inspector_name`                   | `VARCHAR(50)`    | NOT NULL                        | 점검자명 (내부직원 또는 외부업체 담당자)                     |
| `vendor_id`                        | `UUID`           | FK to `vendor`                  | (외부 위탁 시) 점검 수행 협력업체 ID                         |
| `vendor_name`                      | `VARCHAR(100)`   |                                 | 점검 수행 업체명 (참조용 중복 저장)                          |
| `inspection_result_code`           | `VARCHAR(30)`    | NOT NULL                        | 점검 결과 코드 (`PASS`, `FAIL_MINOR`, `REPAIR_NEEDED`, `URGENT_ACTION`) |
| `details`                          | `TEXT`           |                                 | 점검 상세 내용 및 조치 사항                                  |
| `cost`                             | `NUMERIC(15, 2)` | DEFAULT 0                       | 점검/수리에 소요된 비용 (선택 사항)                          |
| `next_recommended_inspection_date` | `DATE`           |                                 | 점검 결과에 따른 차기 권고 점검일                            |
| ... (감사 필드)                    |                  |                                 |                                                              |

#### 8.3. `vendor` (시설 관리 협력업체)

- **테이블 설명:** 시설 유지보수, 점검, 수리 등을 담당하는 외부 협력업체의 정보를 관리합니다.

| **컬럼명**            | **데이터 타입** | **제약조건**                    | **설명**                                                     |
| --------------------- | --------------- | ------------------------------- | ------------------------------------------------------------ |
| `vendor_id`           | `UUID`          | PK, DEFAULT `gen_random_uuid()` | 협력업체 고유 ID                                             |
| `company_name`        | `VARCHAR(100)`  | NOT NULL, UNIQUE                | 업체명                                                       |
| `business_reg_number` | `VARCHAR(20)`   | UNIQUE                          | 사업자등록번호                                               |
| `ceo_name`            | `VARCHAR(50)`   |                                 | 대표자명                                                     |
| `primary_phone`       | `VARCHAR(20)`   |                                 | 대표 전화번호                                                |
| `primary_email`       | `VARCHAR(255)`  |                                 | 대표 이메일                                                  |
| `address`             | `TEXT`          |                                 | 주소                                                         |
| `service_types_json`  | `JSONB`         |                                 | 제공 서비스 유형/전문 분야 목록 (예: `["ELEVATOR", "FIRE_FIGHTING"]`) |
| `status`              | `VARCHAR(20)`   | NOT NULL, DEFAULT `'ACTIVE'`    | 업체 상태 (`ACTIVE`, `INACTIVE`, `CONTRACT_EXPIRED`)         |
| `rating_average`      | `NUMERIC(3, 2)` |                                 | 평균 평점 (작업 이력 기반)                                   |
| `remarks`             | `TEXT`          |                                 | 비고                                                         |
| ... (감사 필드)       |                 |                                 |                                                              |

#### 8.4. `vendor_contact_person` (협력업체 담당자)

- **테이블 설명:** 각 협력업체의 담당자 정보를 저장합니다. (한 업체에 여러 담당자 등록 가능)

| **컬럼명**          | **데이터 타입** | **제약조건**                    | **설명**         |
| ------------------- | --------------- | ------------------------------- | ---------------- |
| `contact_person_id` | `UUID`          | PK, DEFAULT `gen_random_uuid()` | 담당자 고유 ID   |
| `vendor_id`         | `UUID`          | NOT NULL, FK to `vendor`        | 소속 협력업체 ID |
| `name`              | `VARCHAR(50)`   | NOT NULL                        | 담당자명         |
| `position`          | `VARCHAR(50)`   |                                 | 직책             |
| `phone`             | `VARCHAR(20)`   | NOT NULL                        | 직통 연락처      |
| `email`             | `VARCHAR(255)`  |                                 | 이메일 주소      |
| ... (감사 필드)     |                 |                                 |                  |

### 9. 민원 관리 (Complaint Management)

#### 9.1. `complaint` (민원)

- **테이블 설명:** 입주민/임차인으로부터 접수된 모든 민원의 상세 내용을 관리합니다.

| **컬럼명**               | **데이터 타입**            | **제약조건**                    | **설명**                                                     |
| ------------------------ | -------------------------- | ------------------------------- | ------------------------------------------------------------ |
| `complaint_id`           | `UUID`                     | PK, DEFAULT `gen_random_uuid()` | 민원 고유 ID                                                 |
| `complaint_number`       | `VARCHAR(30)`              | NOT NULL, UNIQUE                | 관리용 접수번호 (시스템 자동 채번, 예: `REQ20250607001`)     |
| `building_id`            | `UUID`                     | NOT NULL, FK to `building`      | 관련 건물 ID                                                 |
| `unit_id`                | `UUID`                     | FK to `unit`                    | 민원 발생 호실 ID (건물 공용 민원일 경우 null)               |
| `reporter_name`          | `VARCHAR(50)`              | NOT NULL                        | 민원 제기자 성명                                             |
| `reporter_contact`       | `VARCHAR(20)`              | NOT NULL                        | 민원 제기자 연락처                                           |
| `received_datetime`      | `TIMESTAMP WITH TIME ZONE` | NOT NULL, DEFAULT `now()`       | 민원 접수 일시                                               |
| `complaint_type_code`    | `VARCHAR(30)`              | NOT NULL                        | 민원 유형 코드 (마스터 데이터, 예: `FACILITY_REPAIR`, `NOISE`) |
| `title`                  | `VARCHAR(255)`             | NOT NULL                        | 민원 제목 (요약)                                             |
| `description`            | `TEXT`                     | NOT NULL                        | 민원 상세 내용                                               |
| `status`                 | `VARCHAR(20)`              | NOT NULL, DEFAULT `'RECEIVED'`  | 처리 상태 (`RECEIVED`, `ASSIGNED`, `IN_PROGRESS`, `ON_HOLD`, `RESOLVED`, `CLOSED`) |
| `assigned_user_id`       | `UUID`                     | FK to `internal_user`           | 배정된 내부 담당자 ID                                        |
| `assigned_vendor_id`     | `UUID`                     | FK to `vendor`                  | 배정된 외부 협력업체 ID                                      |
| `target_completion_date` | `DATE`                     |                                 | 처리 목표일                                                  |
| `resolution_details`     | `TEXT`                     |                                 | 최종 처리 내용                                               |
| `completed_datetime`     | `TIMESTAMP WITH TIME ZONE` |                                 | 실제 처리 완료 일시                                          |
| ... (감사 필드)          |                            |                                 |                                                              |

#### 9.2. `complaint_history` (민원 처리 이력)

- **테이블 설명:** 하나의 민원이 처리되는 과정에서 발생하는 모든 변경 이력을 기록합니다.

| **컬럼명**        | **데이터 타입**            | **제약조건**                    | **설명**                                                     |
| ----------------- | -------------------------- | ------------------------------- | ------------------------------------------------------------ |
| `history_id`      | `UUID`                     | PK, DEFAULT `gen_random_uuid()` | 처리 이력 고유 ID                                            |
| `complaint_id`    | `UUID`                     | NOT NULL, FK to `complaint`     | 관련 민원 ID                                                 |
| `action_datetime` | `TIMESTAMP WITH TIME ZONE` | NOT NULL, DEFAULT `now()`       | 작업 수행 일시                                               |
| `actor_user_id`   | `UUID`                     | NOT NULL, FK to `internal_user` | 작업 수행자 ID                                               |
| `action_type`     | `VARCHAR(30)`              | NOT NULL                        | 작업 유형 (예: `STATUS_CHANGED`, `ASSIGNED`, `COMMENT_ADDED`) |
| `previous_status` | `VARCHAR(20)`              |                                 | (상태 변경 시) 이전 상태                                     |
| `new_status`      | `VARCHAR(20)`              |                                 | (상태 변경 시) 새로운 상태                                   |
| `remarks`         | `TEXT`                     |                                 | 작업 관련 상세 내용 또는 메모                                |
| ... (감사 필드)   |                            |                                 |                                                              |

#### 9.3. `attachment` (범용 첨부파일)

- **테이블 설명:** 시스템 내 다양한 곳(민원, 시설점검, 계약 등)에서 사용되는 첨부파일의 메타정보를 관리하는 범용 테이블입니다.

| **컬럼명**            | **데이터 타입**            | **제약조건**                    | **설명**                                                     |
| --------------------- | -------------------------- | ------------------------------- | ------------------------------------------------------------ |
| `attachment_id`       | `UUID`                     | PK, DEFAULT `gen_random_uuid()` | 첨부파일 고유 ID                                             |
| `related_entity_type` | `VARCHAR(50)`              | NOT NULL                        | 연결된 엔티티 유형 (예: `COMPLAINT`, `LEASE_CONTRACT`, `FACILITY_INSPECTION`) |
| `related_entity_id`   | `UUID`                     | NOT NULL                        | 연결된 엔티티의 PK 값                                        |
| `file_name`           | `VARCHAR(255)`             | NOT NULL                        | 원본 파일명                                                  |
| `file_key_or_path`    | `VARCHAR(512)`             | NOT NULL                        | S3 Key 또는 저장 경로                                        |
| `file_size`           | `BIGINT`                   | NOT NULL                        | 파일 크기 (bytes)                                            |
| `file_type`           | `VARCHAR(100)`             |                                 | 파일 MIME 타입                                               |
| `description`         | `VARCHAR(255)`             |                                 | 파일 설명                                                    |
| `uploaded_at`         | `TIMESTAMP WITH TIME ZONE` | NOT NULL, DEFAULT `now()`       | 업로드 일시                                                  |
| `uploaded_by`         | `VARCHAR(50)`              | NOT NULL                        | 업로더 ID                                                    |

### 10. 회계 관리 (Accounting Management - 개괄적 수준)

#### 10.1. `chart_of_account` (계정과목)

- **테이블 설명:** 회계 처리를 위한 계정과목 마스터 정보를 관리합니다. 자산, 부채, 자본, 수익, 비용의 계층 구조를 가질 수 있습니다.

| **컬럼명**          | **데이터 타입** | **제약조건**                    | **설명**                                                     |
| ------------------- | --------------- | ------------------------------- | ------------------------------------------------------------ |
| `account_id`        | `UUID`          | PK, DEFAULT `gen_random_uuid()` | 계정과목 고유 ID                                             |
| `account_code`      | `VARCHAR(20)`   | NOT NULL, UNIQUE                | 계정 코드 (사용자 정의 또는 표준 코드)                       |
| `account_name`      | `VARCHAR(100)`  | NOT NULL                        | 계정명 (예: 보통예금, 미수관리비, 관리비수익)                |
| `account_type`      | `VARCHAR(20)`   | NOT NULL, CHECK in (...)        | 계정 유형 (`ASSET`, `LIABILITY`, `EQUITY`, `REVENUE`, `EXPENSE`) |
| `parent_account_id` | `UUID`          | FK to `chart_of_account`        | 상위 계정과목 ID (계층 구조 표현을 위함)                     |
| `description`       | `TEXT`          |                                 | 계정과목 상세 설명                                           |
| `is_active`         | `BOOLEAN`       | NOT NULL, DEFAULT `true`        | 사용 여부                                                    |
| `is_system_default` | `BOOLEAN`       | NOT NULL, DEFAULT `false`       | 시스템 기본 제공 계정과목 여부 (삭제/주요 변경 제한)         |
| ... (감사 필드)     |                 |                                 |                                                              |

#### 10.2. `journal_entry` (전표)

- **테이블 설명:** 모든 회계상 거래의 기본 단위인 전표의 헤더 정보를 저장합니다.

| **컬럼명**      | **데이터 타입**              | **제약조건**                    | **설명**                                                     |
| --------------- | ---------------------------- | ------------------------------- | ------------------------------------------------------------ |
| `entry_id`      | `UUID`                       | PK, DEFAULT `gen_random_uuid()` | 전표 고유 ID                                                 |
| `entry_date`    | `DATE`                       | NOT NULL                        | 전표일자 (거래 발생일)                                       |
| `entry_number`  | `VARCHAR(30)`                | NOT NULL, UNIQUE                | 전표 번호 (시스템 자동 채번)                                 |
| `description`   | `VARCHAR(255)`               | NOT NULL                        | 적요 (전표 전체에 대한 설명)                                 |
| `status`        | `VARCHAR(20)`                | NOT NULL, DEFAULT `'DRAFT'`     | 전표 상태 (`DRAFT` - 임시저장, `CONFIRMED` - 확정, `CANCELLED` - 취소) |
| `entry_type`    | `VARCHAR(20)`                | NOT NULL                        | 전표 유형 (`MANUAL` - 수동, `AUTO_FEE` - 관리비자동 등)      |
| `total_debit`   | `NUMERIC(18, 2)`             | NOT NULL                        | 차변 합계 금액 (검증용)                                      |
| `total_credit`  | `NUMERIC(18, 2)`             | NOT NULL                        | 대변 합계 금액 (검증용)                                      |
| ... (감사 필드) |                              |                                 |                                                              |
| **CHECK 제약**  | `total_debit = total_credit` |                                 | 복식부기 원칙 (차/대변 일치)                                 |

#### 10.3. `journal_entry_line` (전표 라인 / 분개)

- **테이블 설명:** 각 전표를 구성하는 상세 분개 내역(차변/대변)을 저장합니다.

| **컬럼명**         | **데이터 타입**  | **제약조건**                           | **설명**                                        |
| ------------------ | ---------------- | -------------------------------------- | ----------------------------------------------- |
| `line_id`          | `UUID`           | PK, DEFAULT `gen_random_uuid()`        | 분개 라인 고유 ID                               |
| `entry_id`         | `UUID`           | NOT NULL, FK to `journal_entry`        | 소속 전표 ID                                    |
| `account_id`       | `UUID`           | NOT NULL, FK to `chart_of_account`     | 관련 계정과목 ID                                |
| `entry_side`       | `VARCHAR(10)`    | NOT NULL, CHECK in ('DEBIT', 'CREDIT') | 차/대변 구분                                    |
| `amount`           | `NUMERIC(18, 2)` | NOT NULL, CHECK > 0                    | 금액                                            |
| `line_description` | `VARCHAR(255)`   |                                        | 라인별 적요 (전표 적요와 별개로 상세 내용)      |
| `related_party_id` | `UUID`           |                                        | 거래처 ID (Vendor, Tenant, Lessor 등 참조 가능) |
| ... (감사 필드)    |                  |                                        |                                                 |

### 11. 알림 및 공지 (Notification & Announcement Management)

#### 11.1. `announcement` (공지사항)

- **테이블 설명:** 관리자가 특정 대상에게 전달하는 공지사항의 내용을 관리합니다.

| **컬럼명**           | **데이터 타입**            | **제약조건**                    | **설명**                                                     |
| -------------------- | -------------------------- | ------------------------------- | ------------------------------------------------------------ |
| `announcement_id`    | `UUID`                     | PK, DEFAULT `gen_random_uuid()` | 공지사항 고유 ID                                             |
| `title`              | `VARCHAR(255)`             | NOT NULL                        | 제목                                                         |
| `content`            | `TEXT`                     | NOT NULL                        | 내용 (HTML 또는 Markdown 형식 저장 가능)                     |
| `target_type`        | `VARCHAR(30)`              | NOT NULL                        | 대상 유형 (`ALL`, `BUILDING`, `USER_GROUP`, `INDIVIDUAL_USER`) |
| `target_identifiers` | `JSONB`                    | NOT NULL                        | 대상 식별자 목록 (예: `["building-uuid-1", "building-uuid-2"]`) |
| `start_datetime`     | `TIMESTAMP WITH TIME ZONE` | NOT NULL                        | 게시 시작 일시                                               |
| `end_datetime`       | `TIMESTAMP WITH TIME ZONE` |                                 | 게시 종료 일시 (null이면 계속 게시)                          |
| `importance`         | `VARCHAR(20)`              | NOT NULL, DEFAULT `'NORMAL'`    | 중요도 (`NORMAL`, `IMPORTANT`, `URGENT`)                     |
| `status`             | `VARCHAR(20)`              | NOT NULL, DEFAULT `'DRAFT'`     | 상태 (`DRAFT`, `SCHEDULED`, `PUBLISHED`, `EXPIRED`)          |
| `attachments_json`   | `JSONB`                    |                                 | 첨부 파일 정보 목록 (Attachment 참조 정보)                   |
| ... (감사 필드)      |                            |                                 |                                                              |

#### 11.2. `system_notification_setting` (시스템 알림 설정)

- **테이블 설명:** 시스템에서 자동으로 발생하는 알림(예: 계약 만료, 미납 등)의 유형별 설정을 관리합니다.

| **컬럼명**          | **데이터 타입** | **제약조건**             | **설명**                                                     |
| ------------------- | --------------- | ------------------------ | ------------------------------------------------------------ |
| `notification_type` | `VARCHAR(50)`   | PK                       | 알림 유형 코드 (시스템 정의, 예: `CONTRACT_EXPIRY_30D`)      |
| `is_enabled`        | `BOOLEAN`       | NOT NULL, DEFAULT `true` | 해당 유형 알림 활성화 여부                                   |
| `default_channels`  | `JSONB`         |                          | 기본 발송 채널 목록 (예: `["EMAIL", "SMS"]`)                 |
| `recipient_roles`   | `JSONB`         |                          | 기본 수신 대상 역할 목록 (예: `["BUILDING_MANAGER", "TENANT"]`) |
| `trigger_condition` | `VARCHAR(255)`  |                          | 발송 조건/규칙 설명 (예: "계약 만료 30일 전 오전 10시")      |
| ... (감사 필드)     |                 |                          |                                                              |

#### 11.3. `notification_template` (알림 템플릿)

- **테이블 설명:** 시스템 알림 발송 시 사용될 채널별(이메일, SMS 등) 메시지 템플릿을 관리합니다.

| **컬럼명**          | **데이터 타입**                     | **제약조건**                                  | **설명**                                      |
| ------------------- | ----------------------------------- | --------------------------------------------- | --------------------------------------------- |
| `template_id`       | `UUID`                              | PK, DEFAULT `gen_random_uuid()`               | 템플릿 고유 ID                                |
| `notification_type` | `VARCHAR(50)`                       | NOT NULL, FK to `system_notification_setting` | 관련 알림 유형 코드                           |
| `channel_type`      | `VARCHAR(20)`                       | NOT NULL, CHECK in (...)                      | 발송 채널 (`EMAIL`, `SMS`, `LMS`, `APP_PUSH`) |
| `subject_template`  | `VARCHAR(255)`                      |                                               | 제목 템플릿 (변수 사용: `{userName}`)         |
| `body_template`     | `TEXT`                              | NOT NULL                                      | 본문 템플릿 (HTML 또는 Plain Text, 변수 사용) |
| ... (감사 필드)     |                                     |                                               |                                               |
| **UNIQUE 제약**     | `notification_type`, `channel_type` |                                               | 동일 알림/채널 유형에 템플릿 중복 방지        |

#### 11.4. `notification_log` (알림 발송 이력)

- **테이블 설명:** 발송된 모든 공지사항 및 시스템 알림의 이력을 기록합니다.

| **컬럼명**          | **데이터 타입**            | **제약조건**                    | **설명**                                                     |
| ------------------- | -------------------------- | ------------------------------- | ------------------------------------------------------------ |
| `log_id`            | `UUID`                     | PK, DEFAULT `gen_random_uuid()` | 발송 이력 고유 ID                                            |
| `notification_type` | `VARCHAR(50)`              | NOT NULL                        | 발송된 알림/공지 유형 (예: `ANNOUNCEMENT`, `CONTRACT_EXPIRY_30D`) |
| `reference_id`      | `UUID`                     |                                 | 관련 엔티티 ID (예: 공지사항 ID, 계약 ID)                    |
| `recipient_info`    | `VARCHAR(255)`             | NOT NULL                        | 수신자 정보 (예: "홍길동 (010-1234-5678)")                   |
| `channel_type`      | `VARCHAR(20)`              | NOT NULL                        | 실제 발송된 채널                                             |
| `subject`           | `VARCHAR(255)`             |                                 | 발송된 제목 (템플릿 적용 후)                                 |
| `content`           | `TEXT`                     | NOT NULL                        | 발송된 내용 (템플릿 적용 후)                                 |
| `sent_datetime`     | `TIMESTAMP WITH TIME ZONE` | NOT NULL, DEFAULT `now()`       | 발송 시도 일시                                               |
| `status`            | `VARCHAR(20)`              | NOT NULL, DEFAULT `'PENDING'`   | 발송 상태 (`SUCCESS`, `FAILED`, `PENDING`)                   |
| `error_message`     | `TEXT`                     |                                 | (실패 시) 외부 발송 서비스로부터 받은 오류 메시지 등         |
| ... (감사 필드)     |                            |                                 |                                                              |

### 12. 시스템 설정 (System Configuration)

#### 12.1. `system_configuration` (시스템 환경설정)

- **테이블 설명:** QIRO 서비스 전반의 운영 환경 및 기본 정책 값을 Key-Value 형태로 저장합니다.

| **컬럼명**      | **데이터 타입** | **제약조건**              | **설명**                                                     |
| --------------- | --------------- | ------------------------- | ------------------------------------------------------------ |
| `config_key`    | `VARCHAR(100)`  | PK                        | 설정 키 (예: `company.name`, `policy.payment.lateFeeRate`)   |
| `config_value`  | `TEXT`          | NOT NULL                  | 설정 값                                                      |
| `description`   | `VARCHAR(255)`  |                           | 설정 항목 설명                                               |
| `value_type`    | `VARCHAR(20)`   | NOT NULL                  | 값의 데이터 타입 (예: `STRING`, `INTEGER`, `FLOAT`, `BOOLEAN`) |
| `is_encrypted`  | `BOOLEAN`       | NOT NULL, DEFAULT `false` | 값이 암호화되어 저장되었는지 여부 (예: API 키)               |
| ... (감사 필드) |                 |                           |                                                              |

