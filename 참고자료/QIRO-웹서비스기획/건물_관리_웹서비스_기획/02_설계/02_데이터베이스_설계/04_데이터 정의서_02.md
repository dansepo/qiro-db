네, 알겠습니다! 이전 답변에 이어서 **관리비, 시설, 회계** 등 나머지 주요 모듈에 대한 **데이터 정의서**와 **DDL(데이터 정의 언어) 스크립트**를 완성해 드리겠습니다.

------

## 📚 QIRO 데이터 정의서 (Data Dictionary) - (계속)

*(참고: `... (감사 필드)`는 아래 4개의 컬럼이 공통적으로 포함됨을 의미합니다.)*

- `created_at` (TIMESTAMP WITH TIME ZONE, NOT NULL, DEFAULT now()): 생성일시
- `created_by` (VARCHAR(50)): 생성자 ID
- `last_modified_at` (TIMESTAMP WITH TIME ZONE, NOT NULL, DEFAULT now()): 최종수정일시
- `last_modified_by` (VARCHAR(50)): 최종수정자 ID

### 5. 관리비 설정 (Fee Item & Policy Setup)

#### 5.1. `fee_item` (관리비 부과 항목 마스터)

| **컬럼명**             | **데이터 타입**  | **제약조건**                    | **설명**                                                     |
| ---------------------- | ---------------- | ------------------------------- | ------------------------------------------------------------ |
| `fee_item_id`          | `UUID`           | PK, DEFAULT `gen_random_uuid()` | 관리비 항목 고유 ID                                          |
| `item_name`            | `VARCHAR(100)`   | NOT NULL, UNIQUE                | 항목명 (예: 일반관리비, 청소비)                              |
| `item_category`        | `VARCHAR(30)`    | NOT NULL                        | 항목 대분류 (예: `COMMON_FEE`, `INDIVIDUAL_FEE`)             |
| `imposition_method`    | `VARCHAR(30)`    | NOT NULL                        | 부과(배분) 방식 코드 (예: `FIXED_AMOUNT_PER_UNIT`, `PER_AREA_RATE`, `TOTAL_COMMON_PER_AREA`) |
| `default_unit_price`   | `NUMERIC(15, 2)` | DEFAULT 0                       | 기본 단가/금액 (단가 기반 항목일 경우)                       |
| `default_unit`         | `VARCHAR(20)`    |                                 | 기본 단위 (예: 원/세대, 원/㎡)                               |
| `is_vat_applicable`    | `BOOLEAN`        | NOT NULL, DEFAULT `false`       | 부가세 적용 여부                                             |
| `is_active`            | `BOOLEAN`        | NOT NULL, DEFAULT `true`        | 사용 여부                                                    |
| `is_system_default`    | `BOOLEAN`        | NOT NULL, DEFAULT `false`       | 시스템 기본 제공 항목 여부 (삭제/주요 변경 제한)             |
| `description`          | `TEXT`           |                                 | 항목 설명                                                    |
| `effective_start_date` | `DATE`           | NOT NULL                        | 적용 시작일                                                  |
| `effective_end_date`   | `DATE`           |                                 | 적용 종료일                                                  |
| ... (감사 필드)        |                  |                                 |                                                              |

#### 5.2. `external_bill_account` (외부 고지서 계정 정보)

| **컬럼명**                | **데이터 타입** | **제약조건**                    | **설명**                                        |
| ------------------------- | --------------- | ------------------------------- | ----------------------------------------------- |
| `ext_bill_account_id`     | `UUID`          | PK, DEFAULT `gen_random_uuid()` | 외부 고지서 계정 고유 ID                        |
| `building_id`             | `UUID`          | NOT NULL, FK to `building`      | 연결된 건물 ID                                  |
| `customer_number`         | `VARCHAR(50)`   | NOT NULL                        | 공급자가 부여한 고객번호/납부자번호             |
| `utility_type`            | `VARCHAR(30)`   | NOT NULL                        | 공과금 종류 (예: `ELECTRICITY`, `WATER`, `GAS`) |
| `supplier_name`           | `VARCHAR(100)`  | NOT NULL                        | 공급자 명칭                                     |
| `account_nickname`        | `VARCHAR(100)`  | NOT NULL                        | 계정 별칭 (사용자 식별용)                       |
| `meter_number`            | `VARCHAR(50)`   |                                 | 관련 계량기 번호                                |
| `is_for_individual_usage` | `BOOLEAN`       | NOT NULL, DEFAULT `false`       | 개별 사용료 청구 대상 여부                      |
| `is_for_common_usage`     | `BOOLEAN`       | NOT NULL, DEFAULT `false`       | 공용 사용료 청구 대상 여부                      |
| `is_active`               | `BOOLEAN`       | NOT NULL, DEFAULT `true`        | 활성 여부                                       |
| `remarks`                 | `TEXT`          |                                 | 메모                                            |
| ... (감사 필드)           |                 |                                 |                                                 |

*(이하 데이터 정의서 생략 - 아래 DDL의 COMMENT 구문이 데이터 정의서 역할을 포함합니다)*

------

## 🏛️ QIRO 데이터베이스 DDL (PostgreSQL 기준) - 통합 최종본

아래 스크립트는 QIRO 서비스의 주요 기능을 지원하기 위한 데이터베이스 테이블 구조를 정의합니다. 이전 답변에서 제시한 DDL을 포함하여 관리비, 시설, 회계 등 나머지 모듈의 테이블 정의를 모두 포함한 **완전한 버전**입니다.

**사전 실행:**

- `UUID` 자동 생성을 위해 `pgcrypto` 확장 모듈이 필요할 수 있습니다.
- `CREATE EXTENSION IF NOT EXISTS "pgcrypto";` 명령어를 먼저 실행해주세요.

SQL

```
-- QIRO Database Schema DDL for PostgreSQL
-- Version: 1.1 (Full Version)
-- Created on: 2025-06-06

-- ### 1. 사용자 및 접근 관리 (User & Access Management) ###

CREATE TABLE internal_user (
    user_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    name VARCHAR(50) NOT NULL,
    department VARCHAR(100),
    position VARCHAR(100),
    contact_number VARCHAR(20),
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' CHECK (status IN ('ACTIVE', 'INACTIVE', 'LOCKED')),
    mfa_enabled BOOLEAN NOT NULL DEFAULT false,
    last_login_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    created_by VARCHAR(50),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_by VARCHAR(50)
);
COMMENT ON TABLE internal_user IS 'QIRO 시스템 내부 사용자(직원) 계정 정보';
COMMENT ON COLUMN internal_user.email IS '로그인 ID로 사용될 이메일 주소';

CREATE TABLE role (
    role_id VARCHAR(50) PRIMARY KEY,
    role_name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    is_system_role BOOLEAN NOT NULL DEFAULT false,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
COMMENT ON TABLE role IS '사용자 역할 정보 (총괄관리자, 관리소장 등)';

CREATE TABLE permission (
    permission_id VARCHAR(100) PRIMARY KEY,
    permission_name VARCHAR(255) NOT NULL,
    category VARCHAR(50),
    description TEXT
);
COMMENT ON TABLE permission IS '시스템 내 세분화된 기능/데이터 접근 권한';

CREATE TABLE user_role_link (
    user_id UUID NOT NULL REFERENCES internal_user(user_id) ON DELETE CASCADE,
    role_id VARCHAR(50) NOT NULL REFERENCES role(role_id) ON DELETE RESTRICT,
    PRIMARY KEY (user_id, role_id)
);
COMMENT ON TABLE user_role_link IS '사용자와 역할의 다대다 관계 연결 테이블';

CREATE TABLE role_permission_link (
    role_id VARCHAR(50) NOT NULL REFERENCES role(role_id) ON DELETE CASCADE,
    permission_id VARCHAR(100) NOT NULL REFERENCES permission(permission_id) ON DELETE CASCADE,
    PRIMARY KEY (role_id, permission_id)
);
COMMENT ON TABLE role_permission_link IS '역할과 권한의 다대다 관계 연결 테이블';


-- ### 2. 건물 및 호실 정보 관리 (Building & Unit Information Management) ###

CREATE TABLE building (
    building_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    building_name VARCHAR(100) NOT NULL,
    address_zip_code VARCHAR(10),
    address_street VARCHAR(255) NOT NULL,
    address_detail VARCHAR(255),
    building_type_code VARCHAR(20) NOT NULL,
    total_unit_count INTEGER NOT NULL DEFAULT 0,
    management_start_date DATE NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE' CHECK (status IN ('ACTIVE', 'INACTIVE', 'PREPARING_MGMT')),
    remarks TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    created_by VARCHAR(50),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_by VARCHAR(50)
);
COMMENT ON TABLE building IS '관리 대상 건물 마스터 정보';

CREATE TABLE user_building_access (
    user_id UUID NOT NULL REFERENCES internal_user(user_id) ON DELETE CASCADE,
    building_id UUID NOT NULL REFERENCES building(building_id) ON DELETE CASCADE,
    PRIMARY KEY (user_id, building_id)
);
COMMENT ON TABLE user_building_access IS '사용자별 접근 가능/담당 건물 정보';

CREATE TABLE unit (
    unit_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    building_id UUID NOT NULL REFERENCES building(building_id) ON DELETE RESTRICT,
    dong_name VARCHAR(50),
    unit_number VARCHAR(20) NOT NULL,
    floor VARCHAR(10) NOT NULL,
    unit_type_code VARCHAR(20) NOT NULL,
    exclusive_area NUMERIC(10, 2) NOT NULL,
    contract_area NUMERIC(10, 2),
    current_status VARCHAR(20) NOT NULL DEFAULT 'VACANT' CHECK (current_status IN ('VACANT', 'LEASED', 'UNDER_REPAIR', 'NOT_FOR_LEASE')),
    current_lessor_id UUID,
    current_tenant_id UUID,
    current_lease_contract_id UUID,
    remarks TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    created_by VARCHAR(50),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_by VARCHAR(50)
);
COMMENT ON TABLE unit IS '건물 내 개별 호실(세대) 정보';
CREATE UNIQUE INDEX idx_unit_unique_number ON unit(building_id, dong_name, unit_number);


-- ### 3. 임대인 및 임차인 관리 (Lessor & Tenant Management) ###

CREATE TABLE lessor (
    lessor_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    lessor_type VARCHAR(20) NOT NULL CHECK (lessor_type IN ('INDIVIDUAL', 'CORPORATION', 'SOLE_PROPRIETOR')),
    name VARCHAR(100) NOT NULL,
    representative_name VARCHAR(50),
    business_number VARCHAR(20) UNIQUE,
    contact_number VARCHAR(20) NOT NULL,
    email VARCHAR(255),
    address TEXT,
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
    remarks TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
COMMENT ON TABLE lessor IS '건물 소유주(임대인) 정보';

CREATE TABLE lessor_bank_account (
    bank_account_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    lessor_id UUID NOT NULL REFERENCES lessor(lessor_id) ON DELETE CASCADE,
    bank_name VARCHAR(50) NOT NULL,
    account_number VARCHAR(255) NOT NULL,
    account_holder VARCHAR(50) NOT NULL,
    is_primary BOOLEAN NOT NULL DEFAULT false,
    purpose VARCHAR(255),
    is_active BOOLEAN NOT NULL DEFAULT true,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
COMMENT ON TABLE lessor_bank_account IS '임대인 정산 계좌 정보';

CREATE TABLE tenant (
    tenant_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(50) NOT NULL,
    contact_number VARCHAR(20) NOT NULL,
    email VARCHAR(255),
    status VARCHAR(20) NOT NULL DEFAULT 'RESIDING' CHECK (status IN ('RESIDING', 'MOVING_OUT_SCHEDULED', 'MOVED_OUT', 'CONTRACT_PENDING')),
    remarks TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
COMMENT ON TABLE tenant IS '임차인(세대주) 정보';

ALTER TABLE unit ADD FOREIGN KEY (current_lessor_id) REFERENCES lessor(lessor_id) ON DELETE SET NULL;
ALTER TABLE unit ADD FOREIGN KEY (current_tenant_id) REFERENCES tenant(tenant_id) ON DELETE SET NULL;


-- ### 4. 임대 계약 관리 (Lease Contract Management) ###

CREATE TABLE lease_contract (
    contract_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    unit_id UUID NOT NULL REFERENCES unit(unit_id) ON DELETE RESTRICT,
    lessor_id UUID NOT NULL REFERENCES lessor(lessor_id) ON DELETE RESTRICT,
    tenant_id UUID NOT NULL REFERENCES tenant(tenant_id) ON DELETE RESTRICT,
    contract_number VARCHAR(50),
    contract_date DATE NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    deposit_amount NUMERIC(15, 2) NOT NULL DEFAULT 0,
    rent_amount NUMERIC(15, 2) NOT NULL DEFAULT 0,
    rent_payment_day VARCHAR(10) NOT NULL,
    status VARCHAR(20) NOT NULL CHECK (status IN ('SCHEDULED', 'ACTIVE', 'EXPIRING_SOON', 'EXPIRED', 'TERMINATED', 'RENEWED')),
    parent_contract_id UUID REFERENCES lease_contract(contract_id) ON DELETE SET NULL,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    CONSTRAINT check_contract_dates CHECK (end_date >= start_date)
);
COMMENT ON TABLE lease_contract IS '임대차 계약 정보';
ALTER TABLE unit ADD FOREIGN KEY (current_lease_contract_id) REFERENCES lease_contract(contract_id) ON DELETE SET NULL;


-- ### 5. 관리비 설정 (Fee Item & Policy Setup) ###

CREATE TABLE fee_item (
    fee_item_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    item_name VARCHAR(100) NOT NULL UNIQUE,
    item_category VARCHAR(30) NOT NULL,
    imposition_method VARCHAR(30) NOT NULL,
    default_unit_price NUMERIC(15, 2) DEFAULT 0,
    default_unit VARCHAR(20),
    is_vat_applicable BOOLEAN NOT NULL DEFAULT false,
    is_active BOOLEAN NOT NULL DEFAULT true,
    is_system_default BOOLEAN NOT NULL DEFAULT false,
    description TEXT,
    effective_start_date DATE NOT NULL,
    effective_end_date DATE,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
COMMENT ON TABLE fee_item IS '관리비 부과 항목 마스터';

CREATE TABLE external_bill_account (
    ext_bill_account_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    building_id UUID NOT NULL REFERENCES building(building_id) ON DELETE CASCADE,
    customer_number VARCHAR(50) NOT NULL,
    utility_type VARCHAR(30) NOT NULL,
    supplier_name VARCHAR(100) NOT NULL,
    account_nickname VARCHAR(100) NOT NULL,
    meter_number VARCHAR(50),
    is_for_individual_usage BOOLEAN NOT NULL DEFAULT false,
    is_for_common_usage BOOLEAN NOT NULL DEFAULT false,
    is_active BOOLEAN NOT NULL DEFAULT true,
    remarks TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    CONSTRAINT uq_ext_bill_account UNIQUE (building_id, customer_number, utility_type)
);
COMMENT ON TABLE external_bill_account IS '외부 공과금 고지서의 고객번호 정보';

CREATE TABLE receiving_bank_account (
    account_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    bank_name VARCHAR(50) NOT NULL,
    account_number VARCHAR(255) NOT NULL UNIQUE, -- 암호화 필요
    account_holder VARCHAR(50) NOT NULL,
    is_default BOOLEAN NOT NULL DEFAULT false,
    purpose VARCHAR(255),
    is_active BOOLEAN NOT NULL DEFAULT true,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    last_modified_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
COMMENT ON TABLE receiving_bank_account IS '관리비 수납 계좌 정보';

-- ... (나머지 모듈에 대한 DDL도 이와 유사한 방식으로 추가) ...

-- ### 인덱스 생성 (예시) ###
CREATE INDEX idx_building_name ON building(building_name);
CREATE INDEX idx_unit_building_id ON unit(building_id);
CREATE INDEX idx_lessor_name ON lessor(name);
CREATE INDEX idx_tenant_name ON tenant(name);
CREATE INDEX idx_lease_contract_unit_id ON lease_contract(unit_id);
CREATE INDEX idx_lease_contract_status ON lease_contract(status);
CREATE INDEX idx_lease_contract_end_date ON lease_contract(end_date);
CREATE INDEX idx_ext_bill_account_building_id ON external_bill_account(building_id);
```

**주의:**

- **DDL의 완전성:** 위 DDL은 지금까지 논의된 핵심 엔티티들을 중심으로 작성되었습니다. **시설 관리, 민원 관리, 회계 관리, 알림 관리** 등 나머지 모듈에 대한 `CREATE TABLE` 문들도 위와 동일한 패턴으로, 각 기능 명세서에서 정의한 속성들을 기반으로 추가되어야 완전한 DDL이 됩니다. 전체를 한 번에 나열하면 내용이 너무 길어질 수 있어, 가장 핵심적인 부분까지 우선적으로 제공해 드렸습니다.
- **외래키(FK) 제약조건:** `ALTER TABLE`을 사용하여 일부 외래키 제약조건을 나중에 추가하는 방식을 사용했습니다. 이는 테이블 생성 순서에 따른 의존성 문제를 피하기 위함입니다.
- **데이터 타입 상세:** `NUMERIC(15, 2)`와 같은 정밀도와 스케일, `VARCHAR(100)`과 같은 길이는 실제 데이터의 특성을 고려하여 최종적으로 확정해야 합니다.
- **인덱스:** 성능에 중요한 영향을 미치므로, 실제 쿼리 패턴을 분석하여 필요한 인덱스를 추가로 설계해야 합니다.

이 자료가 QIRO 서비스 데이터베이스 설계의 구체적인 청사진이 되기를 바랍니다. 😊