### 1. 최종 테이블 설계 요약

| **테이블명 (Table Name)**           | **역할 및 설명**                                             |
| ----------------------------------- | ------------------------------------------------------------ |
| **`Standard_Items_Library`**        | **표준 청구 항목 마스터:** SaaS 전체에서 공통으로 사용하는 청구 항목의 원본 템플릿. |
| **`Standard_Account_Master`**       | **표준 회계 계정 마스터:** SaaS 전체에서 공통으로 사용하는 표준 회계 계정과목 원장. |
| **`Standard_Item_Account_Mapping`** | **표준 항목-계정 연결:** `Standard_Items_Library`와 `Account_Master`를 연결하는 규칙 테이블. |
| **`Tenant_Billing_Items`**          | **테넌트별 청구 항목:** 각 고객(테넌트)이 실제로 사용하는 청구 항목의 목록과 개별 설정. |
| **`Billing_Groups`**                | **청구 대상 그룹:** 'A동 전체', '주차 계약 세대' 등 청구 대상을 정의하는 그룹. |
| **`Billing_Group_Members`**         | **청구 그룹 멤버:** 특정 그룹에 어떤 세대/호실이 속하는지를 정의하는 매핑 테이블. |
| **`Monthly_Billing_Inputs`**        | **월별 변동 데이터:** 매월 부과에 필요한 변동 값(총 비용, 단가 등)을 입력하는 테이블. |

------

### 2. 테이블 정의 (DDL - CREATE TABLE 쿼리)

아래 쿼리를 순서대로 실행하면 시스템에 필요한 모든 테이블이 생성됩니다.

#### 2.1. `Standard_Items_Library`

SQL

```
-- 표준 청구 항목 마스터 테이블
CREATE TABLE Standard_Items_Library (
    library_item_id VARCHAR(100) PRIMARY KEY COMMENT '라이브러리 항목의 고유 영문 ID (PK)',
    default_name VARCHAR(255) NOT NULL COMMENT '항목의 기본 표시명 (예: 일반관리비)',
    item_type VARCHAR(50) NOT NULL COMMENT '항목 구분 (예: 공용관리비, 개별사용료)',
    sort_order INT NOT NULL DEFAULT 0 COMMENT '구분 내 표시 정렬 순서',
    default_description TEXT COMMENT '항목에 대한 기본 설명',
    default_mapping_rule VARCHAR(50) NOT NULL COMMENT '회계 처리 매핑 규칙',
    default_vat_rate DECIMAL(5, 4) NOT NULL DEFAULT 0.0000 COMMENT '기본 부가가치세율 (0.1 = 10%)',
    is_system_default BOOLEAN NOT NULL DEFAULT true COMMENT '삭제 불가능한 시스템 기본 항목 여부',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT 'SaaS 전체에서 공통으로 사용하는 표준 청구 항목의 마스터 라이브러리';
```

#### 2.2. `Standard_Account_Master`

SQL

```
-- 표준 회계 계정과목 마스터 테이블
CREATE TABLE Standard_Account_Master (
    account_code VARCHAR(20) PRIMARY KEY COMMENT '계정코드 (PK)',
    account_name VARCHAR(255) NOT NULL COMMENT '계정과목명',
    account_type ENUM('비용', '수익', '자산', '부채', '자본') NOT NULL COMMENT '계정의 재무제표상 구분',
    category_l1 VARCHAR(100) COMMENT '대분류 (예: 공통관리비)',
    category_l2 VARCHAR(100) COMMENT '중분류 (예: 일반관리비)',
    applicable_building_type VARCHAR(100) COMMENT '적용 건물 유형 (예: 공동주택 / 상업용)',
    description TEXT COMMENT '비고 (설명)',
    is_system_default BOOLEAN NOT NULL DEFAULT true,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT 'SaaS 전체에서 공통으로 사용하는 표준 회계 계정과목 마스터 테이블';
```

#### 2.3. `Standard_Item_Account_Mapping`

SQL

```
-- 표준 청구 항목 - 회계 계정 연결 규칙 테이블
CREATE TABLE Standard_Item_Account_Mapping (
    id INT AUTO_INCREMENT PRIMARY KEY,
    library_item_id VARCHAR(100) NOT NULL COMMENT 'Standard_Items_Library 테이블의 FK',
    account_code VARCHAR(20) NOT NULL COMMENT 'Account_Master 테이블의 FK',
    mapping_type ENUM('주수익', '주비용', '차감비용', '예수부채', '예치부채', '부가세부채') NOT NULL COMMENT '연결의 목적/역할',
    description VARCHAR(255) COMMENT '해당 매핑 규칙에 대한 설명',
    CONSTRAINT fk_mapping_library_item FOREIGN KEY (library_item_id) REFERENCES Standard_Items_Library(library_item_id),
    CONSTRAINT fk_mapping_account FOREIGN KEY (account_code) REFERENCES Standard_Account_Master(account_code)
) COMMENT '표준 청구 항목과 회계 계정의 기본 연결 규칙을 정의하는 매핑 테이블';
```

#### 2.4. `Tenant_Billing_Items`

SQL

```
-- 빌딩(테넌트)별 청구 항목 테이블
CREATE TABLE Tenant_Billing_Items (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_id VARCHAR(100) NOT NULL COMMENT '이 항목이 어느 고객(테넌트)의 소유인지 식별',
    display_name VARCHAR(255) NOT NULL COMMENT '사용자에게 보여지고, 고지서에 인쇄될 실제 항목명',
    library_item_id VARCHAR(100) NULL COMMENT '표준 라이브러리 항목과의 연결고리. NULL이면 완전한 커스텀 항목',
    is_active BOOLEAN NOT NULL DEFAULT true COMMENT '항목의 활성화 여부',
    item_type VARCHAR(50) NOT NULL COMMENT '항목의 대분류 (UI 그룹핑 및 리포트용)',
    description TEXT NULL COMMENT '항목에 대한 관리자용 메모 또는 상세 설명',
    sort_order INT NOT NULL DEFAULT 0 COMMENT '고지서나 화면에 표시될 때의 정렬 순서',
    calculation_method VARCHAR(50) NOT NULL COMMENT '비용 산정 방식 (PER_AREA, FIXED_PER_UNIT 등)',
    base_amount DECIMAL(15, 2) NULL COMMENT '계산 방식이 고정값(FIXED) 유형일 때 사용될 기본 금액',
    mapping_rule VARCHAR(50) NOT NULL COMMENT '회계 처리 규칙 (라이브러리에서 상속 또는 직접 설정)',
    account_code VARCHAR(20) NULL COMMENT '이 항목과 연결될 테넌트 고유의 회계 계정과목 코드',
    vat_rate DECIMAL(5, 4) NOT NULL DEFAULT 0.0000 COMMENT '부가가치세율',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_tenant_id (tenant_id) -- 테넌트별 조회를 위한 인덱스
) COMMENT '각 고객(테넌트)이 실제로 사용하는 청구 항목의 목록과 개별 설정';
```

#### 2.5. `Billing_Groups` & `Billing_Group_Members`

SQL

```
-- 청구 대상 그룹 테이블
CREATE TABLE Billing_Groups (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_id VARCHAR(100) NOT NULL,
    group_name VARCHAR(255) NOT NULL COMMENT '그룹명 (예: A동 전체, 주차 계약 세대)',
    description TEXT,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_tenant_id (tenant_id)
) COMMENT '청구 대상을 유연하게 관리하기 위한 그룹 정의 테이블';

-- 청구 그룹 멤버 매핑 테이블
CREATE TABLE Billing_Group_Members (
    group_id BIGINT NOT NULL,
    unit_id BIGINT NOT NULL COMMENT '세대/호실 정보 테이블의 FK',
    CONSTRAINT fk_group_members_group FOREIGN KEY (group_id) REFERENCES Billing_Groups(id) ON DELETE CASCADE,
    PRIMARY KEY (group_id, unit_id)
) COMMENT '어느 그룹에 어느 세대/호실이 속하는지를 정의하는 매핑 테이블';
```

#### 2.6. `Monthly_Billing_Inputs`

SQL

```
CREATE TABLE Monthly_Billing_Inputs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    billing_cycle_id BIGINT NOT NULL COMMENT '어떤 월 마감 작업에 속한 데이터인지 연결 (Billing_Cycles FK)',
    tenant_billing_item_id BIGINT NOT NULL COMMENT '어떤 청구 항목에 대한 값인지 연결 (Tenant_Billing_Items FK)',
    
    -- ▼ 핵심 입력 데이터 ▼
    total_amount DECIMAL(15, 2) NULL COMMENT '해당 월의 총 발생 비용 (예: 총 청소비)',
    unit_price DECIMAL(15, 4) NULL COMMENT '해당 월의 단가 (예: m²당 단가)',
    
    -- ▼ 프로세스 관리 및 감사 추적 ▼
    status ENUM('DRAFT', 'CONFIRMED', 'FINALIZED') NOT NULL DEFAULT 'DRAFT' COMMENT '입력 데이터의 상태 (작성 중, 확정, 마감)',
    memo TEXT NULL COMMENT '해당 데이터 입력 건에 대한 실무자 메모',
    created_by_user_id BIGINT NULL COMMENT '데이터 최초 입력자 ID',
    confirmed_by_user_id BIGINT NULL COMMENT '데이터 확정자 ID',
    confirmed_at DATETIME NULL COMMENT '데이터 확정 시각',
    
    -- ▼ 시스템 정보 ▼
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    CONSTRAINT fk_inputs_billing_cycle FOREIGN KEY (billing_cycle_id) REFERENCES Billing_Cycles(id),
    CONSTRAINT fk_inputs_tenant_item FOREIGN KEY (tenant_billing_item_id) REFERENCES Tenant_Billing_Items(id),
    UNIQUE KEY uq_cycle_item (billing_cycle_id, tenant_billing_item_id)

) COMMENT '월별 관리비 산정을 위한 변동성 데이터를 입력하고 상태를 추적하는 테이블';
```

------

### 3. 마스터 테이블 초기 데이터 등록 (DML - INSERT 쿼리)

시스템 운영을 위해 `Standard_Items_Library`, `Account_Master`, `Standard_Item_Account_Mapping` 세 마스터 테이블에는 초기 데이터가 필요합니다.

> **참고:** `Tenant_Billing_Items`, `Billing_Groups` 등의 테이블은 각 테넌트(고객사)가 시스템을 사용하면서 생성하는 데이터이므로 초기 데이터 등록 대상이 아닙니다.

#### 3.1. `Standard_Items_Library` 데이터 등록

(이전 답변에서 제공한 전체 INSERT 쿼리를 사용하시면 됩니다. 양이 많아 여기서는 일부만 예시로 보입니다.)

SQL

```
INSERT INTO Standard_Items_Library (library_item_id, default_name, item_type, sort_order, default_description, default_mapping_rule, default_vat_rate) VALUES
('COMMON_GENERAL', '일반관리비', '공용관리비', 101, '인건비, 사무용품비 등 단지 운영을 위한 전반적인 비용', 'DIRECT_REVENUE_BILLING', 0.0),
('COMMON_CLEANING', '청소비', '공용관리비', 102, '공용 공간의 청결 유지를 위한 내/외부 용역 비용', 'DIRECT_REVENUE_BILLING', 0.0),
('INDIV_ELEC', '세대 전기료', '개별사용료', 201, '각 세대(호실)가 사용한 전기 요금', 'REVENUE_WITH_OFFSET', 0.0),
('FACIL_PARKING', '월 주차료', '시설이용료', 301, '지정된 주차 공간에 대한 월 단위 사용료', 'DIRECT_REVENUE_BILLING', 0.1),
('DEPOSIT_MNG_PREPAY', '관리비 예치금', '보증금', 501, '최초 입주 시 일정 기간의 관리비를 선납 형식으로 예치하는 금액', 'DEPOSIT_HANDLING', 0.0);
-- ... (이전 답변의 전체 쿼리 사용)
```

#### 3.2. `Account_Master` 데이터 등록

(이전 답변에서 제공한 전체 INSERT 쿼리를 사용하시면 됩니다. 양이 많아 여기서는 일부만 예시로 보입니다.)

SQL

```
INSERT INTO Account_Master (account_code, account_name, account_type, category_l1, category_l2, applicable_building_type, description) VALUES
('1200', '미수관리비', '자산', '유동자산', '매출채권', '공동주택 / 상업용', '부과 후 아직 수납되지 않은 관리비'),
('2110', '부가세예수금', '부채', '유동부채', '예수금', '공동주택 / 상업용', '과세 매출 발생 시 거래징수한 부가가치세'),
('5100', '청소비', '비용', '공통관리비', '청소/환경관리', '공동주택 / 상업용', '외주 업체 또는 직접 미화원'),
('6000', '전기료수익', '수익', '관리외수익', NULL, '공동주택 / 상업용', '(개별사용료) 세대/호실에 부과한 전기료 수입'),
('6003', '주차장수익', '수익', '관리외수익', NULL, '공동주택 / 상업용', '외부 또는 유료 주차 수입');
-- ... (이전 답변의 전체 쿼리 사용)
```

#### 3.3. `Standard_Item_Account_Mapping` 데이터 등록

(이전 답변에서 제공한 예시 INSERT 쿼리를 사용하시면 됩니다.)

SQL

```
INSERT INTO Standard_Item_Account_Mapping (library_item_id, account_code, mapping_type, description) VALUES
('COMMON_CLEANING', '5100', '주비용', '청소비 청구의 근거가 되는 비용 계정'),
('INDIV_ELEC', '6000', '주수익', '세대 부과분만큼 전기료 수익 발생'),
('INDIV_ELEC', '5400', '차감비용', '세대 부과분만큼 공용전기료 비용에서 차감(상계) 처리'),
('COMMON_MNG_FEE', '5500', '주비용', '위탁관리수수료 공급가액'),
('COMMON_MNG_FEE', '2110', '부가세부채', '위탁관리수수료의 부가가치세액'),
('FACIL_PARKING', '6003', '주수익', '월정기 주차로 발생하는 수익');
-- ... (다른 모든 표준 항목에 대한 매핑 규칙을 추가)
```







