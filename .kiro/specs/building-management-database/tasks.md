# 데이터베이스 설계 구현 계획

## 개요

이 구현 계획은 QIRO 건물 관리 SaaS의 데이터베이스 설계에 집중한 작업 목록입니다. PostgreSQL 기반의 데이터베이스 스키마 설계, ERD 작성, 테이블 정의, 인덱스 설계, 그리고 데이터 무결성 보장을 위한 제약조건 설정을 포함합니다.

## 작업 목록

- [x] 1. 데이터베이스 설계 기초 작업
  - 전체 시스템 기능 아키텍처 분석 및 데이터 요구사항 정의
  - 데이터베이스 설계 원칙 및 표준 수립
  - PostgreSQL 17.5 기반 데이터베이스 환경 설정
  - _요구사항: 모든 기능 요구사항_

- [x] 1.1 데이터 요구사항 분석 및 정의
  - 6개 기능 영역별 데이터 요구사항 상세 분석
  - 엔티티 식별 및 속성 정의
  - 데이터 흐름 및 생명주기 분석
  - _요구사항: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 4.1, 4.2, 4.3, 5.1, 5.2, 5.3, 6.1, 6.2, 6.3, 7.1, 7.2, 7.3_

- [x] 1.2 데이터베이스 설계 표준 및 명명 규칙 수립
  - 테이블, 컬럼, 인덱스 명명 규칙 정의
  - 데이터 타입 표준화 및 제약조건 정책 수립
  - 감사 로그 및 이력 관리 표준 정의
  - _요구사항: 7.3_

- [x] 2. 기초 정보 및 정책 관리 도메인 데이터베이스 설계
  - 건물, 호실, 임대인, 임차인 테이블 설계
  - 관리비 항목 및 납부 정책 테이블 설계
  - 외부 고지서 계정 관리 테이블 설계
  - _요구사항: 1.1, 1.2, 1.3, 1.4_

- [x] 2.1 건물 및 호실 정보 테이블 설계
  - buildings 테이블 설계 (건물 기본 정보)
  - units 테이블 설계 (호실 정보)
  - 건물-호실 간 관계 설정 및 제약조건 정의
  - 건물/호실 상태 관리를 위한 ENUM 타입 정의
  - _요구사항: 1.1, 1.2_

- [x] 2.2 임대인 및 임차인 정보 테이블 설계
  - lessors 테이블 설계 (임대인 정보)
  - tenants 테이블 설계 (임차인 정보)
  - 개인정보 보호를 위한 암호화 필드 설계
  - 사업자등록번호 유효성 검증 제약조건 설정
  - _요구사항: 1.3, 1.4_

- [x] 2.3 관리비 항목 및 정책 테이블 설계
  - fee_items 테이블 설계 (관리비 항목)
  - payment_policies 테이블 설계 (납부 정책)
  - external_bill_accounts 테이블 설계 (외부 고지서 계정)
  - 관리비 계산 방식별 메타데이터 구조 설계
  - _요구사항: 1.1, 1.2_

- [x] 3. 월별 관리비 처리 워크플로우 데이터베이스 설계
  - 청구월, 검침 데이터, 관리비 산정 테이블 설계
  - 고지서 및 수납 처리 테이블 설계
  - 미납 관리 및 연체료 계산 테이블 설계
  - _요구사항: 4.1, 4.2, 4.3_

- [x] 3.1 청구월 및 검침 데이터 테이블 설계
  - billing_months 테이블 설계 (청구월 관리)
  - unit_meter_readings 테이블 설계 (검침 데이터)
  - 월별 데이터 분할 및 아카이빙 전략 설계
  - 검침 데이터 유효성 검증 제약조건 설정
  - _요구사항: 4.1_

- [x] 3.2 관리비 산정 및 고지서 테이블 설계
  - monthly_fees 테이블 설계 (산정된 관리비)
  - invoices 테이블 설계 (고지서)
  - 관리비 계산 결과 검증을 위한 제약조건 설정
  - 고지서 상태 관리 및 이력 추적 구조 설계
  - _요구사항: 4.2_

- [x] 3.3 수납 처리 및 미납 관리 테이블 설계
  - payments 테이블 설계 (수납 내역)
  - delinquencies 테이블 설계 (미납 관리)
  - 연체료 자동 계산을 위한 트리거 및 함수 설계
  - 수납 상태별 데이터 무결성 보장 제약조건 설정
  - _요구사항: 4.1, 4.2, 4.3_

- [x] 4. 임대차 관리 워크플로우 데이터베이스 설계
  - 임대 계약 및 계약 생애주기 테이블 설계
  - 임대료 관리 및 납부 처리 테이블 설계
  - 퇴실 정산 및 보증금 관리 테이블 설계
  - _요구사항: 3.1, 3.2, 3.3_

- [x] 4.1 임대 계약 관리 테이블 설계
  - lease_contracts 테이블 설계 (임대 계약)
  - 계약 기간 중복 방지 제약조건 설정
  - 계약 상태 변경 이력 추적 구조 설계
  - 계약 만료 알림을 위한 인덱스 및 뷰 설계
  - _요구사항: 3.1, 3.2_

- [x] 4.2 임대료 관리 테이블 설계
  - monthly_rents 테이블 설계 (임대료 관리)
  - 임대료 연체 관리 및 연체료 계산 로직 설계
  - 임대료 납부 상태별 인덱스 최적화
  - _요구사항: 3.2_

- [x] 4.3 퇴실 정산 테이블 설계
  - move_out_settlements 테이블 설계 (퇴실 정산)
  - 보증금 정산 계산 로직 및 제약조건 설정
  - 정산 완료 후 데이터 아카이빙 전략 설계
  - _요구사항: 3.3_

- [x] 5. 시설 유지보수 관리 데이터베이스 설계
  - 시설물 정보 및 점검 이력 테이블 설계
  - 유지보수 요청 및 작업 관리 테이블 설계
  - 협력업체 관리 테이블 설계
  - _요구사항: 5.1, 5.2, 5.3_

- [x] 5.1 시설물 정보 및 점검 관리 테이블 설계
  - facilities 테이블 설계 (시설물 정보)
  - 정기 점검 일정 관리를 위한 테이블 및 인덱스 설계
  - 시설물 생애주기 관리 구조 설계
  - _요구사항: 5.1, 5.3_

- [x] 5.2 유지보수 요청 및 작업 관리 테이블 설계
  - maintenance_requests 테이블 설계 (유지보수 요청)
  - maintenance_works 테이블 설계 (유지보수 작업)
  - 작업 진행 상황 추적을 위한 상태 관리 구조 설계
  - _요구사항: 5.1, 5.2_

- [x] 5.3 협력업체 관리 테이블 설계
  - facility_vendors 테이블 설계 (협력업체)
  - 협력업체별 작업 이력 및 성과 관리 구조 설계
  - 협력업체 평가 및 계약 관리 테이블 설계
  - _요구사항: 5.2_

- [x] 6. 운영 및 고객 관리 데이터베이스 설계
  - 민원 처리 관리 테이블 설계
  - 공지사항 및 알림 관리 테이블 설계
  - 사용자 소통 이력 관리 테이블 설계
  - _요구사항: 5.1, 5.2, 5.3_

- [x] 6.1 민원 처리 관리 테이블 설계
  - complaints 테이블 설계 (민원 관리)
  - 민원 분류 및 우선순위 관리 구조 설계
  - 민원 처리 진행 상황 추적 및 SLA 관리 테이블 설계
  - _요구사항: 5.1_

- [x] 6.2 공지사항 및 알림 관리 테이블 설계
  - announcements 테이블 설계 (공지사항)
  - notifications 테이블 설계 (알림)
  - 대상자별 알림 발송 및 읽음 상태 관리 구조 설계
  - _요구사항: 5.2, 5.3_

- [x] 7. 시스템 및 데이터 관리 데이터베이스 설계
  - 회계 관리 및 재무제표 테이블 설계
  - 사용자 권한 및 감사 로그 테이블 설계
  - 시스템 환경설정 테이블 설계
  - _요구사항: 6.1, 6.2, 6.3, 7.1, 7.2, 7.3_

- [x] 7.1 회계 관리 테이블 설계
  - journal_entries 테이블 설계 (회계 전표)
  - 복식부기 원칙을 위한 차변/대변 검증 제약조건 설정
  - 회계 마감 및 차기 이월을 위한 테이블 구조 설계
  - 재무제표 생성을 위한 뷰 및 집계 함수 설계
  - _요구사항: 6.1, 6.2_

- [x] 7.2 사용자 권한 및 감사 로그 테이블 설계
  - users 테이블 설계 (사용자 정보)
  - roles 테이블 설계 (사용자 역할)
  - audit_logs 테이블 설계 (감사 로그)
  - RBAC 구현을 위한 권한 매트릭스 테이블 설계
  - 감사 로그 자동 생성을 위한 트리거 설계
  - _요구사항: 7.1, 7.2, 7.3_

- [x] 7.3 시스템 환경설정 테이블 설계
  - organization_settings 테이블 설계 (조직 설정)
  - 시스템 설정값 관리를 위한 키-값 구조 설계
  - 설정 변경 이력 추적 구조 설계
  - _요구사항: 7.1_

- [x] 8. 데이터베이스 성능 최적화 설계
  - 주요 쿼리 패턴 분석 및 인덱스 설계
  - 대용량 데이터 처리를 위한 파티셔닝 전략 설계
  - 데이터 아카이빙 및 백업 전략 설계
  - _요구사항: NFR-PF-001 ~ NFR-PF-009_

- [x] 8.1 인덱스 설계 및 최적화
  - 주요 조회 패턴별 인덱스 설계
  - 복합 인덱스 및 부분 인덱스 설계
  - 인덱스 성능 모니터링 및 유지보수 계획 수립
  - _요구사항: NFR-PF-001, NFR-PF-002_

- [x] 8.2 데이터 파티셔닝 및 아카이빙 전략 설계
  - 시간 기반 파티셔닝 전략 설계 (월별 관리비, 회계 데이터)
  - 대용량 테이블 수평 분할 전략 설계
  - 과거 데이터 아카이빙 및 압축 전략 설계
  - _요구사항: NFR-PF-003, NFR-PF-004_

- [x] 9. 데이터베이스 보안 설계
  - 개인정보 암호화 및 접근 제어 설계
  - 데이터베이스 사용자 권한 관리 설계
  - 백업 데이터 보안 및 복구 전략 설계
  - _요구사항: NFR-SE-001 ~ NFR-SE-014_

- [x] 9.1 데이터 암호화 및 보안 설계
  - 개인정보 필드별 암호화 전략 설계
  - 데이터베이스 연결 보안 설정
  - 민감 데이터 접근 로깅 및 모니터링 설계
  - _요구사항: NFR-SE-006, NFR-SE-007, NFR-SE-008_

- [x] 9.2 백업 및 복구 전략 설계
  - 일일/주간/월간 백업 전략 설계
  - 백업 데이터 암호화 및 오프사이트 보관 전략
  - 재해 복구 시나리오별 복구 절차 설계
  - _요구사항: NFR-SE-008_

- [x] 10. 데이터베이스 구현 및 검증
  - DDL 스크립트 작성 및 데이터베이스 구축
  - 테스트 데이터 생성 및 데이터 무결성 검증
  - 성능 테스트 및 최적화
  - _요구사항: 모든 요구사항 검증_

- [x] 10.1 DDL 스크립트 작성 및 데이터베이스 구축
  - 전체 테이블 생성 DDL 스크립트 작성
  - 제약조건, 인덱스, 트리거, 함수 생성 스크립트 작성
  - 데이터베이스 마이그레이션 스크립트 작성
  - _요구사항: 모든 기능 요구사항_

- [x] 10.2 테스트 데이터 생성 및 검증
  - 각 도메인별 테스트 데이터 생성 스크립트 작성
  - 데이터 무결성 제약조건 검증 테스트
  - 비즈니스 규칙 검증 테스트 (계약 중복 방지, 복식부기 등)
  - _요구사항: R-DB-001 ~ R-DB-005_

- [x] 10.3 성능 테스트 및 최적화
  - 대용량 데이터 기준 조회 성능 테스트
  - 동시 접속 시나리오 기반 성능 테스트
  - 쿼리 실행 계획 분석 및 최적화
  - _요구사항: NFR-PF-001 ~ NFR-PF-009_